<!doctype html><html><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>å…³äºJavaè¯­è¨€çš„finallyè¯­å¥</title><meta name=generator content="Hugo 0.112.3"><link rel=stylesheet href="https://zenuo.github.io/css/styles.min.da6e1927bcb6a0faebcb06ab9925c87524b8057860afacf48eab54fcbf9eef18.css" integrity="sha256-2m4ZJ7y2oPrrywarmSXIdSS4BXhgr6z0jqtU/L+e7xg="><script async defer data-domain=kaiwern.com src=https://plausible.io/js/plausible.js></script>
<link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Lora&family=Source+Sans+Pro:wght@400;600&display=swap" rel=stylesheet><body class="flex flex-col min-h-screen px-6 max-w-prose md:w-2/3 m-auto"><nav class=mt-8><ul id=nav-menu class="w-full flex items-center list-reset"><li><a href=https://zenuo.github.io/>Home</a></li><li><a href=https://zenuo.github.io/fragments/>Fragments</a></li><li><a href=https://zenuo.github.io/about/>Home</a></li><li><a href=https://zenuo.github.io/tags/>Tags</a></li></ul></nav><main class="flex-1 mt-10 sm:mt-12"><header class="mb-8 font-sans-serif"><div class="text-sm font-gray-700 mb-8"><p class="uppercase font-semibold"><a class=text-gray-700 href=/posts>posts</a></p><p>May 05, 2019</p></div><h1 class="title mb-2">å…³äºJavaè¯­è¨€çš„finallyè¯­å¥</h1><p class="text-sm font-gray-700 mb-4 italic">Estimated Reading Time: 2 minutes (320 words)</p><div id=tags></div></header><article class="prose serif mb-12 text-gray-800"><h2 id=æ˜¯å¦ä¸€å®šæ‰§è¡Œæ‰§è¡Œæ—¶æœº>æ˜¯å¦ä¸€å®šæ‰§è¡Œã€æ‰§è¡Œæ—¶æœº</h2><p>ä¸€åˆ‡è¦ä»è¿™é“é¢˜ç›®è¯´èµ·ï¼š</p><p>Javaè¯­è¨€ä¸­çš„<code>finally</code>è¯­å¥ï¼ˆå—ï¼‰ä¸€å®šä¼šè¢«æ‰§è¡Œå—ï¼Ÿæ˜¯åœ¨<code>try</code>è¯­å¥è¿”å›<strong>ä¹‹å‰</strong>è¿˜æ˜¯<strong>ä¹‹å</strong>æ‰§è¡Œï¼Ÿ</p><p>ç”±äºå¯¹è¿™ä¸ªé—®é¢˜çš„ä¸€çŸ¥åŠè§£ï¼Œå½“æ—¶åªå›ç­”äº†å‰åŠä¸ªé—®é¢˜<code>æ˜¯çš„ï¼Œä¸€å®šä¼šæ‰§è¡Œ</code>ï¼Œæ²¡æœ‰å›ç­”ååŠä¸ªé—®é¢˜ï¼›ç¬”è¯•ç»“æŸåæŸ¥èµ„æ–™&mldr;æ‰å‘ç°äº‹æƒ…æ²¡é‚£ä¹ˆç®€å•ğŸ¤¯</p><p>è¯šç„¶ï¼Œæˆ‘çš„å›ç­”æ˜¯<strong>é”™è¯¯</strong>çš„ï¼Œä»¥ä¸‹ä¸¤ç§æƒ…å†µçš„finallyè¯­å¥ä¸ä¼šè¢«æ‰§è¡Œï¼š</p><ol><li><code>try</code>è¯­å¥æ²¡æœ‰è¢«æ‰§è¡Œï¼›ä¹Ÿè¯´æ˜äº†finallyè¯­å¥è¢«æ‰§è¡Œçš„<code>å¿…è¦éå……åˆ†</code>æ¡ä»¶æ˜¯<code>å¯¹åº”tryè¯­å¥è¢«æ‰§è¡Œ</code></li><li><code>try</code>è¯­å¥ä¸­æœ‰<code>åœæ­¢JVM</code>çš„è¯­å¥ï¼›</li></ol><p>ååŠä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯<code>ä¹‹å‰</code>ï¼Œå³åœ¨<code>try</code>è¯­å¥<code>è¿”å›</code>ä¹‹å‰æ‰§è¡Œï¼Œå¯é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ï¼š</p><pre tabindex=0><code class=language-jshell data-lang=jshell>jshell&gt; String test1() {
   ...&gt;     System.out.println(&#34;return statement&#34;);
   ...&gt;
   ...&gt;     return &#34;after return&#34;;
   ...&gt; }
|  created method test1()

jshell&gt; String test2() {
   ...&gt;     try {
   ...&gt;         System.out.println(&#34;try block&#34;);
   ...&gt;
   ...&gt;         return test1();
   ...&gt;     } finally {
   ...&gt;         System.out.println(&#34;finally block&#34;);
   ...&gt;     }
   ...&gt; }
|  created method test2()

jshell&gt; test2()
try block
return statement
finally block
$1 ==&gt; &#34;after return&#34;
</code></pre><p>æ›´è¯¦ç»†åœ°è¯´æ˜ï¼šæ‰§è¡Œreturnè¯­å¥<strong>ä¹‹å</strong>ï¼Œå†æ‰§è¡Œ<code>finallyè¯­å¥</code>ï¼Œå†<strong>è¿”å›</strong>è°ƒç”¨è€…ï¼›</p><h2 id=æ‰§è¡Œçš„å½±å“>æ‰§è¡Œçš„å½±å“</h2><h3 id=finallyè¯­å¥ä¸­çš„returnè¯­å¥>finallyè¯­å¥ä¸­çš„returnè¯­å¥</h3><pre tabindex=0><code class=language-jshell data-lang=jshell>jshell&gt; int test() {
   ...&gt;     int b = 20;
   ...&gt;     try {
   ...&gt;         System.out.println(&#34;try block&#34;);
   ...&gt; 
   ...&gt;         return b += 80;
   ...&gt;     } catch (Exception e) {
   ...&gt; 
   ...&gt;         System.out.println(&#34;catch block&#34;);
   ...&gt;     } finally {
   ...&gt; 
   ...&gt;         System.out.println(&#34;finally block&#34;);
   ...&gt; 
   ...&gt;         if (b &gt; 25) {
   ...&gt;             System.out.println(&#34;b&gt;25, b = &#34; + b);
   ...&gt;         }
   ...&gt; 
   ...&gt;         return 200;
   ...&gt;     }
   ...&gt; }
|  modified method test()

jshell&gt; test()
try block
finally block
b&gt;25, b = 100
$2 ==&gt; 200
</code></pre><p>è¯´æ˜finallyçš„returnè¯­å¥çš„å€¼è¢«<strong>è¿”å›</strong>ç»™è°ƒç”¨è€…ï¼Œå³finallyå—ä¸­çš„returnè¯­å¥ä¼š<strong>è¦†ç›–</strong>tryå—ä¸­çš„returnè¿”å›ï¼›</p><h2 id=finallyè¯­å¥ä¸­å¯¹tryè¯­å¥è¿”å›å€¼çš„ä¿®æ”¹>finallyè¯­å¥ä¸­å¯¹tryè¯­å¥è¿”å›å€¼çš„ä¿®æ”¹</h2><p>è¿™é‡Œè¦åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œè¿”å›å€¼æ˜¯<code>åŸºæœ¬ç±»å‹</code>è¿˜æ˜¯<code>å¼•ç”¨ç±»å‹</code>ï¼š</p><ol><li>è‹¥æ˜¯<strong>åŸºæœ¬ç±»å‹</strong>ï¼Œä¿®æ”¹æ— æ•ˆï¼›</li><li>è‹¥æ˜¯<strong>å¼•ç”¨ç±»å‹</strong>ï¼Œä¹Ÿè¦åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š<ol><li>è‹¥æ˜¯ä¿®æ”¹<strong>å¼•ç”¨</strong>ï¼Œåˆ™æ— æ•ˆï¼›</li><li>è‹¥æ˜¯ä¿®æ”¹<strong>è¢«å¼•ç”¨çš„å¯¹è±¡çš„å†…å®¹</strong>ï¼Œåˆ™æœ‰æ•ˆï¼›</li></ol></li></ol><p>é€šè¿‡ä¸¤ä¸ªä¾‹å­æ¥æ¼”ç¤ºï¼š</p><h3 id=åŸºæœ¬ç±»å‹>åŸºæœ¬ç±»å‹</h3><pre tabindex=0><code class=language-jshell data-lang=jshell>jshell&gt; int test() {
   ...&gt;     int b = 20;
   ...&gt; 
   ...&gt;     try {
   ...&gt;         System.out.println(&#34;try block&#34;);
   ...&gt; 
   ...&gt;         return b += 80;
   ...&gt;     } catch (Exception e) {
   ...&gt;         System.out.println(&#34;catch block&#34;);
   ...&gt;     } finally {
   ...&gt;         System.out.println(&#34;finally block&#34;);
   ...&gt; 
   ...&gt;         if (b &gt; 25) {
   ...&gt;             System.out.println(&#34;b&gt;25, b = &#34; + b);
   ...&gt;         }
   ...&gt; 
   ...&gt;         b = 150;
   ...&gt;     }
   ...&gt; 
   ...&gt;     return 2000;
   ...&gt; }
|  modified method test()

jshell&gt; test()
try block
finally block
b&gt;25, b = 100
$3 ==&gt; 100
</code></pre><p>è®©æˆ‘ä»¬æ¥æ¢ç©¶ä¸€ä¸‹è¿™ä¸ªä¾‹å­çš„<a href=/attachment/finally-primitive-type-example.tgz>å­—èŠ‚ç </a>ï¼š</p><blockquote><p>æˆªå›¾è‡ª<a href=https://github.com/ingokegel/jclasslib>jclasslib</a>å·¥å…·</p></blockquote><p><img src=/img/afcd7098269159ba07bf670a.png alt=afcd7098269159ba07bf670a.png></p><ul><li><code>6-8</code>è¡Œï¼Œå°†<strong>æœ¬åœ°å˜é‡æ•°ç»„ï¼ˆlocal variable arrayï¼‰<strong>çš„ç¬¬<code>0</code>ä¸ªå€¼ï¼ˆå³20ï¼‰åŠ 80ï¼Œå¹¶è¢«å‹å…¥</strong>æ“ä½œæ•°æ ˆ</strong>ï¼Œä¿å­˜åœ¨ç¬¬<code>1</code>ä¸ªintå€¼ä¸­</li><li><code>19-22</code>è¡Œï¼Œå°†<code>150</code>å‹å…¥æ“ä½œæ•°æ ˆï¼Œä¿å­˜åœ¨<code>æœ¬åœ°å˜é‡æ•°ç»„çš„ç¬¬0ä¸ªå€¼</code>ä¸­ï¼Œå°†<code>æœ¬åœ°å˜é‡æ•°ç»„çš„ç¬¬1ä¸ªå€¼</code>å³ï¼ˆ100ï¼‰å‹å…¥æ“ä½œæ•°æ ˆï¼Œè¿”å›</li></ul><p>æ•…è€Œè¯­å¥<code>b = 150;</code>å¹¶æ²¡æœ‰å½±å“åˆ°è¿”å›å€¼ï¼›</p><h3 id=å¼•ç”¨ç±»å‹>å¼•ç”¨ç±»å‹</h3><pre tabindex=0><code class=language-jshell data-lang=jshell>jshell&gt; Map&lt;String, String&gt; test() {
   ...&gt;     Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();
   ...&gt;     map.put(&#34;KEY&#34;, &#34;INIT&#34;);
   ...&gt;     try {
   ...&gt;         map.put(&#34;KEY&#34;, &#34;TRY&#34;);
   ...&gt;         return map;
   ...&gt;     } catch (Exception e) {
   ...&gt;         map.put(&#34;KEY&#34;, &#34;CATCH&#34;);
   ...&gt;     } finally {
   ...&gt;         map.put(&#34;KEY&#34;, &#34;FINALLY&#34;);
   ...&gt;         map = null;
   ...&gt;     }
   ...&gt;     return map;
   ...&gt; }
|  replaced method test()

jshell&gt; test()
$4 ==&gt; {KEY=FINALLY}
</code></pre><p>è¿™ä¸ªä¾‹å­çš„<a href=/attachment/finally-reference-type-example.tgz>å­—èŠ‚ç </a>å¦‚å›¾ï¼š</p><p><img src=/img/2cb3134765477ad23e79d035.png alt=2cb3134765477ad23e79d035.png></p><p>ä¸ä¸ŠåŒç†ã€‚</p><h2 id=å‚è€ƒ>å‚è€ƒ</h2><ol><li><a href=https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5.istore_n>istore_n</a></li><li><a href=https://www.cnblogs.com/lanxuezaipiao/p/3440471.html>Java finallyè¯­å¥åˆ°åº•æ˜¯åœ¨returnä¹‹å‰è¿˜æ˜¯ä¹‹åæ‰§è¡Œï¼Ÿ</a></li></ol></article></main><hr><footer class="w-full text-center p-4 pin-b text-xs text-gray-400"><p>made with <a href=https://gohugo.io class="underline hover:text-blue-400">Hugo</a> and <a href=https://tailwindcss.com class="underline hover:text-blue-400">TailwindCSS</a></p></footer></body></html>