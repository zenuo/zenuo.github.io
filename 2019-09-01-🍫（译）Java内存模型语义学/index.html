
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://zenuo.github.io/2019-09-01-%F0%9F%8D%AB%EF%BC%88%E8%AF%91%EF%BC%89Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E8%AF%AD%E4%B9%89%E5%AD%A6/">
      
      
        <link rel="prev" href="../2019-07-20-%F0%9F%94%8D%E5%A6%82%E4%BD%95%E6%AF%94%E8%BE%83%E4%B8%A4%E4%B8%AACollection%E5%90%AB%E6%9C%89%E7%9B%B8%E5%90%8C%E7%9A%84%E5%85%83%E7%B4%A0%E2%80%94%E2%80%94%E6%9D%A5%E8%87%AAApache%20Commons%20Collections%E7%9A%84%E5%AE%9E%E7%8E%B0/">
      
      
        <link rel="next" href="../2019-09-23-%F0%9F%A7%B6Java%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%85%B6%E5%AF%B9%E5%BA%94%E7%9A%84Linux%E8%BF%9B%E7%A8%8B%E5%8F%B7/">
      
      <link rel="icon" href="../assets/img/22318999.jpeg">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.8">
    
    
      
        <title>2019 09 01 ğŸ«ï¼ˆè¯‘ï¼‰Javaå†…å­˜æ¨¡å‹è¯­ä¹‰å­¦ - /home/zenuo</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.ded33207.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="/home/zenuo" class="md-header__button md-logo" aria-label="/home/zenuo" data-md-component="logo">
      
  <img src="../assets/img/22318999.jpeg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            /home/zenuo
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2019 09 01 ğŸ«ï¼ˆè¯‘ï¼‰Javaå†…å­˜æ¨¡å‹è¯­ä¹‰å­¦
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/zenuo/zenuo.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    zenuo/zenuo.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="/home/zenuo" class="md-nav__button md-logo" aria-label="/home/zenuo" data-md-component="logo">
      
  <img src="../assets/img/22318999.jpeg" alt="logo">

    </a>
    /home/zenuo
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zenuo/zenuo.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    zenuo/zenuo.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2017-09-02-Spring%E6%A1%86%E6%9E%B6Bean%E4%BD%9C%E7%94%A8%E5%9F%9F/" class="md-nav__link">
        2017 09 02 Springæ¡†æ¶Beanä½œç”¨åŸŸ
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2017-09-10-Spring%E6%A1%86%E6%9E%B6%E8%BF%90%E8%A1%8C%E6%97%B6%E5%80%BC%E6%B3%A8%E5%85%A5/" class="md-nav__link">
        Springæ¡†æ¶è¿è¡Œæ—¶å€¼æ³¨å…¥
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2017-09-14-%E4%BD%BF%E7%94%A8Tomcat%20JDBC%20Pool%E6%8B%A6%E6%88%AA%E5%99%A8%E6%89%93%E5%8D%B0%E5%B8%A6%E5%8F%82%E6%95%B0%E7%9A%84SQL%E8%AF%AD%E5%8F%A5/" class="md-nav__link">
        2017 09 14 ä½¿ç”¨Tomcat JDBC Poolæ‹¦æˆªå™¨æ‰“å°å¸¦å‚æ•°çš„SQLè¯­å¥
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2017-10-02-Spring%E6%A1%86%E6%9E%B6%EF%BC%9A%E4%BB%80%E4%B9%88%E6%98%AF%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        2017 10 02 Springæ¡†æ¶ï¼šä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2017-10-27-Logback%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F%E8%AE%BE%E5%AE%9A/" class="md-nav__link">
        2017 10 27 Logbackæ—¥å¿—æ ¼å¼è®¾å®š
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2017-11-01-Spring%E6%A1%86%E6%9E%B6%EF%BC%9A%E6%B3%A8%E5%85%A5AspectJ%E5%88%87%E9%9D%A2/" class="md-nav__link">
        2017 11 01 Springæ¡†æ¶ï¼šæ³¨å…¥AspectJåˆ‡é¢
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2017-11-09-%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8FC%E8%AF%AD%E8%A8%80%E9%80%92%E5%BD%92%E5%AE%9E%E7%8E%B0/" class="md-nav__link">
        2017 11 09 å¿«é€Ÿæ’åºCè¯­è¨€é€’å½’å®ç°
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2017-11-18-Spring%E6%A1%86%E6%9E%B6%EF%BC%9ASpring%20MVC%E8%B5%B7%E6%AD%A5/" class="md-nav__link">
        Springæ¡†æ¶ï¼šSpring MVCèµ·æ­¥
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-01-22-Netty%E6%A1%86%E6%9E%B6%EF%BC%9AEcho%E5%AE%A2%E6%88%B7%E7%AB%AF/" class="md-nav__link">
        2018 01 22 Nettyæ¡†æ¶ï¼šEchoå®¢æˆ·ç«¯
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-01-22-Netty%E6%A1%86%E6%9E%B6%EF%BC%9AEcho%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="md-nav__link">
        2018 01 22 Nettyæ¡†æ¶ï¼šEchoæœåŠ¡å™¨
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-01-22-Netty%E6%A1%86%E6%9E%B6%EF%BC%9A%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/" class="md-nav__link">
        2018 01 22 Nettyæ¡†æ¶ï¼šæ ¸å¿ƒç»„ä»¶
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-01-22-Netty%E6%A1%86%E6%9E%B6%EF%BC%9A%E7%BB%84%E4%BB%B6%E5%92%8C%E8%AE%BE%E8%AE%A1/" class="md-nav__link">
        2018 01 22 Nettyæ¡†æ¶ï¼šç»„ä»¶å’Œè®¾è®¡
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-01-22-Nginx%E7%9A%84WebDAV%E6%94%AF%E6%8C%81/" class="md-nav__link">
        2018 01 22 Nginxçš„WebDAVæ”¯æŒ
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-03-25-how-to-set-the-font-of-console/" class="md-nav__link">
        2018 03 25 how to set the font of console
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-05-27-MySQL%E6%9F%A5%E8%AF%A2%E6%9F%90%E5%BC%A0%E8%A1%A8%E7%9A%84%E5%88%97%E5%90%8D/" class="md-nav__link">
        MySQLæŸ¥è¯¢æŸå¼ è¡¨çš„åˆ—å
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-05-27-MySQL%E7%9A%84mysqldump%E4%BE%8B%E5%AD%90/" class="md-nav__link">
        2018 05 27 MySQLçš„mysqldumpä¾‹å­
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-06-14-%E4%BD%BF%E7%94%A8Nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E8%B0%B7%E6%AD%8C%E6%90%9C%E7%B4%A2/" class="md-nav__link">
        2018 06 14 ä½¿ç”¨Nginxåå‘ä»£ç†è°·æ­Œæœç´¢
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-06-14-%E4%BD%BF%E7%94%A8%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5%E4%BE%9D%E8%B5%96/" class="md-nav__link">
        2018 06 14 ä½¿ç”¨æ„é€ æ–¹æ³•æ³¨å…¥ä¾èµ–
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-06-15-%E4%BD%BF%E7%94%A8Jconsole%E7%9B%91%E6%8E%A7%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8C%E7%9A%84Java%E7%A8%8B%E5%BA%8F/" class="md-nav__link">
        2018 06 15 ä½¿ç”¨Jconsoleç›‘æ§è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œçš„Javaç¨‹åº
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-06-22-CSAPP%E7%BB%83%E4%B9%A0%E9%A2%982-13/" class="md-nav__link">
        2018 06 22 CSAPPç»ƒä¹ é¢˜2 13
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-06-22-Manjaro%20Linux%E8%AE%BF%E9%97%AEiPhone%E9%9C%80%E5%AE%89%E8%A3%85%E7%9A%84%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        2018 06 22 Manjaro Linuxè®¿é—®iPhoneéœ€å®‰è£…çš„å·¥å…·
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-06-24-%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E5%AD%A6-Richard-Courant/" class="md-nav__link">
        2018 06 24 ä»€ä¹ˆæ˜¯æ•°å­¦ Richard Courant
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-08-08-%E5%9C%A8%E6%A0%91%E8%8E%93%E6%B4%BE%E4%B8%8A%E5%AE%89%E8%A3%85Arch%20Linux%20ARM/" class="md-nav__link">
        2018 08 08 åœ¨æ ‘è“æ´¾ä¸Šå®‰è£…Arch Linux ARM
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-08-16-Timsort%20%E4%BD%A0%E4%BB%8E%E6%9C%AA%E5%90%AC%E8%AF%B4%E8%BF%87%E7%9A%84%E6%9C%80%E5%BF%AB%E7%9A%84%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" class="md-nav__link">
        2018 08 16 Timsort ä½ ä»æœªå¬è¯´è¿‡çš„æœ€å¿«çš„æ’åºç®—æ³•
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-09-29-%E4%BD%BF%E7%94%A8Googletrans%E5%9C%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8A%E7%BF%BB%E8%AF%91/" class="md-nav__link">
        2018 09 29 ä½¿ç”¨Googletransåœ¨å‘½ä»¤è¡Œä¸Šç¿»è¯‘
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-10-10-%E5%9F%BA%E4%BA%8EShadowsocks%E7%9A%84%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/" class="md-nav__link">
        2018 10 10 åŸºäºShadowsocksçš„ç§‘å­¦ä¸Šç½‘
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-10-14-%E5%9F%BA%E4%BA%8EOpenCV%E7%9A%84%E5%9B%BE%E5%83%8F%E7%BC%A9%E6%94%BE%E8%84%9A%E6%9C%AC/" class="md-nav__link">
        1 OpenCVæ˜¯ä»€ä¹ˆ
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-11-09-%E6%B5%85%E8%B0%88Java%E5%AF%B9%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E7%9A%84%E6%94%AF%E6%8C%81/" class="md-nav__link">
        2018 11 09 æµ…è°ˆJavaå¯¹å‡½æ•°å¼ç¼–ç¨‹çš„æ”¯æŒ
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2018-11-18-Linux%E7%9A%84TCP%20backlog%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C/" class="md-nav__link">
        2018 11 18 Linuxçš„TCP backlogå¦‚ä½•å·¥ä½œ
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-01-27-%E5%BB%BA%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BA%94%E5%A4%A7%E5%8E%9F%E5%88%99/" class="md-nav__link">
        2019 01 27 å»ºç´¢å¼•çš„äº”å¤§åŸåˆ™
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-01-31-nginx%E6%9E%B6%E6%9E%84/" class="md-nav__link">
        2019 01 31 nginxæ¶æ„
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-02-22-MySQL%E6%B5%8B%E8%AF%95%E8%A1%A8%E4%B8%AD%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E8%A1%8C%E7%9A%84%E6%9C%80%E4%BD%B3%E6%96%B9%E6%B3%95/" class="md-nav__link">
        2019 02 22 MySQLæµ‹è¯•è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçš„æœ€ä½³æ–¹æ³•
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-03-10-%E4%BD%BF%E7%94%A8tcpdump%E6%8A%93%E5%8C%85/" class="md-nav__link">
        2019 03 10 ä½¿ç”¨tcpdumpæŠ“åŒ…
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-03-10-%E5%AE%9E%E8%B7%B5java.util.concurrent.TransferQueue/" class="md-nav__link">
        2019 03 10 å®è·µjava.util.concurrent.TransferQueue
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-03-18-%E6%9C%89%E5%85%B3%E5%BC%82%E6%AD%A5%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E5%AE%9E%E7%8E%B0%E7%9A%84%E8%AF%B4%E6%98%8E/" class="md-nav__link">
        2019 03 18 æœ‰å…³å¼‚æ­¥è¾“å…¥è¾“å‡ºå®ç°çš„è¯´æ˜
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-03-18-%E7%BC%93%E5%AD%98%E9%82%A3%E4%BA%9B%E4%BA%8B/" class="md-nav__link">
        2019 03 18 ç¼“å­˜é‚£äº›äº‹
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-03-21-Git%E6%9E%B6%E6%9E%84/" class="md-nav__link">
        2019 03 21 Gitæ¶æ„
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-04-19-class-visualizer%E2%80%94%E2%80%94%E4%B8%80%E4%B8%AA%E6%9F%A5%E7%9C%8B%E7%B1%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        2019 04 19 class visualizerâ€”â€”ä¸€ä¸ªæŸ¥çœ‹ç±»å…³ç³»çš„å›¾å½¢åŒ–å·¥å…·
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-04-19-%E6%A0%91%E8%8E%93%E6%B4%BE%E7%94%B5%E6%BA%90%E6%9C%80%E5%A4%A7%E5%8C%96/" class="md-nav__link">
        2019 04 19 æ ‘è“æ´¾ç”µæºæœ€å¤§åŒ–
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-04-20-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%AD%89%E7%BA%A7%E6%8F%90%E4%BA%A4%E8%AF%BB%E4%B8%8E%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E7%9A%84%E5%8C%BA%E5%88%AB/" class="md-nav__link">
        2019 04 20 äº‹åŠ¡éš”ç¦»ç­‰çº§æäº¤è¯»ä¸å¯é‡å¤è¯»çš„åŒºåˆ«
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-04-26-MySQL%E4%B8%AD%E7%9A%84%E5%B9%B6%E3%80%81%E5%B7%AE%E3%80%81%E4%BA%A4%E5%92%8C%E9%99%A4%E8%BF%90%E7%AE%97/" class="md-nav__link">
        2019 04 26 MySQLä¸­çš„å¹¶ã€å·®ã€äº¤å’Œé™¤è¿ç®—
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-05-01-%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%EF%BC%9Aepoll%E4%B8%8Ekqueue/" class="md-nav__link">
        2019 05 01 å¯æ‰©å±•çš„äº‹ä»¶å¤šè·¯å¤ç”¨ï¼šepollä¸kqueue
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-05-05-%E5%85%B3%E4%BA%8EJava%E8%AF%AD%E8%A8%80%E7%9A%84finally%E8%AF%AD%E5%8F%A5/" class="md-nav__link">
        2019 05 05 å…³äºJavaè¯­è¨€çš„finallyè¯­å¥
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-05-09-%E4%B8%80%E4%B8%AA%E6%88%90%E5%8A%9F%E7%9A%84Git%E5%88%86%E6%94%AF%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        2019 05 09 ä¸€ä¸ªæˆåŠŸçš„Gitåˆ†æ”¯æ¨¡å‹
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-05-11-%E3%80%8C%E5%8B%BE%E5%8B%BE%E3%80%8D%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8E%E8%B0%B7%E6%AD%8C%E7%9A%84%E6%90%9C%E7%B4%A2%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        2019 05 11 ã€Œå‹¾å‹¾ã€ä¸€ä¸ªåŸºäºè°·æ­Œçš„æœç´¢å·¥å…·
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-05-16-Golang%E5%88%9D%E4%BD%93%E9%AA%8C%E4%B9%8B%E8%A7%A3%E7%BB%84JSON%E5%B9%B6%E5%86%99%E5%85%A5MySQL/" class="md-nav__link">
        2019 05 16 Golangåˆä½“éªŒä¹‹è§£ç»„JSONå¹¶å†™å…¥MySQL
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-05-17-%E4%B8%80%E4%B8%AAShell%E7%AE%A1%E9%81%93%E7%9A%84%E9%A2%98%E7%9B%AE/" class="md-nav__link">
        2019 05 17 ä¸€ä¸ªShellç®¡é“çš„é¢˜ç›®
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-05-20-CentOS%207%20%E7%9A%84%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E6%97%A5%E5%BF%97%E7%9A%84%E5%AF%B9%E7%85%A7/" class="md-nav__link">
        2019 05 20 CentOS 7 çš„å¯åŠ¨è¿‡ç¨‹å’Œæ—¥å¿—çš„å¯¹ç…§
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-05-22-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E3%80%81%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF%E4%B8%8E%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9/" class="md-nav__link">
        2019 05 22 ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ä¸ç¼“å­˜é›ªå´©
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-05-27-Golang%E7%9A%84%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91/" class="md-nav__link">
        2019 05 27 Golangçš„äº¤å‰ç¼–è¯‘
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-05-27-MySQL%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E5%B9%B6%E6%8F%92%E5%85%A5/" class="md-nav__link">
        2019 05 27 MySQLæŸ¥è¯¢æ•°æ®å¹¶æ’å…¥
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-05-27-%E5%AF%B9%E7%A7%B0%E4%B8%8E%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/" class="md-nav__link">
        2019 05 27 å¯¹ç§°ä¸éå¯¹ç§°åŠ å¯†ç®—æ³•
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-06-03-%E5%9C%A8Ubuntu%E4%B8%8A%E4%BD%BF%E7%94%A8Hurricane%20Electric%E7%9A%84IPv6%E9%9A%A7%E9%81%93/" class="md-nav__link">
        2019 06 03 åœ¨Ubuntuä¸Šä½¿ç”¨Hurricane Electricçš„IPv6éš§é“
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-06-03-%E5%9F%BA%E4%BA%8ENginx%E7%9A%84%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" class="md-nav__link">
        2019 06 03 åŸºäºNginxçš„åå‘ä»£ç†
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-06-04-MySQL%E9%9A%8F%E6%9C%BA%E6%9F%A5%E8%AF%A2%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95/" class="md-nav__link">
        2019 06 04 MySQLéšæœºæŸ¥è¯¢ä¸€æ¡è®°å½•
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-06-15-%E5%9F%BA%E4%BA%8EWine%E4%BD%BF%E7%94%A8QQ%E8%BD%BB%E8%81%8A%E7%89%88/" class="md-nav__link">
        2019 06 15 åŸºäºWineä½¿ç”¨QQè½»èŠç‰ˆ
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-06-23-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" class="md-nav__link">
        2019 06 23 å¦‚ä½•å®ç°åˆ†å¸ƒå¼é”
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-07-01-%F0%9F%90%9A%E5%88%9D%E8%AF%86%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/" class="md-nav__link">
        2019 07 01 ğŸšåˆè¯†å¸ƒéš†è¿‡æ»¤å™¨
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-07-02-%F0%9F%97%9C%E5%8E%9F%E5%A7%8B%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%8C%85%E8%A3%85%E7%B1%BB%E5%9E%8B%E5%9C%A8%E8%87%AA%E5%A2%9E%E8%BF%90%E7%AE%97%E4%B8%8A%E7%9A%84%E5%8C%BA%E5%88%AB/" class="md-nav__link">
        2019 07 02 ğŸ—œåŸå§‹ç±»å‹ä¸åŒ…è£…ç±»å‹åœ¨è‡ªå¢è¿ç®—ä¸Šçš„åŒºåˆ«
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-07-20-%F0%9F%94%8D%E5%A6%82%E4%BD%95%E6%AF%94%E8%BE%83%E4%B8%A4%E4%B8%AACollection%E5%90%AB%E6%9C%89%E7%9B%B8%E5%90%8C%E7%9A%84%E5%85%83%E7%B4%A0%E2%80%94%E2%80%94%E6%9D%A5%E8%87%AAApache%20Commons%20Collections%E7%9A%84%E5%AE%9E%E7%8E%B0/" class="md-nav__link">
        2019 07 20 ğŸ”å¦‚ä½•æ¯”è¾ƒä¸¤ä¸ªCollectionå«æœ‰ç›¸åŒçš„å…ƒç´ â€”â€”æ¥è‡ªApache Commons Collectionsçš„å®ç°
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          2019 09 01 ğŸ«ï¼ˆè¯‘ï¼‰Javaå†…å­˜æ¨¡å‹è¯­ä¹‰å­¦
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        2019 09 01 ğŸ«ï¼ˆè¯‘ï¼‰Javaå†…å­˜æ¨¡å‹è¯­ä¹‰å­¦
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    å‰è¨€
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    ä»‹ç»
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#access-atomicity" class="md-nav__link">
    ç¬¬ä¸€éƒ¨åˆ† Access Atomicity
  </a>
  
    <nav class="md-nav" aria-label="ç¬¬ä¸€éƒ¨åˆ† Access Atomicity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    æˆ‘ä»¬æœ‰ä»€ä¹ˆ
  </a>
  
    <nav class="md-nav" aria-label="æˆ‘ä»¬æœ‰ä»€ä¹ˆ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-your-understanding" class="md-nav__link">
    Test Your Understanding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ccvalue-types-and-cc" class="md-nav__link">
    å€¼ç±»å‹å’ŒC/C++ï¼ˆValue Types and C/C++ï¼‰
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jmm-updates" class="md-nav__link">
    JMM Updates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#word-tearing" class="md-nav__link">
    ç¬¬äºŒéƒ¨åˆ† å­—èŠ‚æ’•è£‚ï¼ˆWord Tearingï¼‰
  </a>
  
    <nav class="md-nav" aria-label="ç¬¬äºŒéƒ¨åˆ† å­—èŠ‚æ’•è£‚ï¼ˆWord Tearingï¼‰">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    æˆ‘ä»¬æœ‰ä»€ä¹ˆ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-your-understanding_1" class="md-nav__link">
    Test Your Understanding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cc-layout-control-and-cc" class="md-nav__link">
    å¸ƒå±€æ§åˆ¶å’ŒC/C ++ï¼ˆLayout Control and C/C++ï¼‰
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jmm-updates_1" class="md-nav__link">
    JMM Updates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sc-drf" class="md-nav__link">
    ç¬¬ä¸‰éƒ¨åˆ† SC-DRF
  </a>
  
    <nav class="md-nav" aria-label="ç¬¬ä¸‰éƒ¨åˆ† SC-DRF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    æˆ‘ä»¬æœ‰ä»€ä¹ˆ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java-memory-model" class="md-nav__link">
    Java Memory Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#program-order" class="md-nav__link">
    Program Order
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synchronization-order" class="md-nav__link">
    Synchronization Order
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#happens-before" class="md-nav__link">
    Happens-Before
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#happens-before-publication" class="md-nav__link">
    Happens-Before: Publication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#happens-before-test-your-understanding" class="md-nav__link">
    Happens-Before: Test Your Understanding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jmm-interpretation-roach-motel" class="md-nav__link">
    JMM Interpretation: Roach Motel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-your-understanding_2" class="md-nav__link">
    Test Your Understanding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benchmarks" class="md-nav__link">
    Benchmarks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jmm-updates_2" class="md-nav__link">
    JMM Updates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-iv-out-of-thin-air" class="md-nav__link">
    Part IV: Out of Thin Air
  </a>
  
    <nav class="md-nav" aria-label="Part IV: Out of Thin Air">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    æˆ‘ä»¬æœ‰ä»€ä¹ˆ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oota-and-cc" class="md-nav__link">
    OoTA and C/C++
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jmm-updates_3" class="md-nav__link">
    JMM Updates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-v-finals" class="md-nav__link">
    Part V: Finals
  </a>
  
    <nav class="md-nav" aria-label="Part V: Finals">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-your-basic-understanding" class="md-nav__link">
    Test Your Basic Understanding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-do-we-want" class="md-nav__link">
    What Do We Want
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-do-we-have" class="md-nav__link">
    What Do We Have
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constructive-example" class="md-nav__link">
    Constructive Example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#premature-publication" class="md-nav__link">
    Premature Publication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-your-understanding-tricky" class="md-nav__link">
    Test Your Understanding (tricky)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jmm-updates_4" class="md-nav__link">
    JMM Updates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benchmarks_1" class="md-nav__link">
    Benchmarks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2019-09-23-%F0%9F%A7%B6Java%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%85%B6%E5%AF%B9%E5%BA%94%E7%9A%84Linux%E8%BF%9B%E7%A8%8B%E5%8F%B7/" class="md-nav__link">
        2019 09 23 ğŸ§¶Javaçº¿ç¨‹ä¸å…¶å¯¹åº”çš„Linuxè¿›ç¨‹å·
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2020-01-17-%F0%9F%A7%B7%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF%E5%86%99%E4%BD%9C/" class="md-nav__link">
        2020 01 17 ğŸ§·å…³äºæŠ€æœ¯å†™ä½œ
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2020-01-19-%F0%9F%A7%99%F0%9F%8F%BD%E2%80%8D%E2%99%82%EF%B8%8F%E6%96%B0%E4%BA%BA%E5%92%8C%E9%9D%9E%E6%8A%80%E6%9C%AF%E4%BA%BA%E5%91%98%E4%B9%9F%E8%83%BD%E7%9C%8B%E6%87%82%E7%9A%84%E7%BD%91%E7%AB%99%E5%BA%94%E7%94%A8%E6%8B%93%E5%B1%95/" class="md-nav__link">
        2020 01 19 ğŸ§™ğŸ½â€â™‚ï¸æ–°äººå’ŒéæŠ€æœ¯äººå‘˜ä¹Ÿèƒ½çœ‹æ‡‚çš„ç½‘ç«™åº”ç”¨æ‹“å±•
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2020-04-05-%F0%9F%92%BC%E5%91%BD%E4%BB%A4Command%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%9C%A8%E8%AE%BE%E8%AE%A1API%E6%97%B6%E7%9A%84%E8%BF%90%E7%94%A8/" class="md-nav__link">
        2020 04 05 ğŸ’¼å‘½ä»¤Commandè®¾è®¡æ¨¡å¼åœ¨è®¾è®¡APIæ—¶çš„è¿ç”¨
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2020-06-14-%F0%9F%A7%AF%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%AF%BC%E8%87%B4%E7%9A%84%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81/" class="md-nav__link">
        2020 06 14 ğŸ§¯è®°ä¸€æ¬¡ç¯å¢ƒå˜é‡å¯¼è‡´çš„ä¸­æ–‡ä¹±ç 
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2020-07-11-%F0%9F%9A%87%E5%9F%BA%E4%BA%8Ev2ray%E7%9A%84%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/" class="md-nav__link">
        2020 07 11 ğŸš‡åŸºäºv2rayçš„ç§‘å­¦ä¸Šç½‘
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2020-07-12-%F0%9F%93%9C%E8%AF%BB%E5%8F%96MySQL%E7%9A%84binlog/" class="md-nav__link">
        2020 07 12 ğŸ“œè¯»å–MySQLçš„binlog
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2020-07-19-%F0%9F%93%9D%E5%9F%BA%E4%BA%8ExeCJK%E7%9A%84TeX%E4%B8%AD%E6%96%87%E4%B9%A6%E5%86%99/" class="md-nav__link">
        ğŸ“åŸºäºxeCJKçš„TeXä¸­æ–‡ä¹¦å†™
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2020-10-19-%F0%9F%8F%8E%E5%8D%8F%E5%8F%98%E3%80%81%E9%80%86%E5%8F%98%E4%B8%8E%E4%B8%8D%E5%8F%98/" class="md-nav__link">
        2020 10 19 ğŸåå˜ã€é€†å˜ä¸ä¸å˜
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2020-10-31-%F0%9F%A7%B0Xcode%E4%B8%AD%E5%88%9B%E5%BB%BASwift%20Package%E5%B9%B6%E5%9C%A8Target%E4%B8%AD%E4%BD%BF%E7%94%A8/" class="md-nav__link">
        ğŸ§°Xcodeä¸­åˆ›å»ºSwift Packageå¹¶åœ¨Targetä¸­ä½¿ç”¨
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2021-02-28-%F0%9F%94%A6%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8GDB%E8%B0%83%E8%AF%95Nginx/" class="md-nav__link">
        2021 02 28 ğŸ”¦å¦‚ä½•ä½¿ç”¨GDBè°ƒè¯•Nginx
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2021-05-01-%F0%9F%A7%B0EasyConnect%20in%20Dokcer/" class="md-nav__link">
        2021 05 01 ğŸ§°EasyConnect in Dokcer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2021-07-01-%F0%9F%93%A6VirtualBox%E7%9A%84%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E5%8A%9F%E8%83%BD/" class="md-nav__link">
        2021 07 01 ğŸ“¦VirtualBoxçš„ç«¯å£è½¬å‘åŠŸèƒ½
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2021-07-11-%F0%9F%93%B7%E5%9C%A8%E6%A0%91%E8%8E%93%E6%B4%BE%E4%B8%8A%E8%AE%BF%E9%97%AEiPhone%E6%8B%8D%E6%91%84%E7%9A%84%E7%85%A7%E7%89%87%E4%B8%8E%E8%A7%86%E9%A2%91/" class="md-nav__link">
        2021 07 11 ğŸ“·åœ¨æ ‘è“æ´¾ä¸Šè®¿é—®iPhoneæ‹æ‘„çš„ç…§ç‰‡ä¸è§†é¢‘
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2021-08-30-lsof%E4%B9%8B%E5%A4%96%E7%9A%84%E6%9F%A5%E8%AF%A2%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E6%96%87%E4%BB%B6%E7%9A%84%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%96%B9%E6%B3%95/" class="md-nav__link">
        2021 08 30 lsofä¹‹å¤–çš„æŸ¥è¯¢ä½¿ç”¨æŒ‡å®šæ–‡ä»¶çš„è¿›ç¨‹çš„æ–¹æ³•
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2021-09-02-%F0%9F%93%A6%E5%88%A9%E7%94%A8GitHub%20Actions%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BATeX/" class="md-nav__link">
        2021 09 02 ğŸ“¦åˆ©ç”¨GitHub Actionsè‡ªåŠ¨æ„å»ºTeX
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2021-09-25-%E5%9C%A8macOS%E4%B8%8A%E4%BD%BF%E7%94%A8VS%20Code%E9%98%85%E8%AF%BBOpenJDK%E6%BA%90%E7%A0%81/" class="md-nav__link">
        2021 09 25 åœ¨macOSä¸Šä½¿ç”¨VS Codeé˜…è¯»OpenJDKæºç 
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2022-01-30-%EF%BC%88%E8%AF%91%EF%BC%89%E7%90%86%E8%A7%A3Maven%E7%89%88%E6%9C%AC%E5%8F%B7/" class="md-nav__link">
        ï¼ˆè¯‘ï¼‰ç†è§£Mavenç‰ˆæœ¬å·
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2022-07-02-%E4%BD%BF%E7%94%A8Javac%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B7%A5%E7%A8%8B%E4%BE%9D%E8%B5%96/" class="md-nav__link">
        2022 07 02 ä½¿ç”¨Javacæ—¥å¿—åˆ†æå·¥ç¨‹ä¾èµ–
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2022-09-04-%E5%9F%BA%E4%BA%8Eredsocks2%E5%92%8Cpf%E7%9A%84macOS%E9%80%8F%E6%98%8E%E4%BB%A3%E7%90%86/" class="md-nav__link">
        2022 09 04 åŸºäºredsocks2å’Œpfçš„macOSé€æ˜ä»£ç†
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    å‰è¨€
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    ä»‹ç»
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#access-atomicity" class="md-nav__link">
    ç¬¬ä¸€éƒ¨åˆ† Access Atomicity
  </a>
  
    <nav class="md-nav" aria-label="ç¬¬ä¸€éƒ¨åˆ† Access Atomicity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    æˆ‘ä»¬æœ‰ä»€ä¹ˆ
  </a>
  
    <nav class="md-nav" aria-label="æˆ‘ä»¬æœ‰ä»€ä¹ˆ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-your-understanding" class="md-nav__link">
    Test Your Understanding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ccvalue-types-and-cc" class="md-nav__link">
    å€¼ç±»å‹å’ŒC/C++ï¼ˆValue Types and C/C++ï¼‰
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jmm-updates" class="md-nav__link">
    JMM Updates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#word-tearing" class="md-nav__link">
    ç¬¬äºŒéƒ¨åˆ† å­—èŠ‚æ’•è£‚ï¼ˆWord Tearingï¼‰
  </a>
  
    <nav class="md-nav" aria-label="ç¬¬äºŒéƒ¨åˆ† å­—èŠ‚æ’•è£‚ï¼ˆWord Tearingï¼‰">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    æˆ‘ä»¬æœ‰ä»€ä¹ˆ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-your-understanding_1" class="md-nav__link">
    Test Your Understanding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cc-layout-control-and-cc" class="md-nav__link">
    å¸ƒå±€æ§åˆ¶å’ŒC/C ++ï¼ˆLayout Control and C/C++ï¼‰
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jmm-updates_1" class="md-nav__link">
    JMM Updates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sc-drf" class="md-nav__link">
    ç¬¬ä¸‰éƒ¨åˆ† SC-DRF
  </a>
  
    <nav class="md-nav" aria-label="ç¬¬ä¸‰éƒ¨åˆ† SC-DRF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    æˆ‘ä»¬æœ‰ä»€ä¹ˆ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java-memory-model" class="md-nav__link">
    Java Memory Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#program-order" class="md-nav__link">
    Program Order
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synchronization-order" class="md-nav__link">
    Synchronization Order
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#happens-before" class="md-nav__link">
    Happens-Before
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#happens-before-publication" class="md-nav__link">
    Happens-Before: Publication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#happens-before-test-your-understanding" class="md-nav__link">
    Happens-Before: Test Your Understanding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jmm-interpretation-roach-motel" class="md-nav__link">
    JMM Interpretation: Roach Motel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-your-understanding_2" class="md-nav__link">
    Test Your Understanding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benchmarks" class="md-nav__link">
    Benchmarks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jmm-updates_2" class="md-nav__link">
    JMM Updates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-iv-out-of-thin-air" class="md-nav__link">
    Part IV: Out of Thin Air
  </a>
  
    <nav class="md-nav" aria-label="Part IV: Out of Thin Air">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    æˆ‘ä»¬æœ‰ä»€ä¹ˆ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oota-and-cc" class="md-nav__link">
    OoTA and C/C++
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jmm-updates_3" class="md-nav__link">
    JMM Updates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-v-finals" class="md-nav__link">
    Part V: Finals
  </a>
  
    <nav class="md-nav" aria-label="Part V: Finals">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-your-basic-understanding" class="md-nav__link">
    Test Your Basic Understanding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-do-we-want" class="md-nav__link">
    What Do We Want
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-do-we-have" class="md-nav__link">
    What Do We Have
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constructive-example" class="md-nav__link">
    Constructive Example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#premature-publication" class="md-nav__link">
    Premature Publication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-your-understanding-tricky" class="md-nav__link">
    Test Your Understanding (tricky)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jmm-updates_4" class="md-nav__link">
    JMM Updates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benchmarks_1" class="md-nav__link">
    Benchmarks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>2019 09 01 ğŸ«ï¼ˆè¯‘ï¼‰Javaå†…å­˜æ¨¡å‹è¯­ä¹‰å­¦</h1>

<blockquote>
<p>ç¿»è¯‘è‡ª<a href="https://shipilev.net/blog/2014/jmm-pragmatics/">Java Memory Model Pragmatics (transcript)</a></p>
</blockquote>
<h2 id="_1">å‰è¨€</h2>
<p>Javaå†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼Œä»¥åç®€ç§°<code>JMM</code>ï¼‰æ˜¯Javaè§„èŒƒä¸­æœ€å¤æ‚çš„éƒ¨åˆ†ï¼Œè‡³å°‘å¿…é¡»ç”±ç¨‹åºåº“å’Œè¿è¡Œæ—¶å¼€å‘äººå‘˜ç†è§£ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®ƒçš„æªè¾æ˜¯è¿™æ ·çš„æ™¦æ¶©ï¼Œä»¥è‡³äºå®ƒéœ€è¦ä¸€äº›èµ„æ·±äººå£«ä¸ºå½¼æ­¤ç ´è¯‘å®ƒã€‚å½“ç„¶ï¼Œå¤§å¤šæ•°å¼€å‘äººå‘˜å¹¶æ²¡æœ‰æŒ‰ç…§è§„å®šä½¿ç”¨JMMè§„åˆ™ï¼Œè€Œæ˜¯æ ¹æ®è§„åˆ™åˆ¶å®šä¸€äº›ç»“æ„ï¼Œæˆ–è€…æ›´ç³Ÿç³•çš„æ˜¯ï¼Œç›²ç›®åœ°å¤åˆ¶é«˜çº§å¼€å‘äººå‘˜çš„ç»“æ„è€Œä¸äº†è§£å…¶é€‚ç”¨æ€§çš„é™åˆ¶ã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªæ²¡æœ‰è¿›å…¥æ ¸å¿ƒå¹¶å‘çš„æ™®é€šäººï¼Œä½ å¯ä»¥é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œé˜…è¯»é«˜çº§ä¹¦ç±ï¼Œå¦‚â€œ<a href="http://www.amazon.com/Java-Concurrency-Practice-Brian-Goetz/dp/0321349601">Java Concurrency in Practice</a>â€ã€‚å¦‚æœæ‚¨æ˜¯å¯¹æ‰€æœ‰è¿™äº›å·¥ä½œæ„Ÿå…´è¶£çš„é«˜çº§äººå‘˜ä¹‹ä¸€ï¼Œè¯·ç»§ç»­é˜…è¯»ï¼</p>
<p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘ä»Šå¹´åœ¨ä¸åŒä¼šè®®ä¸Šå‘è¡¨çš„â€œ<a href="http://shipilev.net/#jmm">Java Memory Model Pragmatics</a>â€æ¼”è®²çš„è®°å½•å‰¯æœ¬ï¼Œä¸»è¦æ˜¯ä¿„è¯­ã€‚ä¸–ç•Œä¸Šä¼¼ä¹æä¾›å¯ä»¥å®¹çº³è¿™ä¹ˆé•¿æ—¶é—´çš„è®¨è®ºçš„ä¼šè®®æ•°é‡æœ‰é™ï¼Œå¹¶ä¸”éœ€è¦åœ¨ä»Šå¹´çš„JVMLSä¸Šä¸ºæˆ‘çš„JMMç ”è®¨ä¼šæ­éœ²ä¸€äº›èƒŒæ™¯é˜…è¯»ï¼Œæˆ‘å†³å®šå°†å…¶è½¬å½•ã€‚</p>
<p>æˆ‘ä»¬å°†é‡ç”¨å¾ˆå¤šå¹»ç¯ç‰‡ï¼Œå¹¶ä¸”æˆ‘å°†å°è¯•åŸºäºå®ƒä»¬æ„å»ºå™è¿°ã€‚å½“å¹»ç¯ç‰‡ä¸è¨€è‡ªæ˜æ—¶ï¼Œæœ‰æ—¶å€™æˆ‘ä¼šè·³è¿‡æ²¡æœ‰å™è¿°çš„ã€‚å¹»ç¯ç‰‡æœ‰<a href="http://shipilev.net/talks/narnia-2555-jmm-pragmatics-ru.pdf">ä¿„è¯­</a>å’Œ<a href="http://shipilev.net/talks/narnia-2555-jmm-pragmatics-en.pdf">è‹±è¯­</a>ç‰ˆæœ¬ã€‚ä¸‹é¢çš„å¹»ç¯ç‰‡æ˜¯å…‰æ …åŒ–(rasterized)çš„ï¼Œä½†å…·æœ‰å¾ˆå¥½çš„åŸå§‹åˆ†è¾¨ç‡ã€‚</p>
<p>æˆ‘è¦æ„Ÿè°¢<a href="https://twitter.com/BrianGoetz">Brian Goetz</a>ï¼ŒDoug Leaï¼ŒDavid Holmesï¼Œ<a href="https://twitter.com/kuksenk0">Sergey Kuksenko</a>ï¼ŒDmitry Chyukoï¼Œ<a href="https://twitter.com/AstragaliUSA">Mark Cooper</a>ï¼Œ<a href="https://twitter.com/cscotta">C.Scott Andreas</a>ï¼Œ<a href="https://twitter.com/joejkearney">Joe Kearney</a>ä»¥åŠå…¶ä»–è®¸å¤šäººæä¾›æœ‰ç”¨çš„è¯„è®ºå’Œæ›´æ­£ã€‚å…³äºæœ€ç»ˆå­—æ®µçš„ç¤ºä¾‹éƒ¨åˆ†åŒ…å«ç”±<a href="https://twitter.com/VladimirSitnikv">Vladimir Sitnikov</a>å’ŒValentin Kovalenkoè§£å†³çš„ä¿¡æ¯ï¼Œå¹¶ä¸”æ˜¯ä»–ä»¬å…³äº<a href="http://www.slideshare.net/VladimirSitnikv/final-field-semantics">Final Fields Semantics</a>çš„æ›´å¤§è¯é¢˜çš„æ‘˜å½•ã€‚</p>
<h2 id="_2">ä»‹ç»</h2>
<p><img alt="3b41bd16b95daedf4a57b766.png" src="../assets/img/3b41bd16b95daedf4a57b766.png" /></p>
<p>å¦‚æœæ‚¨é˜…è¯»ä»»ä½•è¯­è¨€è§„èŒƒï¼Œæ‚¨ä¼šå‘ç°å®ƒå¯ä»¥åœ¨é€»è¾‘ä¸Šåˆ’åˆ†ä¸ºä¸¤ä¸ªç›¸å…³ä½†ä¸åŒçš„éƒ¨åˆ†ã€‚é¦–å…ˆï¼Œä¸€ä¸ªéå¸¸ç®€å•çš„éƒ¨åˆ†æ˜¯<code>è¯­æ³•</code>ï¼Œå®ƒæè¿°äº†å¦‚ä½•ç”¨è¯¥è¯­è¨€ç¼–å†™ç¨‹åºã€‚å…¶æ¬¡ï¼Œæœ€å¤§çš„éƒ¨åˆ†æ˜¯<code>è¯­ä¹‰</code>ï¼Œå®ƒå‡†ç¡®æè¿°äº†ç‰¹å®šè¯­æ³•ç»“æ„çš„å«ä¹‰ã€‚è¯­è¨€è§„èŒƒé€šå¸¸é€šè¿‡æ‰§è¡Œç¨‹åºçš„<code>æŠ½è±¡æœºå™¨</code>çš„è¡Œä¸ºæ¥æè¿°è¯­ä¹‰ï¼Œå› æ­¤è¿™ç§è¯­è¨€è§„èŒƒåªæ˜¯ä¸€ä¸ªæŠ½è±¡çš„æœºå™¨è§„èŒƒã€‚</p>
<p><img alt="509a5847067cb4db4baa18f4.png" src="../assets/img/509a5847067cb4db4baa18f4.png" /></p>
<p>å½“æ‚¨çš„è¯­è¨€å…·æœ‰å­˜å‚¨ï¼ˆä»¥å˜é‡ï¼Œå †å†…å­˜ç­‰å½¢å¼ï¼‰æ—¶ï¼ŒæŠ½è±¡æœºå™¨ä¹Ÿå…·æœ‰å­˜å‚¨ï¼Œæ‚¨å¿…é¡»å®šä¹‰ä¸€ç»„æœ‰å…³å­˜å‚¨è¡Œä¸ºçš„è§„åˆ™ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„<code>å†…å­˜æ¨¡å‹</code>ã€‚å¦‚æœæ‚¨çš„è¯­è¨€æ²¡æœ‰æ˜¾å¼å­˜å‚¨ï¼ˆä¾‹å¦‚ï¼Œæ‚¨åœ¨è°ƒç”¨ä¸Šä¸‹æ–‡ä¸­ä¼ é€’æ•°æ®ï¼‰ï¼Œé‚£ä¹ˆæ‚¨çš„å†…å­˜æ¨¡å‹éå¸¸ç®€å•ã€‚åœ¨å­˜å‚¨ç²¾é€šè¯­è¨€ä¸­ï¼Œå†…å­˜æ¨¡å‹ä¼¼ä¹å›ç­”äº†ä¸€ä¸ªç®€å•çš„é—®é¢˜ï¼šâ€œ<code>ç‰¹å®šè¯»å–å¯ä»¥è§‚å¯Ÿåˆ°ä»€ä¹ˆå€¼ï¼Ÿ</code>â€</p>
<p><img alt="688139c179ca4ae9d0da6a8d.png" src="../assets/img/688139c179ca4ae9d0da6a8d.png" /></p>
<p>åœ¨é¡ºåºç¨‹åºä¸­ï¼Œè¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªç©ºæ´çš„é—®é¢˜ï¼šå› ä¸ºä½ æœ‰é¡ºåºç¨‹åºï¼Œæ‰€ä»¥å­˜å‚¨åˆ°å†…å­˜ä¸­çš„æ˜¯æŒ‰ç…§ç»™å®šçš„é¡ºåºè¿›è¡Œçš„ï¼Œå¾ˆæ˜æ˜¾è¯»å–åº”è¯¥æŒ‰é¡ºåºè§‚å¯Ÿæœ€æ–°çš„å†™å…¥ã€‚è¿™å°±æ˜¯äººä»¬é€šå¸¸åªä¸ºå¤šçº¿ç¨‹ç¨‹åºé‡åˆ°å†…å­˜æ¨¡å‹çš„åŸå› ï¼Œè¿™ä¸ªé—®é¢˜å˜å¾—å¤æ‚äº†ã€‚ç„¶è€Œï¼Œå³ä½¿åœ¨è¿ç»­çš„æƒ…å†µä¸‹ï¼Œè®°å¿†æ¨¡å‹ä¹Ÿå¾ˆé‡è¦ï¼ˆå°½ç®¡å®ƒä»¬é€šå¸¸åœ¨<code>è¯„ä¼°é¡ºåº</code>çš„æ¦‚å¿µä¸­å·§å¦™åœ°ä¼ªè£…ï¼‰ã€‚</p>
<p><img alt="7af527b023c36b6c45c609d5.png" src="../assets/img/7af527b023c36b6c45c609d5.png" /></p>
<p>ä¾‹å¦‚ï¼ŒCç¨‹åºä¸­<code>æœªå®šä¹‰è¡Œä¸º</code>çš„è‡­åæ˜­ç€çš„ä¾‹å­ï¼Œå®ƒåœ¨åºåˆ—ç‚¹ä¹‹é—´åŒ…å«ä¸€äº›å¢é‡ã€‚è¯¥ç¨‹åºå¯ä»¥æ»¡è¶³ç»™å®šçš„æ–­è¨€ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿å…¶å¤±è´¥ï¼Œæˆ–ä»¥å…¶ä»–æ–¹å¼å¬å”¤<a href="http://www.catb.org/jargon/html/N/nasal-demons.html">é¼»å­æ¶é­”</a>ã€‚æœ‰äººå¯èƒ½ä¼šäº‰è¾©è¯´ï¼Œè¿™ä¸ªç¨‹åºçš„ç»“æœå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œå› ä¸ºå¢é‡çš„è¯„ä¼°é¡ºåºæ˜¯ä¸åŒçš„ï¼Œä½†å®ƒä¸ä¼šè§£é‡Šï¼Œä¾‹å¦‚ï¼Œ 12çš„ç»“æœï¼Œå½“ä¸¤ä¸ªå¢é‡éƒ½æ²¡æœ‰çœ‹åˆ°å¦ä¸€ä¸ªçš„å†™å…¥å€¼æ—¶ã€‚è¿™æ˜¯å†…å­˜æ¨¡å‹çš„å…³æ³¨ç‚¹ï¼šæ¯ä¸ªå¢é‡åº”è¯¥çœ‹åˆ°ä»€ä¹ˆå€¼ï¼ˆå¹¶ä¸”é€šè¿‡æ‰©å±•ï¼Œå®ƒå°†å­˜å‚¨ä»€ä¹ˆï¼‰ã€‚</p>
<p><img alt="e66756f3ea8bcd5abed4171e.png" src="../assets/img/e66756f3ea8bcd5abed4171e.png" /></p>
<p>æ— è®ºå“ªç§æ–¹å¼ï¼Œå½“æå‡ºå®ç°ç‰¹å®šè¯­è¨€çš„æŒ‘æˆ˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸¤ç§æ–¹å¼ä¹‹ä¸€ï¼šè§£é‡Šæˆ–å°†æŠ½è±¡æœºå™¨ç¼–è¯‘åˆ°ç›®æ ‡ç¡¬ä»¶ã€‚æ— è®ºå¦‚ä½•ï¼Œè§£é‡Šå’Œç¼–è¯‘éƒ½é€šè¿‡<a href="http://en.wikipedia.org/wiki/Partial_evaluation#Futamura_projections">Futamura Projections</a>è¿æ¥ã€‚ å®é™…åº”ç”¨æ˜¯è§£é‡Šå™¨å’Œç¼–è¯‘å™¨éƒ½è´Ÿè´£æ¨¡æ‹ŸæŠ½è±¡æœºå™¨ã€‚ç¼–è¯‘å™¨é€šå¸¸è¢«æŒ‡è´£æç ¸å†…å­˜æ¨¡å‹å’Œå¤šçº¿ç¨‹ç¨‹åºï¼Œä½†è§£é‡Šå™¨ä¹Ÿä¸èƒ½å…ç–«ã€‚æœªèƒ½å°†è§£é‡Šå™¨è¿è¡Œåˆ°æŠ½è±¡æœºå™¨è§„èŒƒå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ¨¡å‹è¿è§„ã€‚æœ€ç®€å•çš„ä¾‹å­ï¼šå°†å­—æ®µå€¼ç¼“å­˜åœ¨è§£é‡Šå™¨ä¸­çš„volatileè¯»å–ä¸Šï¼Œæ‚¨å°±å®Œæˆäº†ã€‚è¿™è®©æˆ‘ä»¬è¿›è¡Œäº†ä¸€æ¬¡æœ‰è¶£çš„æƒè¡¡ã€‚</p>
<p><img alt="e6032322433e6f453bb0fcf5.png" src="../assets/img/e6032322433e6f453bb0fcf5.png" /></p>
<p>ç¼–ç¨‹è¯­è¨€ä»ç„¶éœ€è¦æ™ºèƒ½å¼€å‘äººå‘˜çš„åŸå› æ˜¯æ²¡æœ‰è¶…çº§è®¡ç®—æœºç¼–è¯‘å™¨ã€‚ â€œHyperâ€å¹¶ä¸å¤¸å¼ ï¼šç¼–è¯‘å™¨å·¥ç¨‹ä¸­çš„ä¸€äº›é—®é¢˜æ˜¯ä¸å¯åˆ¤å®šçš„ï¼Œå³ä½¿<code>åœ¨ç†è®ºä¸Š</code>ä¹Ÿæ˜¯ä¸å¯è§£å†³çš„ï¼Œæ›´ä¸ç”¨è¯´åœ¨å®è·µä¸­äº†ã€‚å…¶ä»–æœ‰è¶£çš„é—®é¢˜åœ¨ç†è®ºä¸Šå¯è¡Œï¼Œä½†ä¸å®ç”¨ã€‚å› æ­¤ï¼Œä¸ºäº†ä½¿å®ç”¨ï¼ˆä¼˜åŒ–ï¼‰ç¼–è¯‘å™¨æˆä¸ºå¯èƒ½ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¯­è¨€ä¸­é€ æˆä¸€äº›ä¸ä¾¿ã€‚ç¡¬ä»¶ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› ä¸ºï¼ˆè‡³å°‘å¯¹å›¾çµæœºè€Œè¨€ï¼‰å®ƒåªæ˜¯<code>äºŒæ°§åŒ–ç¡…</code>ä¸­çš„ç®—æ³•ã€‚</p>
<p><img alt="ab622b5b93754989048f22f8.png" src="../assets/img/ab622b5b93754989048f22f8.png" /></p>
<p>ä¸ºäº†è¯¦ç»†è¯´æ˜è¿™ä¸ªæƒ³æ³•ï¼Œå…¶ä½™çš„è®¨è®ºç»“æ„å¦‚ä¸‹ã€‚</p>
<h2 id="access-atomicity">ç¬¬ä¸€éƒ¨åˆ† Access Atomicity</h2>
<h3 id="_3">æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆ</h3>
<p><img alt="6a4eb40df83bfb4e3facdbb7.png" src="../assets/img/6a4eb40df83bfb4e3facdbb7.png" /></p>
<p>åœ¨JMMä¸­æœ€å®¹æ˜“ç†è§£çš„æ˜¯è®¿é—®åŸå­æ€§ä¿è¯ã€‚ä¸ºäº†æˆ–å¤šæˆ–å°‘åœ°ä¸¥æ ¼æŒ‡å®šï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€äº›ç¬¦å·ã€‚åœ¨æ­¤å¹»ç¯ç‰‡çš„ç¤ºä¾‹ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°åŒ…å«ä¸¤åˆ—çš„è¡¨ã€‚è¯¥è¡¨ç¤ºæ³•å¦‚ä¸‹ã€‚æ ‡é¢˜ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½å·²ç»å‘ç”Ÿï¼šæ‰€æœ‰å˜é‡éƒ½å·²å®šä¹‰ï¼Œæ‰€æœ‰åˆå§‹åŒ–çš„å•†åº—éƒ½å·²æäº¤ï¼Œç­‰ç­‰ã€‚åˆ—æ˜¯ä¸åŒçš„çº¿ç¨‹ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<code>çº¿ç¨‹1</code>å°†ä¸€äº›å€¼<code>V2</code>å­˜å‚¨åˆ°å…¨å±€å˜é‡<code>t</code>ä¸­ã€‚<code>çº¿ç¨‹2</code>è¯»å–å˜é‡ï¼Œå¹¶æ–­è¨€è¯»å–å€¼ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¦ç¡®ä¿è¯»å–çº¿ç¨‹ä»…è§‚å¯Ÿå·²çŸ¥å€¼ï¼Œè€Œä¸æ˜¯ä¹‹é—´çš„æŸäº›å€¼ã€‚</p>
<h3 id="_4">æˆ‘ä»¬æœ‰ä»€ä¹ˆ</h3>
<p><img alt="132836c734b709b0eed14e03.png" src="../assets/img/132836c734b709b0eed14e03.png" /></p>
<p>å¯¹äºç†æ™ºçš„ç¼–ç¨‹è¯­è¨€æ¥è¯´ï¼Œè¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„è¦æ±‚ï¼šä½ æ€ä¹ˆå¯èƒ½è¿åè¿™ä¸ªï¼Œä¸ºä»€ä¹ˆï¼Ÿè¿™å°±æ˜¯åŸå› ã€‚ ä¸ºäº†åœ¨å¹¶å‘è®¿é—®ä¸‹ä¿æŒ<code>åŸå­æ€§</code>ï¼Œä½ å¿…é¡»è‡³å°‘è®©æœºå™¨æŒ‡ä»¤ä»¥ç»™å®šå®½åº¦çš„æ“ä½œæ•°æ“ä½œï¼Œå¦åˆ™åŸå­æ€§åœ¨æŒ‡ä»¤çº§åˆ«è¢«ç ´åï¼šå¦‚æœä½ éœ€è¦å°†è®¿é—®åˆ†æˆå‡ ä¸ªå­è®¿é—®ï¼Œå®ƒä»¬å¯ä»¥äº¤é”™ã€‚ä½†å³ä½¿ä½ æœ‰æ‰€éœ€çš„å®½åº¦æŒ‡ä»¤ï¼Œå®ƒä»¬ä»ç„¶å¯ä»¥æ˜¯éåŸå­çš„ï¼šä¾‹å¦‚ï¼Œå¯¹äºPowerPCæ¥è¯´ï¼Œ2å­—èŠ‚å’Œ4å­—èŠ‚è¯»å–çš„åŸå­æ€§ä¿è¯æ˜¯æœªçŸ¥çš„ï¼ˆå®ƒä»¬æš—ç¤ºæ˜¯åŸå­çš„ï¼‰ã€‚</p>
<p><img alt="c2a775e5c1627b44e2425bc6.png" src="../assets/img/c2a775e5c1627b44e2425bc6.png" /></p>
<p>ä½†æ˜¯ï¼Œå¤§å¤šæ•°å¹³å°éƒ½èƒ½ä¿è¯æœ€å¤š32ä½è®¿é—®çš„åŸå­æ€§ã€‚è¿™å°±æ˜¯æˆ‘ä»¬åœ¨JMMä¸­åšå‡º<code>å¦¥å</code>çš„åŸå› ï¼Œå®ƒæ”¾å®½äº†64ä½å€¼çš„åŸå­æ€§ä¿è¯ã€‚å½“ç„¶ï¼Œä»ç„¶å­˜åœ¨å¯¹64ä½å€¼å¼ºåˆ¶æ‰§è¡ŒåŸå­æ€§çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡æ‚²è§‚åœ°è·å–æ›´æ–°å’Œè¯»å–é”å®šï¼Œä½†è¿™å°†ä»˜å‡ºä»£ä»·ï¼Œå› æ­¤æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªé€ƒç”Ÿèˆ±ï¼šç”¨æˆ·å°†volatileæ”¾åœ¨éœ€è¦åŸå­æ€§çš„ä½ç½®ï¼Œå¹¶ä¸”VMå’Œç¡¬ä»¶ååŒå·¥ä½œä»¥ä¿ç•™å®ƒï¼Œæ— è®ºæˆæœ¬æ˜¯å¤šå°‘ã€‚</p>
<p><img alt="6740f3835c0cf497fdc2aafe.png" src="../assets/img/6740f3835c0cf497fdc2aafe.png" /></p>
<p>ä½†æ˜¯ï¼Œåœ¨å¤§å¤šæ•°ç¡¬ä»¶ä¸Šï¼Œä½¿ç”¨æ‰€éœ€å®½åº¦çš„æ“ä½œæ¥ç»´æŒåŸå­æ€§æ˜¯ä¸å¤Ÿçš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ•°æ®è®¿é—®å¯¼è‡´å¤šä¸ªäº‹åŠ¡åˆ°å†…å­˜ï¼Œåˆ™å³ä½¿æˆ‘ä»¬æ‰§è¡Œäº†å•ä¸ªè®¿é—®æŒ‡ä»¤ï¼ŒåŸå­æ€§ä¹Ÿä¼šå…³é—­ã€‚ä¾‹å¦‚ï¼Œåœ¨x86ä¸­ï¼Œå¦‚æœè¯»/å†™è·¨è¶Šä¸¤ä¸ªé«˜é€Ÿç¼“å­˜è¡Œï¼Œåˆ™ä¸ä¿è¯åŸå­æ€§ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸¤ä¸ªå†…å­˜äº‹åŠ¡ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆé€šå¸¸åªæœ‰å¯¹é½çš„è¯»/å†™æ˜¯åŸå­çš„ï¼Œè¿™è¿«ä½¿VMå¯¹é½ï¼ˆalignï¼‰æ•°æ®ã€‚</p>
<p>åœ¨è¿™ä¸ªç”±<a href="http://openjdk.java.net/projects/code-tools/jol/">JOL</a>æ‰“å°çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨å¯¹è±¡startçš„åç§»é‡16å¤„åˆ†é…äº†é•¿å­—æ®µã€‚ä¸8å­—èŠ‚çš„å¯¹è±¡å¯¹é½ç›¸ç»“åˆï¼Œæˆ‘ä»¬å…·æœ‰å®Œç¾å¯¹é½çš„é•¿åº¦ã€‚ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“å®ƒä¸æ˜¯æ˜“å¤±æ€§çš„è¯ï¼Œå®ƒå°±ä¸ä¼šè¿åå†…å­˜æ¨¡å‹ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“å®ƒä¸æ˜¯æ˜“å¤±æ€§çš„ï¼Œé‚£åªèƒ½åœ¨x86ä¸Šè¿è¡Œï¼ˆå…¶ä»–å¹³å°åœ¨æ‰§è¡Œé”™ä½è®¿é—®æ—¶å¯èƒ½ä¼šéå¸¸ä¸åŒæ„ï¼‰ï¼Œå¹¶ä¸”å¯èƒ½å­˜åœ¨æ€§èƒ½åŠ£åŠ¿ã€‚</p>
<h4 id="test-your-understanding">Test Your Understanding</h4>
<p><img alt="0fe1a67a52fa8ed3a622b009.png" src="../assets/img/0fe1a67a52fa8ed3a622b009.png" /></p>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„æµ‹éªŒæ¥æµ‹è¯•æˆ‘ä»¬çš„ç†è§£ã€‚è®¾ç½®<code>-1L</code>ç›¸å½“äºå°†æ‰€æœ‰ä½è®¾ç½®ä¸º1ã€‚ ç­”æ¡ˆï¼ˆé€‰æ‹©è¿‡æ¥æ­ç¤ºï¼‰ï¼šä¸æ¶‰åŠä»»ä½•é­”æ³•; <code>AtomicLong</code>å†…éƒ¨çš„ä¸€ä¸ªä¸ç¨³å®šçš„é•¿åœºä¿è¯äº†è¿™ä¸€ç‚¹ã€‚è¿™æ˜¯è¯­è¨€è§„èŒƒæ‰€è¦æ±‚çš„ï¼Œå¹¶ä¸”æ­¤ç¤ºä¾‹æ— éœ€å¯¹VMç«¯çš„<code>AtomicLong</code>è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚</p>
<h4 id="ccvalue-types-and-cc">å€¼ç±»å‹å’ŒC/C++ï¼ˆValue Types and C/C++ï¼‰</h4>
<p><img alt="465215c3ba0fbd6c9f410d1d.png" src="../assets/img/465215c3ba0fbd6c9f410d1d.png" /></p>
<p>åœ¨Javaä¸­ï¼Œæˆ‘ä»¬â€œå¹¸è¿â€æ‹¥æœ‰å†…ç½®ç±»å‹çš„å°å®½åº¦ã€‚åœ¨æä¾›å€¼ç±»å‹çš„å…¶ä»–è¯­è¨€ä¸­ï¼Œç±»å‹å®½åº¦æ˜¯ä»»æ„çš„ï¼Œè¿™ç»™å†…å­˜æ¨¡å‹å¸¦æ¥äº†æœ‰è¶£çš„æŒ‘æˆ˜ã€‚</p>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<code>C++</code>é€šè¿‡æ”¯æŒç»“æ„æ¥éµå¾ªCå…¼å®¹æ€§ã€‚ <code>C++11</code>è¿˜æ”¯æŒ<code>std::atomic</code>ï¼Œå®ƒéœ€è¦æ¯ä¸ªæ™®é€šæ—§æ•°æ®ï¼ˆPODï¼‰ç±»å‹Tçš„è®¿é—®åŸå­æ€§ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬åœ¨<code>C++11</code>ä¸­åšè¿™æ ·çš„æŠ€å·§ï¼Œé‚£ä¹ˆå®ç°å°†è¢«è¿«å¤„ç†åŸå­å†™å…¥å¹¶è¯»å–<code>104å­—èŠ‚</code>çš„å†…å­˜å—ã€‚æ²¡æœ‰æœºå™¨æŒ‡ä»¤å¯ä»¥ä¿è¯è¿™äº›å®½åº¦çš„åŸå­æ€§ï¼Œå› æ­¤å®ç°åº”è¯¥é‡‡ç”¨<code>CAS-ing</code>æˆ–<code>é”å®š</code>æˆ–å…¶ä»–æ–¹å¼ã€‚</p>
<p>ï¼ˆå®ƒå˜å¾—æ›´æœ‰è¶£ï¼Œå› ä¸º<code>C++</code>å…è®¸å•ç‹¬ç¼–è¯‘ï¼šç°åœ¨<code>é“¾æ¥å™¨</code>çš„ä»»åŠ¡æ˜¯ç¡®å®šè¿™ä¸ªç‰¹å®šçš„<code>std::atomic</code>ä½¿ç”¨äº†ä»€ä¹ˆ<code>é”/CASä¿æŠ¤</code>ã€‚æˆ‘ä¸å®Œå…¨ç¡®å®šå¦‚æœçº¿ç¨‹æ‰§è¡Œçš„è¯ä¼šå‘ç”Ÿä»€ä¹ˆä¸Šä¾‹ä¸­ä¸åŒç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ã€‚ï¼‰</p>
<h4 id="jmm-updates">JMM Updates</h4>
<p>æœ¬èŠ‚ä»‹ç»æ›´æ–°çš„Javaå†…å­˜æ¨¡å‹çš„åŸå­æ€§æ³¨æ„äº‹é¡¹ã€‚è¯·åœ¨<a href="http://shipilev.net/blog/2014/all-accesses-are-atomic/">å¦ä¸€ç¯‡æ–‡ç« </a>ä¸­æŸ¥çœ‹æ›´å…¨é¢çš„è§£é‡Šã€‚</p>
<p><img alt="e7b28909ca3b0bf30f553786.png" src="../assets/img/e7b28909ca3b0bf30f553786.png" /></p>
<p>2014å¹´ï¼Œæˆ‘ä»¬æ˜¯å¦è¦é‡æ–°è€ƒè™‘64ä½å¼‚å¸¸ï¼Ÿå½“<code>longå’Œdouble</code>çš„ç«äº‰æ›´æ–°æœ‰æ„ä¹‰æ—¶ï¼Œå¾ˆå°‘æœ‰ç”¨ä¾‹ã€‚åœ¨å¯æ‰©å±•çš„æ¦‚ç‡è®¡æ•°å™¨ä¸­ã€‚å¼€å‘äººå‘˜å¯èƒ½æœ‰ç†ç”±å¸Œæœ›<code>long/doubleè®¿é—®</code>åœ¨64ä½å¹³å°ä¸Šæ˜¯åŸå­çš„ï¼Œä½†æ˜¯å¦‚æœä»£ç æ˜¯åœ¨32ä½å¹³å°ä¸Šæ„å¤–è¿è¡Œçš„è¯ï¼Œå®ƒä»¬ä»éœ€è¦<code>volatile</code>ã€‚æ ‡è®°å­—æ®µvolatileä¼šæ”¯ä»˜å†…å­˜éšœç¢ï¼ˆmemory barriersï¼‰çš„æˆæœ¬ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œç”±äºvolatileé‡è½½äº†ä¸¤ä¸ªå«ä¹‰ï¼š</p>
<ol>
<li>è®¿é—®åŸå­æ€§;</li>
<li>å†…å­˜æ’åº</li>
</ol>
<p>ä½ ä¸èƒ½å¾—åˆ°ä¸€ä¸ªæ²¡æœ‰å¦ä¸€ä¸ªä½œä¸ºè¡Œæã€‚å¯ä»¥æ¨æµ‹åˆ é™¤64ä½å¼‚å¸¸çš„æˆæœ¬ã€‚ç”±äºVMé€šè¿‡å‘å‡ºç‰¹æ®ŠæŒ‡ä»¤åºåˆ—æ¥åˆ†åˆ«å¤„ç†è®¿é—®åŸå­æ€§ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨éœ€è¦æ—¶å°†VMç ´è§£ä¸ºæ— æ¡ä»¶åœ°å‘å‡ºåŸå­æŒ‡ä»¤åºåˆ—ã€‚</p>
<p><img alt="f214420f1f943b23b2382958.png" src="../assets/img/f214420f1f943b23b2382958.png" /></p>
<p>ç†è§£æ­¤å›¾è¡¨éœ€è¦ä¸€äº›æ—¶é—´ã€‚æˆ‘ä»¬å¯ä»¥æµ‹é‡longsçš„è¯»å–å’Œå†™å…¥ - æ¯ç§è®¿é—®æ¨¡å¼ä¸‰æ¬¡ï¼ˆ<code>plain</code>ï¼Œ<code>volatile</code>å’Œé€šè¿‡ <code>Unsafe.putOrdered</code>ï¼‰ã€‚å¦‚æœæˆ‘ä»¬æ­£ç¡®åœ°å®ç°è¯¥åŠŸèƒ½ï¼Œé‚£ä¹ˆåœ¨64ä½å¹³å°ä¸Šåº”è¯¥æ²¡æœ‰åŒºåˆ«ï¼Œå› ä¸ºè®¿é—®å·²ç»æ˜¯åŸå­çš„ã€‚å®é™…ä¸Šï¼Œ64ä½Ivy Bridgeä¸Šçš„å½©è‰²æ¡ä¹‹é—´æ²¡æœ‰åŒºåˆ«ã€‚ æ³¨æ„<code>volatile long</code>å†™çš„é‡é‡çº§æ˜¯å¤šå°‘ã€‚å¦‚æœæˆ‘åªæƒ³è¦åŸå­æ€§ï¼Œæˆ‘ä¼šä¸ºå†…å­˜æ’åºæ”¯ä»˜è¿™ç¬”æˆæœ¬ã€‚</p>
<p><img alt="ac625f6840abb651bf010ff6.png" src="../assets/img/ac625f6840abb651bf010ff6.png" /></p>
<p>å¤„ç†32ä½å¹³å°æ—¶ä¼šå˜å¾—æ›´åŠ å¤æ‚ã€‚åœ¨é‚£é‡Œï¼Œæ‚¨éœ€è¦æ³¨å…¥ç‰¹æ®Šçš„æŒ‡ä»¤åºåˆ—æ¥è·å¾—<code>åŸå­æ€§</code>ã€‚åœ¨x86çš„æƒ…å†µä¸‹ï¼Œå³ä½¿åœ¨32ä½å¹³å°ä¸­ï¼Œ<code>FPUåŠ è½½/å­˜å‚¨</code>ä¹Ÿæ˜¯64ä½å®½ã€‚æ‚¨æ”¯ä»˜â€œå†—ä½™â€å‰¯æœ¬çš„è´¹ç”¨ï¼Œä½†ä¸æ˜¯é‚£ä¹ˆå¤šã€‚</p>
<p><img alt="f1db92d0ce6d3f1f3d7efc01.png" src="../assets/img/f1db92d0ce6d3f1f3d7efc01.png" /></p>
<p>åœ¨éx86å¹³å°ä¸Šï¼Œæˆ‘ä»¬è¿˜å¿…é¡»ä½¿ç”¨æ›¿ä»£æŒ‡ä»¤åºåˆ—æ¥é‡æ–°è·å¾—<code>åŸå­æ€§</code>ï¼Œå¹¶å…·æœ‰<code>å¯é¢„æµ‹</code>çš„æ€§èƒ½å½±å“ã€‚è¯·æ³¨æ„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒåŒæ ·åœ¨32ä½x86çš„æƒ…å†µä¸‹ï¼Œvolatileé€šè¿‡å¼ºåˆ¶åŸå­æ€§ç¨å¾®æ…¢ä¸€ç‚¹ï¼Œä½†è¿™æ˜¯ç³»ç»Ÿé”™è¯¯ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜éœ€è¦å°†å€¼è½¬å‚¨åˆ°<code>long</code>å­—æ®µä¸­ä»¥é˜²æ­¢æŸäº›ç¼–è¯‘å™¨ä¼˜åŒ–ã€‚</p>
<h2 id="word-tearing">ç¬¬äºŒéƒ¨åˆ† å­—èŠ‚æ’•è£‚ï¼ˆWord Tearingï¼‰</h2>
<h3 id="_5">æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆ</h3>
<p><img alt="1b892bc0c2b1abaa8b6103f3.png" src="../assets/img/1b892bc0c2b1abaa8b6103f3.png" /></p>
<p>å­—èŠ‚æ’•è£‚ä¸è®¿é—®åŸå­æ€§æœ‰å…³ã€‚ å¦‚æœä¸¤ä¸ªå˜é‡æ˜¯ä¸åŒçš„ï¼Œé‚£ä¹ˆå¯¹å®ƒä»¬çš„æ“ä½œä¹Ÿåº”è¯¥æ˜¯ä¸åŒçš„ï¼Œå¹¶ä¸”ä¸åº”å—ç›¸é‚»å…ƒç´ ä¸Šçš„æ“ä½œçš„å½±å“ã€‚è¿™ä¸ªä¾‹å­å¦‚ä½•æ‰“ç ´ï¼Ÿéå¸¸ç®€å•ï¼šå¦‚æœæˆ‘ä»¬çš„ç¡¬ä»¶æ— æ³•è®¿é—®ä¸åŒçš„æ•°ç»„å…ƒç´ ï¼Œå®ƒå°†è¢«å¼ºåˆ¶è¯»å–å¤šä¸ªå…ƒç´ ï¼Œä¿®æ”¹ä¸€å †ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åå°†æ•´ä¸ªå…ƒç´ æ”¾å›å»ã€‚</p>
<p>å¦‚æœä¸¤ä¸ªçº¿ç¨‹åœ¨å®ƒä»¬å„è‡ªçš„å…ƒç´ ä¸Šè¿›è¡Œç›¸åŒçš„danceï¼Œåˆ™å¯èƒ½ä¼šå‘ç”Ÿå¦ä¸€ä¸ªçº¿ç¨‹å°†å…¶è‡ªå·±çš„æ­¥éª¤å­˜å‚¨å›å†…å­˜ï¼Œä»è€Œè¦†ç›–ç”±ç¬¬ä¸€ä¸ªçº¿ç¨‹æ›´æ–°çš„å…ƒç´ ã€‚å¯¹äºæ¯«æ— æˆ’å¿ƒçš„ç”¨æˆ·è€Œè¨€ï¼Œè¿™å¯èƒ½å¹¶ä¸”å°†ä¼šå¼•èµ·å¾ˆå¤šéº»çƒ¦ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰è¯­è¨€è§„èŒƒä¸­çš„æ˜ç¡®è§„å®šï¼Œè¿è¡Œæ—¶å¯ä»¥è‡ªç”±åœ°åº”ç”¨å¯èƒ½å¯¼è‡´éš¾ä»¥è¯Šæ–­çš„é”™è¯¯çš„è½¬æ¢ã€‚</p>
<h3 id="_6">æˆ‘ä»¬æœ‰ä»€ä¹ˆ</h3>
<p><img alt="61844ba2dfa85643c50f3702.png" src="../assets/img/61844ba2dfa85643c50f3702.png" /></p>
<p>å¦‚æœæˆ‘ä»¬æƒ³ç¦æ­¢å­—èŠ‚æ’•è£‚ï¼Œæˆ‘ä»¬éœ€è¦ç¡¬ä»¶æ”¯æŒç»™å®šå®½åº¦çš„è®¿é—®ã€‚åœ¨<code>boolean[]</code>æ•°ç»„æˆ–ä¸€ç»„å¸ƒå°”å­—æ®µçš„æœ€ç®€å•åœºæ™¯ä¸­ï¼Œæ‚¨æ— æ³•åœ¨å¤§å¤šæ•°ç¡¬ä»¶ä¸Šè½»æ¾è®¿é—®å•ä¸ªå†…å­˜ä½ï¼Œå› ä¸ºè¾ƒä½çš„å¯å¯»å€æ€§è¾¹ç•Œé€šå¸¸æ˜¯å•ä¸ªå­—èŠ‚ã€‚</p>
<p><img alt="e4b2602b204cfede6b598bf5.png" src="../assets/img/e4b2602b204cfede6b598bf5.png" /></p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›å¤©ä½ å¿…é¡»å‘ç¨‹åºå‘˜è§£é‡Šå­—èŠ‚æ’•è£‚ã€‚å¤§å¤šæ•°ç³»ç»Ÿç¨‹åºå‘˜ä»å‰å‡ å¤©éƒ½éå¸¸ç†Ÿæ‚‰å®ƒï¼Œå¹¶ä¸”ç†è§£åœ¨çœŸå®ç³»ç»Ÿä¸­è¿½é€è¿™æ ·ä¸€ä¸ªbugçš„ææ€–ã€‚</p>
<p>å› æ­¤ï¼ŒJavaï¼Œç›®æ ‡æ˜¯ä¸€ç§ç†æ™ºçš„è¯­è¨€ï¼Œç¦æ­¢å­—èŠ‚æ’•è£‚ã€‚Bill Pughï¼ˆFindBugsæ˜¯ä»–æœ€æœ‰ç‰¹è‰²çš„ä½œå“ï¼Œä½†ä»–ä¹Ÿæ˜¯<code>JMM JSR 133</code>çš„é¢†å¯¼è€…ï¼‰å¯¹æ­¤<a href="http://www.cs.umd.edu/~pugh/java/memoryModel/archive/0978.html">éå¸¸æ¸…æ¥š</a>ã€‚æˆ‘æ›¾ç»åœ¨C++ç¨‹åºä¸­è¿½é€ä¸€ä¸ªç ´åå­—çš„é”™è¯¯ - ä¸æ˜¯å¾ˆæœ‰è¶£ã€‚</p>
<p>è¿™ä¸ªè¦æ±‚ä¼¼ä¹å¾ˆå®¹æ˜“é€‚åº”å½“å‰çš„ç¡¬ä»¶ï¼šæ‚¨å¯èƒ½å…³å¿ƒçš„å”¯ä¸€æ•°æ®ç±»å‹æ˜¯<code>å¸ƒå°”å€¼</code>ï¼Œæ‚¨å¯èƒ½å¸Œæœ›é‡‡ç”¨<code>å®Œæ•´å­—èŠ‚</code>è€Œä¸æ˜¯<code>å•ä¸ªä½</code>ã€‚å½“ç„¶ï¼Œæ‚¨è¿˜éœ€è¦é©¯æœä»»ä½•å¯èƒ½ç¼“å†²è¯»å–å’Œå†™å…¥ä»¥åŠç›¸é‚»æ•°æ®çš„ç¼–è¯‘å™¨ä¼˜åŒ–ã€‚</p>
<p><img alt="8bc47506daffb3eb62176767.png" src="../assets/img/8bc47506daffb3eb62176767.png" /></p>
<p>å¤§å¤šæ•°äººåœ¨æ–‡æ¡£ä¸­æŸ¥æ‰¾å…è®¸çš„<code>åŸºç¡€ç±»å‹å€¼</code>èŒƒå›´ï¼Œå¹¶ä»é‚£é‡Œæ¨æ–­æœºå™¨è¡¨ç¤ºå®½åº¦ã€‚æ‚¨åªèƒ½è¡¨ç¤ºæœ€å°æœºå™¨å®½åº¦æ¥è¡¨ç¤ºï¼Œä¾‹å¦‚longæœ‰<code>2^64</code>ä¸ªæ¡ˆä¾‹ã€‚å®ƒå¹¶ä¸å¼ºåˆ¶è¿è¡Œæ—¶å®é™…ä¸ºæ¯ä¸ªlongåˆ†é…8ä¸ªå­—èŠ‚;å®ƒåŸåˆ™ä¸Šå¯ä»¥ä½¿ç”¨<code>128å­—èŠ‚é•¿</code>ï¼Œåªè¦å®ƒæœ‰ä¸€äº›å¥‡æ€ªçš„åŸå› æ˜¯<code>å®ç”¨</code>çš„ã€‚ ä½†æ˜¯ï¼Œæˆ‘æ‰€çŸ¥é“çš„å¤§å¤šæ•°è¿è¡Œæ—¶éƒ½æ˜¯å®ç”¨çš„ï¼Œå¹¶ä¸”<code>æœºå™¨è¡¨ç¤ºå®½åº¦</code>éå¸¸é€‚åˆ<code>å€¼åŸŸ</code>ï¼Œä¸ä¼šæµªè´¹ç©ºé—´ã€‚æ­£å¦‚æˆ‘ä¹‹å‰æ‰€è¯´ï¼Œbooleanæ˜¯è¿™æ¡è§„åˆ™çš„å”¯ä¸€ä¾‹å¤–ã€‚ JOLè¯•å›¾æ‰¾å‡ºå®é™…çš„æœºå™¨å®½åº¦ï¼Œä½ å¯ä»¥åœ¨è¿™å¼ å¹»ç¯ç‰‡ä¸Šçœ‹åˆ°åˆ»åº¦ã€‚è¿™äº›æ•°å­—åˆ†åˆ«æ˜¯<code>å¼•ç”¨ï¼Œbooleanï¼Œbyteï¼Œshortï¼Œcharï¼Œintï¼Œfloatï¼Œlongå’Œdouble</code>æ‰€å çš„å­—èŠ‚æ•° - æ­£æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„é‚£æ ·ã€‚å…¶ä»–å¹³å°å¯èƒ½è¢«è®¤ä¸º......å¾ˆ<a href="http://parleys.com/play/5298f999e4b039ad2298c9e3/chapter27/agenda#">å¥‡æ€ª</a>ã€‚</p>
<h3 id="test-your-understanding_1">Test Your Understanding</h3>
<p><img alt="d284127ddb673b1475c7e0eb.png" src="../assets/img/d284127ddb673b1475c7e0eb.png" /></p>
<p>ç­”æ¡ˆï¼ˆé€‰æ‹©ç»“æŸæ˜¾ç¤ºï¼‰ï¼šä»»ä½•ï¼ˆçœŸï¼ŒçœŸï¼‰ï¼Œï¼ˆå‡ï¼ŒçœŸï¼‰ï¼Œï¼ˆçœŸï¼Œå‡ï¼‰ï¼Œå› ä¸º<code>BitSet</code>å¯†é›†å­˜å‚¨åœ¨<code>long[]</code>æ•°ç»„ä¸­çš„ä½å¹¶ä½¿ç”¨ä½é­”æœ¯æ¥è®¿é—®ç‰¹å®šä½ã€‚å®ƒåœ¨å†…å­˜å ç”¨æ–¹é¢è·å¾—äº†å·¨å¤§çš„æˆåŠŸï¼Œå®ƒæ‘†è„±äº†è¯­è¨€çš„è¯­è¨€ä¿è¯ã€‚ ï¼ˆBitSet Javadocsè¯´å¤šçº¿ç¨‹ç”¨æ³•åº”è¯¥æ˜¯<code>åŒæ­¥</code>çš„ï¼Œæ‰€ä»¥è¿™å¯ä»¥è¯´æ˜¯ä¸€ä¸ªäººä¸ºçš„ä¾‹å­ï¼‰</p>
<h3 id="cc-layout-control-and-cc">å¸ƒå±€æ§åˆ¶å’ŒC/C ++ï¼ˆLayout Control and C/C++ï¼‰</h3>
<p><img alt="882b75173616ab4617515fcd.png" src="../assets/img/882b75173616ab4617515fcd.png" /></p>
<p>ç›¸å½“å¤šçš„äººå¸Œæœ›æ§åˆ¶ç‰¹å®šç±»çš„å†…å­˜å¸ƒå±€ï¼Œä»¥ä¾¿åœ¨è¾¹ç¼˜æƒ…å†µä¸‹è·å¾—æ›´å¥½çš„å ç”¨ç©ºé—´ï¼Œå’Œ/æˆ–æ›´å¥½çš„æ€§èƒ½ã€‚ä½†æ˜¯åœ¨ä¸€ç§å…è®¸å¯¹å…¶å˜é‡è¿›è¡Œä»»æ„å¸ƒå±€çš„è¯­è¨€ä¸­ï¼Œæ‚¨ä¸èƒ½å§‹ç»ˆç¦æ­¢å­—èŠ‚æ’•è£‚ï¼Œå› ä¸ºæ‚¨å¿…é¡»ä»˜å‡ºä»£ä»·ï¼Œå¦‚æœ¬ç¤ºä¾‹æ‰€ç¤ºã€‚</p>
<p>æ²¡æœ‰æœºå™¨æŒ‡ä»¤å¯ä»¥ä¸€æ¬¡å†™å…¥7ä½ï¼Œæˆ–è€…ä¸€æ¬¡åªèƒ½è¯»å–3ä½ï¼Œå› æ­¤å¦‚æœå®ƒä»¬çš„ä»»åŠ¡æ˜¯é¿å…å­—èŠ‚æ’•è£‚ï¼Œåˆ™éœ€è¦å®ç°åˆ›é€ æ€§ã€‚ <code>C/C++ 11</code>å…è®¸ä½ ä½¿ç”¨è¿™ä¸ªé”‹åˆ©çš„å·¥å…·ï¼Œä½†å‘Šè¯‰ä½ ï¼Œä¸€æ—¦ä½ å¼€å§‹ï¼Œä½ å°±æ˜¯ä½ è‡ªå·±ã€‚</p>
<h3 id="jmm-updates_1">JMM Updates</h3>
<p><img alt="ce0c9955a84fab2671c3192c.png" src="../assets/img/ce0c9955a84fab2671c3192c.png" /></p>
<p>æ²¡æœ‰äººè´¨ç–‘å­—èŠ‚æ’•è£‚åº”è¯¥è¢«ç¦æ­¢ã€‚</p>
<h2 id="sc-drf">ç¬¬ä¸‰éƒ¨åˆ† SC-DRF</h2>
<h3 id="_7">æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆ</h3>
<p><img alt="bb7200c0b1a6e0a492440e63.png" src="../assets/img/bb7200c0b1a6e0a492440e63.png" /></p>
<p>ç°åœ¨æˆ‘ä»¬å¼€å§‹è®¨è®ºå†…å­˜æ¨¡å‹ä¸­æœ€æœ‰è¶£çš„éƒ¨åˆ†ï¼šå…³äºç¨‹åºè¯»å–çš„æ¨ç†ã€‚å¾ˆè‡ªç„¶åœ°è®¤ä¸ºç¨‹åºæ­£åœ¨ä»¥æŸç§å…¨å±€é¡ºåºæ‰§è¡Œå®ƒä»¬çš„è¯­å¥ï¼Œæœ‰æ—¶åœ¨çº¿ç¨‹ä¹‹é—´åˆ‡æ¢ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ¨¡å‹ï¼ŒLamportå·²ç»ä¸ºæˆ‘ä»¬å®šä¹‰äº†å®ƒï¼š<code>é¡ºåºä¸€è‡´æ€§</code>ã€‚</p>
<p><img alt="d075b7ecd17bdf22fea2f1c8.png" src="../assets/img/d075b7ecd17bdf22fea2f1c8.png" /></p>
<p>æ³¨æ„çªå‡ºæ˜¾ç¤ºã€‚é¡ºåºä¸€è‡´æ€§å¹¶ä¸æ„å‘³ç€æ“ä½œæ˜¯æŒ‰ç‰¹å®šçš„<code>æ€»é¡ºåºï¼ˆtotal orderï¼‰</code>æ‰§è¡Œçš„ï¼ ï¼ˆæ›´ä¸¥æ ¼çš„ä¸€è‡´æ€§æä¾›äº†è¿™ä¸€ç‚¹ï¼‰ã€‚é‡è¦çš„æ˜¯ï¼Œç»“æœä¸å…·æœ‰æ€»æ“ä½œé¡ºåºçš„æ‰§è¡Œæ— æ³•åŒºåˆ†ï¼ˆindistinguishableï¼‰ã€‚æˆ‘ä»¬å°†æ‰§è¡Œç§°ä¸º<code>é¡ºåºä¸€è‡´çš„æ‰§è¡Œï¼ˆsequentially consistent executionsï¼‰</code>ï¼Œå¹¶å°†å…¶ç»“æœç§°ä¸º<code>é¡ºåºä¸€è‡´çš„ç»“æœï¼ˆsequentially consistent resultsï¼‰</code>ã€‚</p>
<p><img alt="f0f4ed133a7958a0899bb4aa.png" src="../assets/img/f0f4ed133a7958a0899bb4aa.png" /></p>
<p>SCæ˜¾ç„¶ä¸ºæˆ‘ä»¬æä¾›äº†ä¼˜åŒ–ä»£ç çš„æœºä¼šã€‚ç”±äºæˆ‘ä»¬ä¸å—å®é™…æ€»æ‰§è¡Œé¡ºåºçš„çº¦æŸï¼Œä½†åªéœ€å‡è£…æœ‰ä¸€ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œæœ‰è¶£çš„ä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼Œè¿™ä¸ªç¨‹åºè½¬æ¢ä¸ä¼šç ´åSCï¼šæ˜¾ç„¶åŸå§‹ç¨‹åºçš„SCæ‰§è¡Œä¼šäº§ç”Ÿç›¸åŒçš„ç»“æœï¼ˆå‡è®¾æ²¡æœ‰äººå…³å¿ƒaå’Œbçš„å€¼ï¼‰ã€‚</p>
<p>è¯·æ³¨æ„ï¼ŒSCå…è®¸æˆ‘ä»¬ç¼©å°å¯èƒ½çš„æ‰§è¡Œé›†ã€‚åœ¨æç«¯æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±é€‰æ‹©å•ä¸ªè®¢å•å¹¶åšæŒä¸‹å»ã€‚</p>
<h3 id="_8">æˆ‘ä»¬æœ‰ä»€ä¹ˆ</h3>
<p><img alt="d2ea37200a00229c06de43c9.png" src="../assets/img/d2ea37200a00229c06de43c9.png" /></p>
<p>ä½†æ˜¯ï¼ŒSCçš„å¯ä¼˜åŒ–æ€§è¢«é«˜ä¼°äº†ã€‚è¯·æ³¨æ„ï¼Œå½“å‰çš„ä¼˜åŒ–ç¼–è¯‘å™¨ï¼Œæ›´ä¸ç”¨è¯´ç¡¬ä»¶ï¼Œåªå…³å¿ƒå½“å‰çš„æŒ‡ä»¤æµã€‚é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬åœ¨æŒ‡ä»¤æµä¸­æœ‰ä¸¤ä¸ªè¯»å–ï¼Œæˆ‘ä»¬å¯ä»¥åƒåœ¨è¿™ä¸ªä¾‹å­ä¸­é‚£æ ·å¯¹å®ƒä»¬è¿›è¡Œé‡æ–°æ’åºå¹¶ç»´æŠ¤SCå—ï¼Ÿ</p>
<p><img alt="f5c1687dd605b8d6bf8d9a9a.png" src="../assets/img/f5c1687dd605b8d6bf8d9a9a.png" /></p>
<p>äº‹å®è¯æ˜ï¼Œä½ åšä¸åˆ°ã€‚å¦‚æœç¨‹åºçš„å¦ä¸€éƒ¨åˆ†å°†å€¼å­˜å‚¨åˆ°<code>a</code>å’Œ<code>b</code>ä¸­ï¼Œåˆ™è¯»å–é‡æ–°æ’åºä¼šç ´åSCã€‚å®é™…ä¸Šï¼Œåœ¨SCä¸‹æ‰§è¡Œçš„åŸå§‹ç¨‹åºåªèƒ½å¾—åˆ°åŒ¹é…<code>ï¼ˆ*ï¼Œ2ï¼‰</code>æˆ–<code>ï¼ˆ0ï¼Œ*ï¼‰</code>çš„ç»“æœï¼Œä½†ä¿®æ”¹åçš„ç¨‹åºï¼Œå³ä½¿ä»¥æ€»é¡ºåºæ–¹å¼æ‰§è¡Œï¼Œä¹Ÿä¼šäº§ç”Ÿ<code>ï¼ˆ1,0ï¼‰</code>ï¼Œä»¤äººå›°æƒ‘çš„å¼€å‘äººå‘˜æœŸæœ›SCæ¥è‡ªä»–ä»¬çš„ä»£ç ã€‚</p>
<p><img alt="4d5c47dfa8db5bc65f27d6ca.png" src="../assets/img/4d5c47dfa8db5bc65f27d6ca.png" /></p>
<p>é‚£ä¹ˆï¼Œä½ å¯ä»¥çœ‹å‡ºï¼Œå³ä½¿æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„è½¬æ¢ä¹Ÿæ˜¯åˆç†çš„ï¼Œä½ éœ€è¦å¤æ‚çš„åˆ†æï¼Œè€Œè¿™ç§åˆ†æå¹¶ä¸å®¹æ˜“æ‰©å±•åˆ°ç°å®çš„ç¨‹åºã€‚ä»ç†è®ºä¸Šè®²ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªå¯ä»¥æ‰§è¡Œæ­¤åˆ†æçš„æ™ºèƒ½å…¨å±€ä¼˜åŒ–å™¨ï¼ˆGMOï¼‰ã€‚æˆ‘è®¤ä¸ºè½¬åŸºå› ç”Ÿç‰©çš„å­˜åœ¨ä¸æ‹‰æ™®æ‹‰æ–¯çš„æ¶é­”çš„å­˜åœ¨å¯†åˆ‡ç›¸å…³ã€‚</p>
<p>ä½†ç”±äºæˆ‘ä»¬æ²¡æœ‰è½¬åŸºå› ç”Ÿç‰©ï¼ˆGMOï¼‰ï¼Œæ‰€ä»¥æ‰€æœ‰çš„ä¼˜åŒ–éƒ½æ˜¯ä¿å®ˆçš„ï¼Œå› ä¸ºæ‹…å¿ƒæ— æ„ä¸­è¿åäº†SCï¼Œè¿™ä¼šå¯¼è‡´æ€§èƒ½æŸå¤±ã€‚æ‰€ä»¥å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä¸è¿›è¡Œè½¬å‹ï¼Œå¯¹å§ï¼Ÿä¸å¤ªå¯èƒ½ï¼šå³ä½¿æ˜¯éå¸¸åŸºæœ¬çš„è½¬å˜ä¹Ÿæ˜¯è¢«ç¦æ­¢çš„ã€‚æƒ³ä¸€æƒ³ï¼šå¦‚æœæœ‰æ•ˆåœ°æ¶ˆé™¤äº†ç¨‹åºä¸­å…¶ä»–åœ°æ–¹çš„è¯»å–ï¼Œå³é‡æ–°æ’åºï¼Œä½ èƒ½æŠŠå˜é‡æ”¾åœ¨å¯„å­˜å™¨ä¸Šå—ï¼Ÿ</p>
<p><img alt="2e968afa47893785a898c1ea.png" src="../assets/img/2e968afa47893785a898c1ea.png" /></p>
<p>...è™½ç„¶æˆ‘ä»¬å¯ä»¥ç¦æ­¢ç¼–è¯‘å™¨ä¸­çš„ä¸€äº›ä¼˜åŒ–ä»¥é˜»æ­¢åœ¨å…¶ä»–SCç¨‹åºä¸­é€ æˆä¸¥é‡ç ´åï¼Œä½†ç¡¬ä»¶æ— æ³•è½»æ˜“åå•†ã€‚ç¡¬ä»¶å·²ç»é‡æ–°å®‰æ’äº†è®¸å¤šä¸œè¥¿ï¼Œå¹¶æä¾›æ˜‚è´µçš„é€ƒç”Ÿèˆ±ï¼ˆescape hatchesï¼‰ä»¥æå“é‡æ–°æ’åºï¼ˆâ€œå†…å­˜å±éšœâ€ï¼‰ã€‚å› æ­¤ï¼Œä¸€ä¸ªä¸èƒ½æ§åˆ¶å¯èƒ½è½¬æ¢çš„æ¨¡å‹ä»¥åŠé¼“åŠ±è¿›è¡Œå“ªäº›ä¼˜åŒ–çš„æ¨¡å‹å®é™…ä¸Šå¹¶ä¸èƒ½ä»¥è‰¯å¥½çš„æ€§èƒ½è¿è¡Œã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬è¦æ±‚è¯­è¨€ä¸­çš„é¡ºåºä¸€è‡´æ€§ï¼Œæˆ‘ä»¬å¯èƒ½ä¸å¾—ä¸æ‚²è§‚åœ°å›´ç»•å‡ ä¹æ¯ä¸€æ¬¡å†…å­˜è®¿é—®å‘å‡ºå†…å­˜éšœç¢ï¼Œä»¥ä¾¿æ€æ­»ç¡¬ä»¶å°è¯•â€œä¼˜åŒ–â€ã€‚</p>
<p><img alt="70afdafbe0dbbbb91e7586be.png" src="../assets/img/70afdafbe0dbbbb91e7586be.png" /></p>
<p>æ­¤å¤–ï¼Œå¦‚æœæ‚¨çš„ç¨‹åºåŒ…å«<code>ç«äº‰</code>ï¼Œåˆ™å½“å‰ç¡¬ä»¶ä¸ä¿è¯è¿™äº›å†²çªæ“ä½œçš„ä»»ä½•ç‰¹å®šç»“æœã€‚ Hans Boehmå’ŒSarita Adve<a href="http://soft.vub.ac.be/races/wp-content/uploads/2012/09/races2012_submission_3.pdf">åšå®šä¸ç§»</a>ã€‚</p>
<p><img alt="d0bf4d21d71f71e40699f22a.png" src="../assets/img/d0bf4d21d71f71e40699f22a.png" /></p>
<p>å› æ­¤ï¼Œä¸ºäº†å°†ç°å®èå…¥åˆ°å…·æœ‰åˆç†æ€§èƒ½çš„æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å‰Šå¼±å®ƒã€‚</p>
<h3 id="java-memory-model">Java Memory Model</h3>
<p><img alt="ab72f983ba7cdfb0dc595b20.png" src="../assets/img/ab72f983ba7cdfb0dc595b20.png" /></p>
<p>è¿™æ˜¯äº‹æƒ…å˜å¾—æ›´åŠ å¤æ‚çš„åœ°æ–¹ã€‚ç”±äºè¯­è¨€è§„èŒƒåº”è¯¥æ¶µç›–è¯­è¨€ä¸­å¯ä»¥è¡¨è¾¾çš„æ‰€æœ‰å¯èƒ½çš„ç¨‹åºï¼Œæˆ‘ä»¬æ— æ³•çœŸæ­£æä¾›æœ‰é™æ•°é‡çš„ç»“æ„ï¼Œè¿™äº›ç»“æ„å¯ä»¥ä¿è¯å·¥ä½œï¼šå®ƒä»¬çš„è”åˆå°†åœ¨è¯­ä¹‰ä¸Šç•™ä¸‹ç™½ç‚¹ï¼Œå¹¶ä¸”ç™½ç‚¹æ˜¯åçš„ã€‚ å› æ­¤ï¼ŒJMMè¯•å›¾ç«‹å³æ¶µç›–æ‰€æœ‰å¯èƒ½çš„ç¨‹åºã€‚å®ƒé€šè¿‡æè¿°æŠ½è±¡ç¨‹åºå¯ä»¥æ‰§è¡Œçš„æ“ä½œæ¥å®ç°ï¼Œå¹¶ä¸”è¿™äº›æ“ä½œæè¿°äº†åœ¨æ‰§è¡Œç¨‹åºæ—¶å¯ä»¥äº§ç”Ÿå“ªäº›ç»“æœã€‚æ“ä½œåœ¨æ‰§è¡Œä¸­ç»‘å®šåœ¨ä¸€èµ·ï¼Œæ‰§è¡Œå°†æ“ä½œä¸æè¿°æ“ä½œå…³ç³»çš„å…¶ä»–è®¢å•ç»„åˆåœ¨ä¸€èµ·ã€‚è¿™æ„Ÿè§‰éå¸¸è±¡ç‰™å¡”å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬é©¬ä¸Šå°±å»çœ‹çœ‹å§ã€‚</p>
<h3 id="program-order">Program Order</h3>
<p><img alt="affde6f4972c8b447afd0c4b.png" src="../assets/img/affde6f4972c8b447afd0c4b.png" /></p>
<p>ç¬¬ä¸€ä¸ªè®¢å•æ˜¯ç¨‹åºè®¢å•ï¼ˆPOï¼‰ã€‚å®ƒåœ¨å•ä¸ªçº¿ç¨‹ä¸­å¯¹æ“ä½œè¿›è¡Œæ’åºã€‚æ³¨æ„åŸå§‹ç¨‹åºï¼Œä»¥åŠè¯¥ç¨‹åºå¯èƒ½çš„æ‰§è¡Œä¹‹ä¸€ã€‚åœ¨é‚£é‡Œï¼Œç¨‹åºå¯ä»¥ä»xè¯»å–1ï¼Œé€šè¿‡elseåˆ†æ”¯è¯»å–ï¼Œå°†1å­˜å‚¨åˆ°zï¼Œç„¶åç»§ç»­ä»yè¯»å–å†…å®¹ã€‚</p>
<p><img alt="b565f98bdeceb7a39a72b512.png" src="../assets/img/b565f98bdeceb7a39a72b512.png" /></p>
<p>ç¨‹åºé¡ºåºæ˜¯æ€»è®¡ï¼ˆåœ¨ä¸€ä¸ªçº¿ç¨‹å†…ï¼‰ï¼Œå³æ¯å¯¹åŠ¨ä½œä¸è¯¥é¡ºåºç›¸å…³ã€‚äº†è§£ä¸€äº›äº‹æƒ…å¾ˆé‡è¦ã€‚</p>
<p>æŒ‰ç¨‹åºé¡ºåºé“¾æ¥åœ¨ä¸€èµ·çš„æ“ä½œä¸æ’é™¤â€œé‡æ–°æ’åºâ€ã€‚äº‹å®ä¸Šï¼Œè°ˆè®ºè¡ŒåŠ¨çš„é‡æ–°æ’åºæœ‰ç‚¹ä»¤äººå›°æƒ‘ï¼Œå› ä¸ºäººä»¬å¯èƒ½æ‰“ç®—åœ¨ç¨‹åºä¸­è°ˆè®ºå£°æ˜é‡æ–°æ’åºï¼Œè¿™ä¼šäº§ç”Ÿæ–°çš„æ‰§è¡Œã€‚é‚£ä¹ˆè¿™ä¸ªæ–°è®¡åˆ’äº§ç”Ÿçš„æ‰§è¡Œæ˜¯å¦è¿åäº†JMMçš„è§„å®šå°†æ˜¯ä¸€ä¸ªæ‚¬è€Œæœªå†³çš„é—®é¢˜ã€‚</p>
<p>ç¨‹åºé¡ºåºæ²¡æœ‰ï¼Œæˆ‘å†è¯´ä¸€éï¼Œä¸æä¾›è®¢è´­ä¿è¯ã€‚å®ƒå­˜åœ¨çš„å”¯ä¸€åŸå› æ˜¯æä¾›å¯èƒ½çš„æ‰§è¡Œå’ŒåŸå§‹ç¨‹åºä¹‹é—´çš„é“¾æ¥ã€‚</p>
<p><img alt="2723aa028053e36342a72db5.png" src="../assets/img/2723aa028053e36342a72db5.png" /></p>
<p>è¿™å°±æ˜¯æˆ‘ä»¬çš„æ„æ€ã€‚ç»™å®šåŠ¨ä½œå’Œæ‰§è¡Œçš„ç®€å•ç¤ºæ„å›¾ï¼Œæ‚¨å¯ä»¥æ„é€ æ— é™æ•°é‡çš„æ‰§è¡Œã€‚è¿™äº›å¤„å†³è„±ç¦»äº†ä»»ä½•ç°å®;å®ƒä»¬åªæ˜¯â€œåŸå§‹æ±¤â€ï¼ŒåŒ…å«ä¸€åˆ‡å¯èƒ½çš„å»ºç­‘ã€‚åœ¨è¿™ä¸ªæ±¤çš„æŸä¸ªåœ°æ–¹æµ®åŠ¨å¯ä»¥è§£é‡Šç»™å®šç¨‹åºçš„ç‰¹å®šç»“æœçš„æ‰§è¡Œï¼Œä»¥åŠæ‰€æœ‰è¿™äº›åˆç†æ‰§è¡Œçš„é›†åˆæ¶µç›–äº†è¯¥ç¨‹åºçš„æ‰€æœ‰åˆç†ç»“æœã€‚</p>
<p><img alt="02feaaea8ee2261bfa49630d.png" src="../assets/img/02feaaea8ee2261bfa49630d.png" /></p>
<p>è¿™æ˜¯ç¨‹åºé¡ºåºï¼ˆPOï¼‰è·³å…¥çš„åœ°æ–¹ã€‚ä¸ºäº†è¿‡æ»¤æ‰æˆ‘ä»¬å¯ä»¥ç†è§£ç‰¹å®šç¨‹åºçš„æ‰§è¡Œï¼Œæˆ‘ä»¬æœ‰çº¿ç¨‹å†…ä¸€è‡´æ€§è§„åˆ™ï¼Œå®ƒæ¶ˆé™¤äº†æ‰€æœ‰ä¸ç›¸å…³çš„æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå°½ç®¡æ‰€ç¤ºçš„æ‰§è¡Œæ˜¯æŠ½è±¡å¯èƒ½çš„ï¼Œä½†å®ƒä¸åŸå§‹ç¨‹åºæ— å…³ï¼šåœ¨ä»xè¯»å–2ä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥å†™å…¥1åˆ°yï¼Œè€Œä¸æ˜¯zã€‚</p>
<p><img alt="d071aa8fb61066a5f0f6518c.png" src="../assets/img/d071aa8fb61066a5f0f6518c.png" /></p>
<p>ä»¥ä¸‹æ˜¯æˆ‘ä»¬å¦‚ä½•è¯´æ˜è¿™ç§è¿‡æ»¤ã€‚çº¿ç¨‹å†…ä¸€è‡´æ€§æ˜¯ç¬¬ä¸€ä¸ªæ‰§è¡Œè¿‡æ»¤å™¨ï¼Œå¤§å¤šæ•°äººåœ¨å¤„ç†JMMæ—¶éƒ½ä¼šéšå«åœ¨å…¶ä¸­ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šä½ å¯èƒ½ä¼šæ³¨æ„åˆ°JMMæ˜¯ä¸€ä¸ªéå»ºè®¾æ€§çš„æ¨¡å‹ï¼šæˆ‘ä»¬ä¸æ˜¯å½’çº³åœ°å»ºç«‹è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯é‡‡ç”¨æ•´ä¸ªæ‰§è¡Œé¢†åŸŸï¼Œå¹¶è¿‡æ»¤æ‰é‚£äº›å¯¹æˆ‘ä»¬æ„Ÿå…´è¶£çš„ä¸œè¥¿ã€‚</p>
<h3 id="synchronization-order">Synchronization Order</h3>
<p><img alt="1f126306277da84ab6399f37.png" src="../assets/img/1f126306277da84ab6399f37.png" /></p>
<p>ç°åœ¨æˆ‘ä»¬å¼€å§‹æ„å»ºçœŸæ­£å‘½ä»¤çš„æ¨¡å‹çš„ä¸€éƒ¨åˆ†ã€‚åœ¨å¼±å†…å­˜æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šå¯¹æ‰€æœ‰æ“ä½œè¿›è¡Œæ’åºï¼Œæˆ‘ä»¬åªå¯¹ä¸€äº›æœ‰é™çš„åŸºå…ƒå¼ºåŠ ä¸€ä¸ªç¡¬å‘½ä»¤ã€‚åœ¨JMMä¸­ï¼Œè¿™äº›åŸè¯­åŒ…å«åœ¨å„è‡ªçš„åŒæ­¥æ“ä½œä¸­ã€‚</p>
<p><img alt="050a98f31c8515f6ae342114.png" src="../assets/img/050a98f31c8515f6ae342114.png" /></p>
<p>åŒæ­¥é¡ºåºï¼ˆSOï¼‰æ˜¯è·¨è¶Šæ‰€æœ‰åŒæ­¥æ“ä½œçš„æ€»é¡ºåºã€‚ä½†è¿™ä¸æ˜¯å…³äºè¿™ä¸ªè®¢å•æœ€æœ‰è¶£çš„éƒ¨åˆ†ã€‚ JMMæä¾›äº†ä¸¤ä¸ªé¢å¤–çš„çº¦æŸï¼šSO-POä¸€è‡´æ€§å’ŒSOä¸€è‡´æ€§ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è§£åŒ…è¿™äº›çº¦æŸã€‚</p>
<p><img alt="e6bd5ec29bad39038f74f291.png" src="../assets/img/e6bd5ec29bad39038f74f291.png" /></p>
<p>è¿™æ˜¯ä¸€ä¸ªæºè‡ª<a href="http://en.wikipedia.org/wiki/Dekker%27s_algorithm">Dekker Lock</a>çš„ç›¸å½“ç®€å•çš„ä¾‹å­ã€‚è¯•ç€æƒ³ä¸€ä¸‹å…è®¸çš„ç»“æœå’ŒåŸå› ã€‚ä¹‹åï¼Œæˆ‘ä»¬å°†ç»§ç»­ä½¿ç”¨JMMè¿›è¡Œåˆ†æã€‚</p>
<p>ä¸‹é¢çš„å¹»ç¯ç‰‡æ˜¯ä¸è¨€è‡ªæ˜çš„ï¼Œæˆ‘ä»¬å°†è·³è¿‡å®ƒä»¬ï¼š</p>
<p><img alt="6d16eff0547d7b34c9d2016c.png" src="../assets/img/6d16eff0547d7b34c9d2016c.png" /></p>
<p><img alt="6e5ed59805209ba33ca152f0.png" src="../assets/img/6e5ed59805209ba33ca152f0.png" /></p>
<p><img alt="c6fd7a1d661d31ab1b5fcc52.png" src="../assets/img/c6fd7a1d661d31ab1b5fcc52.png" /></p>
<p><img alt="c224555abe6e1d1b302e5a9e.png" src="../assets/img/c224555abe6e1d1b302e5a9e.png" /></p>
<p><img alt="a8c63270830a54dac01fb87e.png" src="../assets/img/a8c63270830a54dac01fb87e.png" /></p>
<p><img alt="25c8b97a8b40d0385ad84434.png" src="../assets/img/25c8b97a8b40d0385ad84434.png" /></p>
<p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æ›´ä»”ç»†åœ°ç ”ç©¶è¿™äº›è§„åˆ™ï¼Œæˆ‘ä»¬ä¼šæ³¨æ„åˆ°ä¸€ä¸ªæœ‰è¶£çš„å±æ€§ã€‚ SO-POä¸€è‡´æ€§å‘Šè¯‰æˆ‘ä»¬SOä¸­çš„æ•ˆæœæ˜¯å¯è§çš„ï¼Œå¥½åƒåŠ¨ä½œæ˜¯æŒ‰ç¨‹åºé¡ºåºå®Œæˆçš„ã€‚ SOä¸€è‡´æ€§å‘Šè¯‰æˆ‘ä»¬è¦è§‚å¯ŸSOä¹‹å‰çš„æ‰€æœ‰åŠ¨ä½œï¼Œå³ä½¿æ˜¯é‚£äº›å‘ç”Ÿåœ¨ä¸åŒçº¿ç¨‹ä¸­çš„åŠ¨ä½œã€‚å°±å¥½åƒSO-POä¸€è‡´æ€§å‘Šè¯‰æˆ‘ä»¬éµå¾ªç¨‹åºï¼ŒSOä¸€è‡´æ€§å…è®¸æˆ‘ä»¬â€œåœ¨çº¿ç¨‹ä¹‹é—´åˆ‡æ¢â€ï¼Œæ‰€æœ‰æ•ˆæœéƒ½è½åäºæˆ‘ä»¬ã€‚ä¸SOçš„æ•´ä½“æ··åˆï¼Œæˆ‘ä»¬å¾—å‡ºä¸€ä¸ªæœ‰è¶£çš„è§„åˆ™ï¼š</p>
<p><img alt="9aa57b5d48a51ea0fe528819.png" src="../assets/img/9aa57b5d48a51ea0fe528819.png" /></p>
<p><code>åŒæ­¥æ“ä½œï¼ˆSynchronization Actions ï¼‰</code>æ˜¯<code>é¡ºåºä¸€è‡´ï¼ˆsequentially consistentï¼‰</code>çš„ã€‚åœ¨ç”±<code>volatiles</code>ç»„æˆçš„ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ²¡æœ‰æ·±æ€ç†Ÿè™‘çš„æƒ…å†µä¸‹æ¨æ–­ç»“æœã€‚ç”±äº<code>SAs</code>æ˜¯<code>SC</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ æ‰€æœ‰çš„åŠ¨ä½œäº¤é”™ï¼Œå¹¶ä»ä¸­æ‰¾å‡ºç»“æœã€‚è¯·æ³¨æ„ï¼Œä¹‹å‰æ²¡æœ‰â€œå…ˆå‘ç”Ÿè¿‡ï¼ˆhappens beforeï¼‰â€;è¿™è¶³ä»¥è¯´æ˜åŸå› ã€‚</p>
<p><img alt="b4eb66013e77473505dd2dd3.png" src="../assets/img/b4eb66013e77473505dd2dd3.png" /></p>
<p>IRIWï¼ˆIndependent Reads of Independent Writesï¼‰æ˜¯SOå±æ€§çš„å¦ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚åŒæ ·ï¼Œæ‰€æœ‰æ“ä½œéƒ½ä¼šäº§ç”ŸåŒæ­¥æ“ä½œã€‚å¯ä»¥é€šè¿‡æšä¸¾ç¨‹åºè¯­å¥çš„æ‰€æœ‰äº¤é”™æ¥ç”Ÿæˆç»“æœã€‚è¯¥ç»“æ„ä»…ç¦æ­¢å•ä¸ªå››è¾¹å½¢ï¼Œå°±å¥½åƒæˆ‘ä»¬åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­è§‚å¯Ÿåˆ°xå’Œyåœ¨ä¸åŒé¡ºåºä¸­çš„å†™å…¥ä¸€æ ·ã€‚</p>
<p>çœŸæ­£çš„å…³é”®ç”±<code>Hans Boehm</code>æ€»ç»“äº†ã€‚å¦‚æœä½ é‡‡ç”¨ä»»æ„ç¨‹åºï¼Œæ— è®ºå®ƒåŒ…å«å¤šå°‘ç«äº‰ï¼Œå¹¶åœ¨è¯¥ç¨‹åºå‘¨å›´æ’’ä¸Šè¶³å¤Ÿçš„volatileï¼Œå®ƒæœ€ç»ˆä¼šå˜å¾—é¡ºåºä¸€è‡´ï¼Œå³ç¨‹åºçš„æ‰€æœ‰ç»“æœéƒ½å°†ç”±æŸäº›SCæ‰§è¡Œæ¥è§£é‡Šã€‚è¿™æ˜¯å› ä¸ºå½“æ‰€æœ‰é‡è¦çš„ç¨‹åºæ“ä½œå˜æˆåŒæ­¥æ“ä½œå¹¶ä¸”å˜å¾—å®Œå…¨æœ‰åºæ—¶ï¼Œæ‚¨æœ€ç»ˆä¼šé‡åˆ°å…³é”®æ—¶åˆ»ï¼ˆCritical momentï¼‰ã€‚</p>
<p><img alt="e2cdc9f549ceb0c0a3cf6c25.png" src="../assets/img/e2cdc9f549ceb0c0a3cf6c25.png" /></p>
<p>ä»¥æˆ‘ä»¬çš„ç»´æ©å›¾ç»“æŸï¼ŒSOä¸€è‡´æ€§è¿‡æ»¤æ‰åŒæ­¥â€œéª¨æ¶â€çš„æ‰§è¡Œã€‚æ‰€æœ‰å‰©ä½™æ‰§è¡Œçš„ç»“æœå¯ä»¥é€šè¿‡åŒæ­¥åŠ¨ä½œçš„ç¨‹åºé¡ºåºä¸€è‡´äº¤é”™æ¥è§£é‡Šã€‚</p>
<h3 id="happens-before">Happens-Before</h3>
<p><img alt="e8545e4faf894729f48d4d68.png" src="../assets/img/e8545e4faf894729f48d4d68.png" /></p>
<p>è™½ç„¶ä¸ºæ¨ç†é¡¹ç›®æä¾›äº†è‰¯å¥½çš„åŸºç¡€ï¼Œä½†SOè¿˜ä¸è¶³ä»¥æ„å»ºä¸€ä¸ªå®ç”¨çš„å¼±æ¨¡å‹ã€‚è¿™å°±æ˜¯åŸå› ã€‚</p>
<p><img alt="781b50f884593ab2adcdcc34.png" src="../assets/img/781b50f884593ab2adcdcc34.png" /></p>
<p>è®©æˆ‘ä»¬åˆ†æä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹ã€‚é‰´äºè¿„ä»Šä¸ºæ­¢æˆ‘ä»¬æ‰€å­¦åˆ°çš„å…³äºSOçš„æ‰€æœ‰çŸ¥è¯†ï¼Œæˆ‘ä»¬æ˜¯å¦çŸ¥é“æ˜¯å¦å…è®¸ï¼ˆ1,0ï¼‰ç»“æœï¼Ÿ</p>
<p><img alt="948c637c4dfc4f4702ee4a5d.png" src="../assets/img/948c637c4dfc4f4702ee4a5d.png" /></p>
<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹ã€‚ç”±äºSOåªé€šè¿‡gå‘½ä»¤åŠ¨ä½œï¼Œæ‰€ä»¥æ²¡æœ‰ä»€ä¹ˆèƒ½é˜»æ­¢æˆ‘ä»¬ä»xè¯»å–0æˆ–1ã€‚å...</p>
<p><img alt="0ced789433188d597d857bea.png" src="../assets/img/0ced789433188d597d857bea.png" /></p>
<p>æˆ‘ä»¬éœ€è¦ä¸€äº›ä¸œè¥¿æ¥è¿æ¥çº¿ç¨‹çŠ¶æ€ï¼Œè¿™å°†æ‹–åŠ¨éSAå€¼ã€‚ SOä¸é€‚ç”¨äºæ­¤ï¼Œå› ä¸ºä¸æ¸…æ¥šå®ƒä½•æ—¶ä»¥åŠå¦‚ä½•æ‹–å»¶çŠ¶æ€ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ˜ç¡®çš„SOå­åºåˆ—æ¥æè¿°æ•°æ®æµã€‚æˆ‘ä»¬ç§°æ­¤å­é¡ºåºä¸é¡ºåºï¼ˆSWï¼‰åŒæ­¥ã€‚</p>
<p><img alt="837891e0920489b2e37b2dbc.png" src="../assets/img/837891e0920489b2e37b2dbc.png" /></p>
<p>æ„å»ºSWéå¸¸å®¹æ˜“ã€‚ SWæ˜¯éƒ¨åˆ†é¡ºåºï¼Œå¹¶ä¸è·¨è¶Šæ‰€æœ‰åŒæ­¥æ“ä½œå¯¹ã€‚ä¾‹å¦‚ï¼Œå³ä½¿æ­¤å¹»ç¯ç‰‡ä¸Šçš„gä¸Šçš„ä¸¤ä¸ªæ“ä½œéƒ½åœ¨SOä¸­ï¼Œå®ƒä»¬ä¹Ÿä¸åœ¨SWä¸­ã€‚</p>
<p><img alt="a60dd9beefa73718b87c78da.png" src="../assets/img/a60dd9beefa73718b87c78da.png" /></p>
<p>SWä»…é…å¯¹å½¼æ­¤â€œçœ‹åˆ°â€çš„ç‰¹å®šåŠ¨ä½œã€‚æ›´æ­£å¼åœ°è¯´ï¼Œå¯¹gçš„æ˜“å¤±æ€§å†™å…¥ä¸æ¥è‡ªgçš„æ‰€æœ‰åç»­è¯»å–åŒæ­¥ã€‚ â€œåç»­â€æ˜¯æ ¹æ®SOå®šä¹‰çš„ï¼Œå› æ­¤ç”±äºSOçš„ä¸€è‡´æ€§ï¼Œ1çš„å†™å…¥ä»…ä¸1çš„è¯»å–åŒæ­¥ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸¤ä¸ªåŠ¨ä½œä¹‹é—´çš„SWã€‚æ­¤å­é¡ºåºä¸ºæˆ‘ä»¬æä¾›äº†çº¿ç¨‹ä¹‹é—´çš„â€œæ¡¥æ¢â€ï¼Œä½†é€‚ç”¨äºåŒæ­¥æ“ä½œã€‚è®©æˆ‘ä»¬å°†å…¶æ‰©å±•åˆ°å…¶ä»–è¡ŒåŠ¨ã€‚</p>
<p><img alt="9e0105a263d94dcb69f1b7ba.png" src="../assets/img/9e0105a263d94dcb69f1b7ba.png" /></p>
<p>çº¿ç¨‹å†…è¯­ä¹‰ç”±ç¨‹åºé¡ºåºæè¿°ã€‚è¿™é‡Œæ˜¯ã€‚</p>
<p><img alt="c58c15cd1e7273fc1aab39b8.png" src="../assets/img/c58c15cd1e7273fc1aab39b8.png" /></p>
<p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æ„é€ POå’ŒSWé¡ºåºçš„å¹¶é›†ï¼Œç„¶å<code>ä¼ é€’å…³é—­ï¼ˆ[transitively close](http://en.wikipedia.org/wiki/Transitive_closure)ï¼‰</code>è¯¥è”åˆï¼Œæˆ‘ä»¬å¾—åˆ°æ´¾ç”Ÿçš„é¡ºåºï¼šHappens-Beforeï¼ˆHBï¼‰ã€‚åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šï¼ŒHBè·å–çº¿ç¨‹é—´å’Œçº¿ç¨‹å†…è¯­ä¹‰ã€‚ POå°†æœ‰å…³æ¯ä¸ªçº¿ç¨‹å†…çš„é¡ºåºæ“ä½œçš„ä¿¡æ¯æ³„æ¼åˆ°HBä¸­ï¼Œå¹¶ä¸”å½“çŠ¶æ€â€œåŒæ­¥â€æ—¶SWæ³„æ¼ã€‚ HBæ˜¯éƒ¨åˆ†é¡ºåºï¼Œå…è®¸ä½¿ç”¨é‡æ–°æ’åºçš„æ“ä½œæ„é€ ç­‰æ•ˆæ‰§è¡Œã€‚</p>
<p><img alt="94bea81ab0ca9d4815621617.png" src="../assets/img/94bea81ab0ca9d4815621617.png" /></p>
<p>å‘ç”Ÿä¹‹å‰è¿˜æœ‰å¦ä¸€ä¸ªä¸€è‡´æ€§è§„åˆ™ã€‚è®°ä½SOä¸€è‡´æ€§è§„åˆ™ï¼Œå®ƒè§„å®šåŒæ­¥æ“ä½œåº”è¯¥åœ¨SOä¸­çœ‹åˆ°æœ€æ–°çš„ç›¸å…³å†™å…¥ã€‚å‘ç”Ÿä¹‹å‰çš„ä¸€è‡´æ€§åœ¨åº”ç”¨ç¨‹åºä¸­ç±»ä¼¼äºHBé¡ºåºï¼šå®ƒè§„å®šäº†ç‰¹å®šè¯»å–å¯ä»¥è§‚å¯Ÿåˆ°çš„å†™å…¥ã€‚</p>
<p><img alt="7835275a184e4980bf2de726.png" src="../assets/img/7835275a184e4980bf2de726.png" /></p>
<p>HBä¸€è‡´æ€§åœ¨å…è®¸ç«äº‰ä¸­å¾ˆæœ‰æ„æ€ã€‚å¦‚æœæ²¡æœ‰æ¯”èµ›ï¼Œæˆ‘ä»¬åªèƒ½çœ‹åˆ°HBä¸­æœ€æ–°çš„å‰ä¸€æ¬¡å†™å…¥ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨HBä¸­å¯¹äºç»™å®šçš„è¯»å–è¿›è¡Œæ— åºå†™å…¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼ˆracyï¼‰å†™å…¥ã€‚è®©æˆ‘ä»¬æ›´ä¸¥æ ¼åœ°å®šä¹‰å®ƒã€‚</p>
<p>ç¬¬ä¸€éƒ¨åˆ†æ˜¯ç›¸å½“è½»æ¾çš„ï¼šæˆ‘ä»¬è¢«å…è®¸è§‚å¯Ÿå‘ç”Ÿåœ¨æˆ‘ä»¬é¢å‰çš„å†™å…¥ï¼Œæˆ–ä»»ä½•å…¶ä»–æ— åºå†™ï¼ˆè¿™æ˜¯ä¸€åœºæ¯”èµ›ï¼‰ã€‚è¿™æ˜¯è¯¥æ¨¡å‹çš„ä¸€ä¸ªéå¸¸é‡è¦çš„å±æ€§ï¼šæˆ‘ä»¬ç‰¹åˆ«å…è®¸æ¯”èµ›ï¼Œå› ä¸ºæ¯”èµ›å‘ç”Ÿåœ¨ç°å®ä¸–ç•Œä¸­ã€‚å¦‚æœæˆ‘ä»¬ç¦æ­¢æ¨¡å‹ä¸­çš„æ¯”èµ›ï¼Œè¿è¡Œæ—¶å°†å¾ˆéš¾ä¼˜åŒ–ä»£ç ï¼Œå› ä¸ºä»–ä»¬éœ€è¦åœ¨ä»»ä½•åœ°æ–¹å¼ºåˆ¶æ‰§è¡Œå‘½ä»¤ã€‚ è¯·æ³¨æ„ï¼Œåœ¨HBé¡ºåºè¯»å–åï¼Œå¦‚ä½•ç¦æ­¢çœ‹åˆ°å†™å…¥çš„å†™å…¥ã€‚</p>
<p><img alt="2bb5d8d34a56d3c3582e6dca.png" src="../assets/img/2bb5d8d34a56d3c3582e6dca.png" /></p>
<p>ç¬¬äºŒéƒ¨åˆ†å¯¹çœ‹åˆ°å‰é¢çš„å†™å…¥æå‡ºäº†é¢å¤–çš„çº¦æŸï¼šæˆ‘ä»¬åªèƒ½çœ‹åˆ°æœ€æ–°çš„å†™å…¥å‘ç”Ÿåœ¨å…ˆå‰çš„é¡ºåºã€‚ä¹‹å‰çš„ä»»ä½•å…¶ä»–å†™ä½œå¯¹æˆ‘ä»¬æ¥è¯´éƒ½æ˜¯ä¸å¯è§çš„ã€‚å› æ­¤ï¼Œåœ¨æ²¡æœ‰æ¯”èµ›çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªèƒ½çœ‹åˆ°æœ€æ–°çš„HBç¼–å†™ã€‚</p>
<p><img alt="cf28dba35c793f706ec2f9a4.png" src="../assets/img/cf28dba35c793f706ec2f9a4.png" /></p>
<p>HBä¸€è‡´æ€§çš„ç»“æœæ˜¯è¿‡æ»¤æ‰å¦ä¸€ä¸ªæ‰§è¡Œå­é›†ï¼Œå®ƒä»¬è§‚å¯Ÿæˆ‘ä»¬å…è®¸ä»–ä»¬è§‚å¯Ÿçš„å†…å®¹ã€‚ HBæ‰©å±•äº†éåŒæ­¥æ“ä½œï¼Œå› æ­¤å…è®¸æ¨¡å‹åŒ…å«æ‰§è¡Œä¸­çš„æ‰€æœ‰æ“ä½œã€‚</p>
<p><img alt="b9671d67b700dbd45a3fafcb.png" src="../assets/img/b9671d67b700dbd45a3fafcb.png" /></p>
<p>è¿™å°±æ˜¯SC-DRFçš„å…¨éƒ¨å†…å®¹ï¼šå¦‚æœæˆ‘ä»¬åœ¨ç¨‹åºä¸­æ²¡æœ‰ç«äº‰ - ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰çš„è¯»å†™éƒ½æ˜¯æŒ‰SOæˆ–HBæ’åºçš„ - é‚£ä¹ˆè¿™ä¸ªç¨‹åºçš„ç»“æœå¯ä»¥é€šè¿‡ä¸€äº›é¡ºåºä¸€è‡´çš„æ‰§è¡Œæ¥è§£é‡Šã€‚æœ‰ä¸€ä¸ªSC-DRFå±æ€§çš„æ­£å¼è¯æ˜ï¼Œä½†æˆ‘ä»¬å°†ä½¿ç”¨ç›´è§‚çš„ç†è§£ä¸ºä»€ä¹ˆè¿™åº”è¯¥æ˜¯çœŸçš„ã€‚</p>
<h3 id="happens-before-publication">Happens-Before: Publication</h3>
<p><img alt="73dc16be080b34e5f0622d75.png" src="../assets/img/73dc16be080b34e5f0622d75.png" /></p>
<p>ä¸Šé¢çš„ä¾‹å­ç›¸å½“é«˜æ·±ï¼Œä½†è¿™å°±æ˜¯è¯­è¨€è§„èŒƒçš„å®šä¹‰æ–¹å¼ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªä¾‹å­æ¥æ›´ç›´è§‚åœ°ç†è§£è¿™ä¸€ç‚¹ã€‚ä½¿ç”¨ç›¸åŒçš„ä»£ç ç¤ºä¾‹ï¼Œå¹¶ä½¿ç”¨HBä¸€è‡´æ€§è§„åˆ™è¿›è¡Œåˆ†æã€‚</p>
<p><img alt="ef6b6883216005b4be2ac332.png" src="../assets/img/ef6b6883216005b4be2ac332.png" /></p>
<p>è¿™ç§æ‰§è¡Œåœ¨ä¸€è‡´ä¹‹å‰å‘ç”Ÿï¼šreadï¼ˆxï¼‰è§‚å¯ŸHBä¸­çš„æœ€æ–°å†™å…¥ã€‚ç»“æœï¼ˆ1,1ï¼‰å› æ­¤æ˜¯åˆç†çš„ã€‚</p>
<p><img alt="993f8c412b2960f61c06038f.png" src="../assets/img/993f8c412b2960f61c06038f.png" /></p>
<p>è¿™ä¸ªæ‰§è¡Œæ˜¯åœ¨ä¸€è‡´ä¹‹å‰å‘ç”Ÿçš„ï¼Œå› ä¸ºæˆ‘ä»¬è¯»å–äº†xçš„é»˜è®¤å€¼ã€‚æˆ‘ä»¬çœç•¥äº†HBè¾¹ç¼˜çš„é»˜è®¤åˆå§‹åŒ–ï¼Œå®ƒä¸æ­¤å›¾è¡¨ä¸Šçš„çº¿ç¨‹ä¸­çš„ç¬¬ä¸€ä¸ªæ“ä½œåŒæ­¥ã€‚</p>
<p><img alt="bd7129a4043c2ea04ad64dc9.png" src="../assets/img/bd7129a4043c2ea04ad64dc9.png" /></p>
<p>æœ‰äº›ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œå³ä½¿åœ¨è¯»å–å’Œå†™å…¥xä¹‹é—´æ²¡æœ‰ä¼ é€’æ€§HBï¼Œç»“æœï¼ˆ0,1ï¼‰çš„æ‰§è¡Œä¹Ÿä¼šåœ¨ä¸€è‡´ä¹‹å‰å‘ç”Ÿã€‚æˆ‘ä»¬åªæ˜¯é€šè¿‡æ¯”èµ›è¯»å–å€¼ - è®°ä½HBä¸€è‡´æ€§å®šä¹‰çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚</p>
<p><img alt="c111b81d2a17317f222d72ff.png" src="../assets/img/c111b81d2a17317f222d72ff.png" /></p>
<p>å¹¶ä¸”æ­¤æ‰§è¡Œä¸èƒ½éµå®ˆHBä¸€è‡´æ€§ï¼Œå› æ­¤ä¸èƒ½ç”¨äºæ¨æ–­ç¨‹åºç»“æœã€‚å› æ­¤è¿™ç§ç»“æœæ˜¯ä¸å¯èƒ½çš„ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä»å››ä¸ªå¯èƒ½çš„ç»“æœä¸­æ¶ˆé™¤äº†ï¼ˆ1,0ï¼‰ï¼Œè¿™å®é™…ä¸Šæ„å‘³ç€æˆ‘ä»¬è¢«è¿«å°†xè§†ä¸º1ï¼Œå¦‚æœæˆ‘ä»¬å°†gè§†ä¸º1ã€‚</p>
<p><img alt="d07b16d43fdd2d753f2bcbd3.png" src="../assets/img/d07b16d43fdd2d753f2bcbd3.png" /></p>
<p>æƒ³è¦ç¡®å®šå®é™…ç¨‹åºçš„HBå‘½ä»¤ä¼šä¼¤å®³è„‘ç»†èƒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸€äº›ç®€å•çš„è§„åˆ™ã€‚åŒæ­¥è¾¹ç¼˜çš„æ¥æºç§°ä¸ºâ€œé‡Šæ”¾â€ï¼Œç›®çš„åœ°ç§°ä¸ºâ€œè·å–â€ã€‚ HBåŒ…å«SWï¼Œå› æ­¤è·¨è¶Šä¸åŒçº¿ç¨‹çš„HBä¹Ÿä»â€œreleaseâ€å¼€å§‹ï¼Œä»¥â€œacquireâ€ç»“æŸã€‚</p>
<p>å¯ä»¥å°†é‡Šæ”¾è§†ä¸ºå°†æ‰€æœ‰å…ˆå‰çŠ¶æ€æ›´æ–°é‡Šæ”¾åˆ°é‡å¤–çš„æ“ä½œï¼Œå¹¶ä¸”è·å–æ˜¯æ¥æ”¶è¿™äº›æ›´æ–°çš„é…å¯¹æ“ä½œã€‚å› æ­¤ï¼Œåœ¨æˆåŠŸè·å¾—åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é…å¯¹ç‰ˆæœ¬ä¹‹å‰çš„æ‰€æœ‰æ›´æ–°ã€‚</p>
<p>ç”±äºæˆ‘ä»¬ä¹‹å‰æå‡ºçš„æ„é€ ï¼Œå®ƒåªæœ‰åœ¨è·å–/é‡Šæ”¾å‘ç”Ÿåœ¨åŒä¸€ä¸ªå˜é‡ä¸Šæ—¶æ‰æœ‰æ•ˆï¼Œæˆ‘ä»¬å®é™…ä¸Šçœ‹åˆ°äº†å†™å…¥çš„å€¼ã€‚ä¸‹é¢çš„æµ‹éªŒè¿›ä¸€æ­¥æ¢è®¨äº†è¿™ä¸€ç‚¹ã€‚</p>
<h3 id="happens-before-test-your-understanding">Happens-Before: Test Your Understanding</h3>
<p><img alt="533579a3b2fa656a4ed04145.png" src="../assets/img/533579a3b2fa656a4ed04145.png" /></p>
<p>è®©æˆ‘ä»¬åœ¨è¿™é‡Œæ›´ç°å®åœ°ç©ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªåŒ…è£…ç±»ï¼Œå®ƒå­˜å‚¨ï¼ˆï¼ˆé‚®ä»¶ï¼‰ç›’å­ï¼‰ç±»å‹Tçš„ä¸€äº›å€¼ã€‚æ˜¾ç„¶ï¼Œä½ æœ‰ä¸€ä¸ªå–å€¼çš„setterï¼Œä»¥åŠè¿”å›å®ƒçš„getterã€‚åœ¨å¤§å¤šæ•°ç¨‹åºä¸­ï¼Œè¯»å–æ•°é‡è¿œè¿œå¤šäºå†™å…¥ï¼ˆå¦åˆ™ä¸ºä»€ä¹ˆè¦å­˜å‚¨å€¼ï¼Ÿï¼‰ï¼Œå› æ­¤åŒæ­¥çš„getterå¯èƒ½ä¼šæˆä¸ºå¯ä¼¸ç¼©æ€§ç“¶é¢ˆã€‚</p>
<p><img alt="f805771f8c8e9cfbf0888188.png" src="../assets/img/f805771f8c8e9cfbf0888188.png" /></p>
<p>äººä»¬å¸¦ç€ä»–ä»¬çš„åˆ†æå™¨ï¼ŒæŸ¥çœ‹ä»£ç å¹¶äº‰è®ºï¼šå¥½å§ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç®€å•çš„å€¼Tï¼Œæˆ‘ä»¬å°†å®ƒå­˜å‚¨åœ¨åŒæ­¥ä¸­ï¼Œç¼“å­˜é€šè¿‡åŒæ­¥åˆ·æ–°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è·³è¿‡è¯»å–æ—¶çš„åŒæ­¥ã€‚ çœŸçš„å—ï¼Ÿç­”æ¡ˆï¼ˆé€‰æ‹©ç»“æŸæ˜¾ç¤ºï¼‰ï¼šåœ¨è®¾ç½®å™¨ä¸­ç¡®å®æœ‰ä¸€ä¸ªå…³äºç›‘è§†å™¨è§£é”çš„é‡Šæ”¾æ“ä½œï¼Œä½†æ˜¯getterä¸­ç¼ºå°‘è·å–æ“ä½œã€‚å› æ­¤ï¼Œåœ¨æˆ‘ä»¬è¯»å–å¦ä¸€ä¸ªçº¿ç¨‹ä¸­çš„valä¹‹åï¼Œå†…å­˜æ¨¡å‹å¹¶æ²¡æœ‰è¦æ±‚å°†å­˜å‚¨åˆ°valä¹‹å‰å­˜å‚¨çš„å€¼å¯è§ - å¦‚æœé‚£äº›æ˜¯å­˜å‚¨åˆ°valå­—æ®µä¸­åˆ™éå¸¸åçš„æ¶ˆæ¯ã€‚</p>
<p><img alt="7af00781f7f2343f6ca8f00a.png" src="../assets/img/7af00781f7f2343f6ca8f00a.png" /></p>
<p>è¯´æ²¡æœ‰è·å¾—å±éšœå—ï¼Ÿå¥½å§ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªï¼Œå› ä¸ºæˆ‘ä»¬â€œçŸ¥é“â€ç¼–è¯‘å™¨ä¸ºæ˜“å¤±æ€§è¯»å–å‘å‡ºä¸€ä¸ªã€‚ è¿™åäº†å—ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œä¸ºä»€ä¹ˆï¼Ÿå›ç­”ï¼ˆé€‰æ‹©ç»“æŸä»¥æ˜¾ç¤ºï¼‰ï¼šåœ¨å½“å‰çš„å®è·µä¸­ï¼Œå®ƒé€‚ç”¨äºç»™å®šçš„ä¿å®ˆVMå®ç°ï¼Œä½†æ˜¯JMMæ–¹é¢ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰åƒå‘å¸ƒæ—¶é‚£æ ·è·å–ç›¸åŒçš„å˜é‡ï¼Œæ‰€ä»¥ä¸èƒ½ä¿è¯ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ›´æ™ºèƒ½çš„VMå¯ä»¥çœ‹åˆ°æ‚¨ä¸ä½¿ç”¨ä¸‹æ²‰å€¼ï¼Œå› æ­¤å¯ä»¥å‡è£…æˆ‘ä»¬æ²¡æœ‰çœ‹åˆ°å±éšœçš„æ›´æ–°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œå¹¶å®Œå…¨æ¶ˆé™¤å®ƒã€‚</p>
<p><img alt="7f72439f9b9ca6f4d8b70895.png" src="../assets/img/7f72439f9b9ca6f4d8b70895.png" /></p>
<p>è¿™æ˜¯ä¸€ç§æ­£ç¡®çš„æ–¹æ³•ã€‚å°†å­—æ®µæ ‡è®°ä¸ºvolatileå¯åœ¨setterä¸­æä¾›é‡Šæ”¾æ“ä½œï¼Œå¹¶åœ¨getterä¸­æä¾›å·²é…å¯¹çš„è·å–ã€‚è¿™å…è®¸æˆ‘ä»¬åœ¨getterä¸­åŒæ­¥æ”¾æ¾ï¼Œå¹¶ä¸”åªç•™ä¸‹è½»é‡çº§çš„volatileã€‚ æ˜¯å¦ä»éœ€è¦åœ¨setterä¸­åŒæ­¥ï¼Ÿå›ç­”ï¼ˆé€‰æ‹©ç»“æŸæ˜¾ç¤ºï¼‰ï¼šæ˜¯çš„ï¼Œå› ä¸ºsetteréœ€è¦äº’æ–¥ï¼šå®ƒåº”è¯¥åªè®¾ç½®ä¸€æ¬¡valã€‚</p>
<h3 id="jmm-interpretation-roach-motel">JMM Interpretation: Roach Motel</h3>
<p><img alt="fe38978e6983fad6f1a95483.png" src="../assets/img/fe38978e6983fad6f1a95483.png" /></p>
<p>ä¼˜åŒ–ç¼–è¯‘å™¨å¯èƒ½å¾ˆéš¾ç¡®å®šç‰¹å®šä¼˜åŒ–æ˜¯å¦ç ´åäº†JMMçš„è§„å®šã€‚ä¸€äº›é«˜çº§ç¼–è¯‘å™¨å¯ä»¥ç›´æ¥æ„é€ å†…å­˜æµã€‚ä½†æ˜¯ï¼ŒåŸºæœ¬ç¼–è¯‘å™¨äººå‘˜éœ€è¦ä¸€ç»„ç®€å•çš„è§„åˆ™æ¥ç¡®å®šæ˜¯å¦å…è®¸æŸäº›å†…å®¹ã€‚ JSR 133ä¸“å®¶ç»„åˆ›å»ºäº†JSR 133 Cookbook for Compiler Writersæ¥æ¶µç›–è¿™ä¸€ç‚¹ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒCookbookæ˜¯ä¸€å¥—ä¿å®ˆçš„è§£é‡Šï¼Œè€Œä¸æ˜¯JMMæœ¬èº«ã€‚æˆ‘ä»¬å°†ç®€è¦è®¨è®ºå¦‚ä½•å¾—å‡ºè¿™äº›è§£é‡Šã€‚</p>
<p>è€ƒè™‘ä¸€ä¸ªç¨‹åºï¼Œå¯ä»¥é€šè¿‡æ­¤æ¨¡æ¿æ‰§è¡Œæ¥è¡¨ç¤ºã€‚å‰ä¸¤ç§é‡æ–°æ’åºå¾ˆç®€å•ï¼š</p>
<p><img alt="54c263f6542c70d49c142aaf.png" src="../assets/img/54c263f6542c70d49c142aaf.png" /></p>
<p><img alt="1d8497ee0258820423d53211.png" src="../assets/img/1d8497ee0258820423d53211.png" /></p>
<hr />
<p><img alt="79f7df183a7d44df93018467.png" src="../assets/img/79f7df183a7d44df93018467.png" /></p>
<p>è¿™äº›è§„åˆ™æœ‰æ•ˆåœ°å…è®¸å°†ä»£ç æ¨é€åˆ°è·å–/é‡Šæ”¾å—ä¸­ï¼Œä¾‹å¦‚ï¼Œå°†ä»£ç æ¨å…¥é”å®šåŒºåŸŸï¼Œè¿™å¯ä»¥åœ¨ä¸è¿åJMMçš„æƒ…å†µä¸‹å®ç°é”å®šç²—åŒ–ã€‚</p>
<hr />
<p>ä¿å®ˆåœ°ç¦æ­¢å¦å¤–ä¸¤ç§ç±»å‹çš„é‡æ–°æ’åºã€‚è¯·æ³¨æ„ï¼ŒJMMæœ¬èº«å¹¶ä¸ç¦æ­¢å®ƒä»¬ï¼Œä½†å¦‚æœæœ¬åœ°åˆ†ææ— æ³•ç¡®å®šæ­£ç¡®æ€§ï¼Œåˆ™å¿…é¡»ç¦æ­¢å®ƒä»¬ï¼ˆåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¾‹å¦‚æ„é€ å‡½æ•°ä¸­çš„å­—æ®µå­˜å‚¨ï¼Œå®ƒå¯ä»¥ï¼‰ï¼š</p>
<p><img alt="423e983b356d234ebda6d16c.png" src="../assets/img/423e983b356d234ebda6d16c.png" /></p>
<p><img alt="6f9fba82afb88a6ef82615d4.png" src="../assets/img/6f9fba82afb88a6ef82615d4.png" /></p>
<hr />
<h3 id="test-your-understanding_2">Test Your Understanding</h3>
<p><img alt="a68622c061dd49e459ba9c19.png" src="../assets/img/a68622c061dd49e459ba9c19.png" /></p>
<p>è®©æˆ‘ä»¬å†è¯•ä¸€æ¬¡çœŸå®çš„ä¾‹å­ã€‚ è¿™æ®µä»£ç å¯ä»¥æ‰“å°ä»€ä¹ˆï¼Ÿç­”æ¡ˆï¼ˆé€‰æ‹©ç»“æŸæ˜¾ç¤ºï¼‰ï¼šå­˜å‚¨å°±ç»ªä¹‹é—´å­˜åœ¨åŒæ­¥è¾¹ç¼˜ï¼Œå¹¶ä¸”è¯»å–å°±ç»ª== trueå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°HBé¡ºåºä¸­çš„æœ€æ–°å†™å…¥ï¼Œå³42ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°è¶…å‡ºHBï¼ˆracyï¼‰çš„å†™å…¥ï¼Œè¿™ä¹Ÿç»™æˆ‘ä»¬å¸¦æ¥äº†43ã€‚</p>
<hr />
<p><img alt="20c75dc65c72c98ca75533fb.png" src="../assets/img/20c75dc65c72c98ca75533fb.png" /></p>
<p>ç°åœ¨æˆ‘ä»¬å»æ‰volatileã€‚ è¿™æ®µä»£ç å¯ä»¥æ‰“å°ä»€ä¹ˆï¼Ÿç­”æ¡ˆï¼ˆé€‰æ‹©ç»“æŸæ˜¾ç¤ºï¼‰ï¼šä»»ä½•å€¼éƒ½æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥é€šè¿‡ç«èµ›è§‚å¯Ÿä»»ä½•å€¼ï¼Œå¹¶ä¸”å¦‚æœwhileå¾ªç¯å‡å°‘åˆ°whileï¼ˆtrueï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹ä¸åˆ°ä»»ä½•å€¼ã€‚</p>
<hr />
<h3 id="benchmarks">Benchmarks</h3>
<p><img alt="5524c0461b1c7d978dcae2ea.png" src="../assets/img/5524c0461b1c7d978dcae2ea.png" /></p>
<p>å½“ç„¶ï¼Œåœ¨æ²¡æœ‰åŸºå‡†æµ‹è¯•çš„æƒ…å†µä¸‹å‘å¸ƒä»»ä½•å†…å®¹çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬æƒ³è¦é‡åŒ–è‡³å°‘ä¸€äº›æˆæœ¬ã€‚æµ‹é‡ç»å¯¹æ•°å­—å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå› æ­¤æˆ‘ä»¬åªä¼šå±•ç¤ºä¸€äº›é‡è¦çš„é«˜çº§åˆ«è¦ç‚¹ã€‚åŸºå‡†æµ‹è¯•ç”±<a href="http://openjdk.java.net/projects/code-tools/jmh/">JMH</a>é©±åŠ¨ï¼Œæˆ‘ä»¬å‡è®¾æ‚¨ç†Ÿæ‚‰å®ƒã€‚</p>
<hr />
<p>è®©æˆ‘ä»¬ä»â€œæå‡â€åŸºå‡†å¼€å§‹ã€‚æˆ‘ä»¬å¸Œæœ›è¿è¡Œä¸€ä¸ªå¤©èµ‹è®¡ç®—væ¬¡vçš„ç»¼åˆæµ‹è¯•ã€‚åŒºåˆ«åœ¨äºåº•å±‚å­˜å‚¨çš„å…±äº«å’Œvæ˜“å˜æ€§ã€‚æ¯«ä¸å¥‡æ€ªï¼Œå½“æˆ‘ä»¬é˜…è¯»å†…å®¹æ—¶ï¼Œåˆ†äº«ä¼¼ä¹å¹¶ä¸é‡è¦ã€‚</p>
<p>Volatileæµ‹è¯•ç”¨ä¾‹æ˜æ˜¾å˜æ…¢ã€‚ç„¶è€Œï¼Œå®ƒå¹¶ä¸æ˜¯æŒ¥å‘ç‰©æœ¬èº«çš„æˆæœ¬ï¼Œè€Œæ˜¯è¿‡äºä¿å®ˆçš„å®æ–½è¯æ˜äº†å°†s.væ¨å‡ºå¾ªç¯çš„è¯æ®ï¼Œè¿™å°†åœ¨æ”¶è´­ä¹‹å‰ç§»åŠ¨è¯»æ•°ï¼ˆå‚è§ä¸Šé¢çš„â€œç½—å¥‡æ±½è½¦æ—…é¦†â€ï¼‰ã€‚å°†s.vé¢„è¯»æˆå±€éƒ¨å˜é‡å¹¶å†æ¬¡æµ‹é‡æ˜¯ç•™ç»™è¯»è€…çš„ç»ƒä¹ ã€‚</p>
<p><img alt="c5e902704dd51d349188559a.png" src="../assets/img/c5e902704dd51d349188559a.png" /></p>
<p><img alt="d67e03576f94f23ea34a74eb.png" src="../assets/img/d67e03576f94f23ea34a74eb.png" /></p>
<hr />
<p>å¯¹äºå†™å…¥æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹é€’å¢ç›¸åŒçš„å˜é‡ã€‚æˆ‘ä»¬åšäº†ä¸€äº›é€€é¿ä»¥åœæ­¢ä½¿ç”¨å†™å…¥æ¥æŠ¨å‡»ç³»ç»Ÿï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿå…±äº«/éå…±äº«æƒ…å†µä¹‹é—´ä»¥åŠæ˜“å¤±æ€§/éæ˜“å¤±æ€§æƒ…å†µä¹‹é—´çš„å·®å¼‚ã€‚äººä»¬å¯èƒ½ä¼šè®¤ä¸ºä¸ç¨³å®šçš„æµ‹è¯•ä¼šå…¨é¢å¤±è´¥ï¼Œä½†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…±äº«æµ‹è¯•æ­£åœ¨å¤±è´¥ã€‚è¿™å¼ºåŒ–äº†æ•°æ®å…±äº«é¦–å…ˆåº”è¯¥é¿å…çš„æƒ³æ³•ï¼Œè€Œä¸æ˜¯volatilesã€‚</p>
<p><img alt="41acbc75b0d39e8f08c118a7.png" src="../assets/img/41acbc75b0d39e8f08c118a7.png" /></p>
<p><img alt="33e009f9bfd3ebb26de07748.png" src="../assets/img/33e009f9bfd3ebb26de07748.png" /></p>
<hr />
<h3 id="jmm-updates_2">JMM Updates</h3>
<p><img alt="71c70a1dd6049bba39292f78.png" src="../assets/img/71c70a1dd6049bba39292f78.png" /></p>
<p>ç›®å‰çš„ä¸»æµè¯­è¨€ä¼¼ä¹å…¨é¢é‡‡ç”¨SC-DRFã€‚ä½†æ˜¯ï¼Œæœ‰è¯æ®è¡¨æ˜ä¸¥æ ¼æ”¯æŒSC-DRFå¯èƒ½å¯¹æ‰€æœ‰æƒ…å†µéƒ½ä¸åˆ©ã€‚ä¾‹å¦‚ï¼ŒLinux RCUæ”¾æ¾äº†ä¸€äº›çº¦æŸï¼Œåœ¨å¼±æœ‰åºçš„å¹³å°ä¸Šæœ‰éå¸¸å¥½çš„æ€§èƒ½æ”¹è¿›ï¼Œå¯ä»¥è¯´è¿™æ ·åšè€Œä¸ä¼šç ´åå¯ç”¨æ€§ã€‚ å› æ­¤ï¼Œä¸‹ä¸€ä¸ªJMMæ›´æ–°çš„é—®é¢˜æ˜¯ï¼šæˆ‘ä»¬æ˜¯å¦åº”è¯¥æ”¾æ¾SC-DRFä»¥è·å¾—æ›´é«˜çš„æ€§èƒ½ï¼Ÿ</p>
<hr />
<h2 id="part-iv-out-of-thin-air">Part IV: Out of Thin Air</h2>
<h3 id="_9">æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆ</h3>
<p><img alt="974f1f7545042c20108592e8.png" src="../assets/img/974f1f7545042c20108592e8.png" /></p>
<p>ä¼¼ä¹SC-DRFæˆç«‹åï¼Œæˆ‘ä»¬å¾ˆé«˜å…´ã€‚ä»»ä½•è½¬æ¢åœ¨åŒæ­¥æ“ä½œä¹‹é—´éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå¦‚æœä»£ç ä¸­å­˜åœ¨æœªæ³¨é‡Šçš„ç«äº‰ï¼Œåˆ™è¡Œä¸ºæ˜¯éSCå¼€å§‹çš„ã€‚æ•™å¯¼è¿è¡Œæ—¶SC-DRFè§„åˆ™ï¼Œä½ å¾ˆå¥½ï¼Œå¯¹å—ï¼Ÿ</p>
<hr />
<h3 id="_10">æˆ‘ä»¬æœ‰ä»€ä¹ˆ</h3>
<p><img alt="ba807d7815eab3853cfea3b1.png" src="../assets/img/ba807d7815eab3853cfea3b1.png" /></p>
<p>ä½†æ˜¯ï¼Œè¿™åªæ˜¯äº‹å®çš„ä¸€éƒ¨åˆ†ã€‚ä¸€äº›è½¬å˜ä»ç„¶ç ´åäº†SCã€‚è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªç¨‹åºï¼šæœ‰ç‚¹ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œå®ƒæ˜¯æ­£ç¡®åŒæ­¥çš„ï¼Œå› ä¸ºæ‰€æœ‰SCæ‰§è¡Œéƒ½æ²¡æœ‰æ¯”èµ›ï¼Œå”¯ä¸€å¯èƒ½çš„ç»“æœæ˜¯ï¼ˆ0,0ï¼‰</p>
<hr />
<p><img alt="d3a125302e5c875f49645859.png" src="../assets/img/d3a125302e5c875f49645859.png" /></p>
<p>ç°åœ¨ï¼Œä¼˜åŒ–è¿è¡Œæ—¶/ç¡¬ä»¶è¿›å…¥å¹¶å°è¯•æ¨æµ‹åˆ†æ”¯ã€‚å¦‚æœæ¨æµ‹å¤±è´¥ï¼Œæœ‰æ—¶æ¨æµ‹æ€§åœ°æ‰§è¡Œåˆ†æ”¯å¹¶é€€å›å¯èƒ½æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ å‡è®¾æˆ‘ä»¬åœ¨ä»£ç ä¸­åšäº†è¿™ä¸ªæ¨æµ‹ã€‚</p>
<hr />
<p><img alt="96d2bf6486e17529e1b14920.png" src="../assets/img/96d2bf6486e17529e1b14920.png" /></p>
<p>æˆ‘ä»¬ç°åœ¨æ‰§è¡Œä¿®æ”¹åçš„ç¨‹åºã€‚ç¬¬äºŒä¸ªçº¿ç¨‹æœªç»ä¿®æ”¹è¿è¡Œã€‚å¦‚æœæˆ‘ä»¬æŒ‰ç…§å¹»ç¯ç‰‡ä¸Šæè¿°çš„é¡ºåºè¿è¡Œè¿™ä¸ªç¨‹åºï¼Œæˆ‘ä»¬å°†æœ‰ï¼ˆ42,42ï¼‰ï¼Œå› ä¸ºçŒœæµ‹å·²ç»å˜æˆäº†è‡ªæˆ‘è¾©è§£çš„é¢„è¨€ï¼å¥½åƒ42ä¼¼ä¹æ˜¯å‡­ç©ºäº§ç”Ÿçš„ã€‚ è¿™ä¸ªä¾‹å­ä¼¼ä¹æ˜¯äººä¸ºçš„ï¼Œç›´åˆ°ä½ æ„è¯†åˆ°å˜é‡aå¾ˆå®¹æ˜“å°±æ˜¯System.securityManagerï¼Œè€Œæˆ‘ä»¬åˆšåˆšç ´åäº†å¹³å°å®‰å…¨ä¿éšœï¼å¯æ€•ã€‚</p>
<hr />
<p><img alt="2554b59bf208a9794fde95fd.png" src="../assets/img/2554b59bf208a9794fde95fd.png" /></p>
<p>ä¸ºäº†å¼¥è¡¥è¿™ä¸€ç‚¹ï¼ŒJMMç¦æ­¢è¶…è–„ï¼ˆOoTAï¼‰å€¼ã€‚ä¸ºäº†å»ºè®¾æ€§åœ°ç¦æ­¢OoTAï¼Œä½ éœ€è¦ä¸€äº›å› æœå…³ç³»çš„æ¦‚å¿µï¼ˆå³â€œä»€ä¹ˆé€ æˆäº†ä»€ä¹ˆâ€ï¼‰ï¼Œè¿™åœ¨è¯•å›¾æ‘†è„±å…¨çƒæ—¶é—´çš„è‡´å‘½æ‹¥æŠ±çš„æ¨¡å‹ä¸­å¼•å…¥æ˜¯æ£˜æ‰‹çš„ã€‚</p>
<hr />
<p><img alt="3fd894ca6570c55b21b7169b.png" src="../assets/img/3fd894ca6570c55b21b7169b.png" /></p>
<p><a href="http://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html#jls-17.4.8">JLS 17.4.8</a>ä¸­çš„æ•´ä¸ªéƒ¨åˆ†è¯•å›¾ä¸¥æ ¼æŒ‡å®šâ€œæäº¤è¯­ä¹‰â€ï¼Œè¿™å¦å¤–éªŒè¯äº†å› æœå…³ç³»è¿è§„çš„æ‰§è¡Œã€‚æˆ‘ä»¬ä¸ä¼šåœ¨è¿™é‡Œæ·±å…¥äº†è§£ç»†èŠ‚ï¼Œæ‰€ä»¥è¯·å°½æƒ…äº«å—è¿™ä¸ªçœ‹èµ·æ¥åƒBillçš„å¥½äººã€‚</p>
<hr />
<p><img alt="6437d90c45724825f2f99815.png" src="../assets/img/6437d90c45724825f2f99815.png" /></p>
<p>æäº¤è¯­ä¹‰ç»™å‡ºäº†æ‰§è¡Œæ±¤ä¸­çš„æœ€åä¸€ä¸ªè¿‡æ»¤å™¨ã€‚è¿åå› æœå…³ç³»è¦æ±‚çš„æ‰§è¡Œä¸èƒ½ç”¨äºæ¨ç†è¯¥ç¨‹åºã€‚</p>
<hr />
<p><img alt="0f00b4707149230f8d4cdae7.png" src="../assets/img/0f00b4707149230f8d4cdae7.png" /></p>
<p>è¿™å°†æˆ‘ä»¬å¸¦åˆ°æœ€åçš„ç”»é¢ã€‚ä¸ºäº†æµ‹è¯•JMMä¸‹çš„æ‰§è¡Œæ˜¯å¦åˆç†ï¼Œæ‚¨éœ€è¦æŸ¥çœ‹å®ƒæ˜¯å¦é€šè¿‡äº†æ‰€æœ‰è¦æ±‚ã€‚ä½†è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥æ ¹æ®ç‰¹å®šæµ‹è¯•çš„å¤±è´¥å¿«é€Ÿåˆ†æ”¯å¹¶ç»‘å®šæ‰€è€ƒè™‘çš„æ‰§è¡Œé›†ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”šè‡³ä¸ä¼šæäº¤è¯­ä¹‰ï¼Œå› ä¸ºé€šè¿‡å…¶ä»–è¿‡æ»¤å™¨çš„æ‰€æœ‰æ‰§è¡Œéƒ½åªäº§ç”Ÿäº†é¢„æœŸçš„ç»“æœï¼Œæˆ‘ä»¬ä¸å†å…³å¿ƒå®ƒä»¬äº†ã€‚</p>
<hr />
<h3 id="oota-and-cc">OoTA and C/C++</h3>
<p><img alt="5a06f7bc0f2af2c10512a217.png" src="../assets/img/5a06f7bc0f2af2c10512a217.png" /></p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼ŒJavaä¼¼ä¹æ˜¯å”¯ä¸€è¯•å›¾æŒ‡å®šOoTAçœŸæ­£å«ä¹‰çš„å¹³å°ã€‚è€ƒè™‘åˆ°éå¸¸å¤æ‚ä¸”æœ‰æ—¶åç›´è§‰çš„å› æœå…³ç³»æ¨¡å‹ï¼Œå¹¶éJavaéå¸¸æˆåŠŸã€‚</p>
<hr />
<h3 id="jmm-updates_3">JMM Updates</h3>
<p><img alt="d845ea72ac6cc3ec0b3d2dde.png" src="../assets/img/d845ea72ac6cc3ec0b3d2dde.png" /></p>
<p>å› æ­¤ï¼Œåœ¨ä¸‹ä¸€ä¸ªJMMæ›´æ–°ä¸­ï¼Œæˆ‘ä»¬ä¼šé—®æœ€å¤§çš„é—®é¢˜ï¼šæˆ‘ä»¬å¯ä»¥é‡æ–°åˆ¶å®š/è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿å…¶æ›´å…·é˜²å¼¹æ€§ï¼Œç®€æ´æ€§å’Œå¯ç†è§£æ€§å—ï¼Ÿ</p>
<hr />
<h2 id="part-v-finals">Part V: Finals</h2>
<h3 id="test-your-basic-understanding">Test Your Basic Understanding</h3>
<p><img alt="e73fcdb058f840ab7884600a.png" src="../assets/img/e73fcdb058f840ab7884600a.png" /></p>
<p>æ—¢ç„¶æˆ‘ä»¬å·²ç»å­¦åˆ°äº†å¾ˆå¤šå…³äºJMMçš„çŸ¥è¯†ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬ä»è¿™ä¸ªç®€å•çš„æµ‹éªŒå¼€å§‹å§ã€‚è¿™ä¸ªç¨‹åºæ‰“å°ä»€ä¹ˆï¼Ÿå›ç­”ï¼ˆé€‰æ‹©ç»“æŸä»¥æ˜¾ç¤ºï¼‰ï¼šNothingï¼Œ0,42æˆ–è€…æŠ›å‡ºNPEï¼ˆï¼ï¼‰ã€‚ Racyè¯»å–æ¯”æ¯”çš†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥çœŸæ­£è¯»å–ä»»ä½•å†™å…¥çš„å€¼ï¼šé»˜è®¤å€¼æˆ–æ„é€ å‡½æ•°ä¸­å†™å…¥çš„å€¼ã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥å…ˆè§‚å¯Ÿï¼ˆaï¼= nullï¼‰å¹¶æ‰“å°ï¼Œåªæ˜¯ä¸ºäº†å®ç°ç¬¬äºŒæ¬¡è¿”å›çš„racyè¯»å–ï¼ˆa == nullï¼‰ï¼Œè®¾ç½®ä¸€ä¸ªNPEã€‚</p>
<hr />
<h3 id="what-do-we-want">What Do We Want</h3>
<p><img alt="794d8bbd3c4f81d1f930c5ac.png" src="../assets/img/794d8bbd3c4f81d1f930c5ac.png" /></p>
<p>æˆ‘ä»¬æ˜¾ç„¶å¸Œæœ›ä»¥è¿™æ ·çš„æ–¹å¼ä¿®æ”¹å¯¹è±¡å£°æ˜ï¼Œå³æˆ‘ä»¬åªè·å¾—42ï¼ˆæˆ–æ²¡æœ‰ï¼‰ã€‚ä½ å¯ä»¥çŒœåˆ°é‚£é‡Œéšè—ç€äº”ä¸ªé—®å·ï¼Œå¯¹å§ï¼Ÿ</p>
<hr />
<p><img alt="80e6142423225daa948073b6.png" src="../assets/img/80e6142423225daa948073b6.png" /></p>
<p>æˆ‘ä»¬éœ€è¦è¿™æ ·æ¥ä¿æŠ¤è‡ªå·±å…å—ç§æ—ä¼¤å®³ã€‚å¦‚æœå¯¹è±¡æ¥æ”¶å™¨æ¶æ„è¡Œä¸ºï¼Œæˆ‘ä»¬å°±ä¸èƒ½ç€ç«å¹¶ç ´åå¯¹è±¡ä¸å˜é‡ - å¦åˆ™æˆ‘ä»¬å°±æ— æ³•ç¼–å†™å®‰å…¨ä»£ç ã€‚ å¦‚ä»Šï¼Œä¸€äº›å‹‡æ•¢çš„äººä»¬å›´ç»•ç€æ¯”èµ›è¯•å›¾ä¼˜åŒ–è¡¨ç°ã€‚è¯·å†æ¬¡é˜…è¯»<a href="http://soft.vub.ac.be/races/wp-content/uploads/2012/09/races2012_submission_3.pdf">Hans</a>ã€‚</p>
<hr />
<h3 id="what-do-we-have">What Do We Have</h3>
<p><img alt="5b822fdfc6f10fe49ef5b9dd.png" src="../assets/img/5b822fdfc6f10fe49ef5b9dd.png" /></p>
<p>ä¸æˆ‘ä»¬éœ€è¦è§„èŒƒå®ƒä»¬çš„æ–¹å¼ç›¸æ¯”ï¼Œæœ€ç»ˆå­—æ®µçš„å®ç°éå¸¸ç®€å•ã€‚åœ¨å¤§å¤šæ•°ä½“ç³»ç»“æ„ä¸­ï¼Œåªéœ€åœ¨æ„é€ å‡½æ•°çš„æœ«å°¾æ”¾ç½®ä¸€ä¸ªå†…å­˜å±éšœï¼Œå¹¶é€šè¿‡ä¾èµ–é¡¹å°†å¯¹è±¡å­—æ®µçš„è´Ÿè½½ä¸åŸå§‹å¼•ç”¨çš„è´Ÿè½½è”ç³»èµ·æ¥ã€‚å®Œæˆã€‚</p>
<hr />
<p><img alt="9d29343fe5979f2ba5804085.png" src="../assets/img/9d29343fe5979f2ba5804085.png" /></p>
<p>ç„¶è€Œï¼Œè§„èŒƒå˜å¾—ç›¸å½“å¤æ‚ã€‚æˆ‘ä»¬å¿…é¡»åœ¨ä¸€ä¸ªè¯­æ³•ä¸ç»æ„çš„è§„èŒƒä¸­å¼•ç”¨æ„é€ å‡½æ•°ï¼Œå¹¶åœ¨æ„é€ å‡½æ•°çš„æœ«å°¾å¼•å…¥ç‰¹æ®Šçš„å†»ç»“æ“ä½œã€‚ç›´è§‚åœ°è¯´ï¼Œè¿™ä¸ªå†»ç»“åŠ¨ä½œä½¿ç”¨åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–çš„å€¼â€œç²˜è´´â€è¯¥å­—æ®µã€‚ä½†æ˜¯ï¼Œå®ƒä¸ä¼šé™åˆ¶å­—æ®µçš„å¯ä¿®æ”¹æ€§ï¼ˆæ‚¨ä»ç„¶å¯ä»¥é€šè¿‡åå°„æ¥è§„é¿æœ€ç»ˆç»“æœï¼‰ï¼Œå†»ç»“åªæ˜¯å…³äºåˆå§‹åŒ–å­˜å‚¨ã€‚</p>
<hr />
<p><img alt="39a8d8769e48e34f43d265a0.png" src="../assets/img/39a8d8769e48e34f43d265a0.png" /></p>
<p>è¿™æ˜¯å¦‚ä½•æ­£å¼æŒ‡å®šçš„ã€‚è¯·æ³¨æ„ï¼Œwå’Œr2å¯èƒ½æ˜¯ä¹Ÿå¯èƒ½ä¸æ˜¯æœ€ç»ˆå­—æ®µçš„å†™å…¥å’Œè¯»å–ï¼Œå®ƒä»¬ä¹Ÿå¯èƒ½æ˜¯æ™®é€šéæœ€ç»ˆå­—æ®µçš„å†™å…¥å’Œè¯»å–ã€‚çœŸæ­£é‡è¦çš„æ˜¯åŒ…å«å†»ç»“åŠ¨ä½œFçš„å­é“¾ï¼Œä¸€äº›åŠ¨ä½œaå’Œè¯»å–æœ€ç»ˆåœºçš„r1 - ä¸€èµ·ä½¿r2è§‚å¯Ÿåˆ°wã€‚ è¯·æ³¨æ„ï¼Œéœ€è¦ä¸¤ä¸ªæ–°è®¢å•ï¼Œå–æ¶ˆå¼•ç”¨é¡ºåºå’Œå†…å­˜é¡ºåºæ¥é™å®šå†»ç»“å€¼çš„ä¼ æ’­æ–¹å¼ã€‚</p>
<hr />
<p><img alt="5d45ad99d06bebe64214b575.png" src="../assets/img/5d45ad99d06bebe64214b575.png" /></p>
<p>æˆ‘ä»¬â€œåªâ€éœ€è¦ç¡®ä¿ä»ç›®æ ‡è¯»å–çš„æ‰€æœ‰è·¯å¾„é€šè¿‡Få’Œæœ€ç»ˆå­—æ®µè¯»å–å¯¼è‡´å†»ç»“å€¼çš„å†™å…¥ã€‚</p>
<hr />
<h3 id="constructive-example">Constructive Example</h3>
<p>è¿™ä¸ªä¾‹å­è¢«å¼—æ‹‰åŸºç±³å°”Â·è¥¿ç‰¹å°¼ç§‘å¤«å’Œå¼—æ‹‰åŸºç±³å°”Â·ç§‘ç“¦è¿ç§‘å¤§å¤§è§£å¼€ï¼Œå¯¹ä»–ä»¬çš„ç§°èµï¼è¿™æ˜¯åŸºäºä»–ä»¬çš„åˆ†æçš„å¯è§†åŒ–ï¼š</p>
<p><img alt="d20f5f9beee9835649c1a85a.png" src="../assets/img/d20f5f9beee9835649c1a85a.png" /></p>
<p><img alt="6d7b508bdc58bb481a33b06e.png" src="../assets/img/6d7b508bdc58bb481a33b06e.png" /></p>
<p><img alt="8d97135fa2b3420965df7a92.png" src="../assets/img/8d97135fa2b3420965df7a92.png" /></p>
<p><img alt="172a3ba46fe934aee52b2978.png" src="../assets/img/172a3ba46fe934aee52b2978.png" /></p>
<p><img alt="35d02405d69af442356366b0.png" src="../assets/img/35d02405d69af442356366b0.png" /></p>
<p><img alt="f014bbcb8f19d90fb4bbec8b.png" src="../assets/img/f014bbcb8f19d90fb4bbec8b.png" /></p>
<p><img alt="cb89f3956d70e02ed77bbca5.png" src="../assets/img/cb89f3956d70e02ed77bbca5.png" /></p>
<p><img alt="de6eff74c5f6fc923fc0c200.png" src="../assets/img/de6eff74c5f6fc923fc0c200.png" /></p>
<p><img alt="d806cfa6e705a36f7e5ab429.png" src="../assets/img/d806cfa6e705a36f7e5ab429.png" /></p>
<hr />
<h3 id="premature-publication">Premature Publication</h3>
<p><img alt="ce6f11190ebae57b41be238f.png" src="../assets/img/ce6f11190ebae57b41be238f.png" /></p>
<p>è¿™æ˜¯Jeremy Mansonçš„PoPLè®ºæ–‡ä¸­çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚åœ¨é‚£é‡Œï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹åˆå§‹åŒ–å¯¹è±¡å¹¶å°†42å­˜å‚¨åˆ°æœ€ç»ˆå­—æ®µfï¼Œç„¶åé€šè¿‡pâ€œæ³„æ¼â€å¯¹è±¡å¼•ç”¨ï¼Œç„¶åæ‰é€šè¿‡qæ­£ç¡®å‘å¸ƒã€‚ ä¼ ç»Ÿè§‚ç‚¹è®¤ä¸ºï¼Œæœ€ç»ˆçš„å­—æ®µä¿è¯ä¼šå› è¿‡æ—©å‘å¸ƒè€Œæ¶ˆå¤±ï¼Œä½†å®é™…ä¸Šï¼Œç¬¬ä¸‰ä¸ªçº¿ç¨‹åªè§‚å¯Ÿå®Œå…¨æ„é€ çš„å¯¹è±¡ï¼Œæˆ‘ä»¬åªèƒ½æ‰¾åˆ°åˆé€‚çš„æœ€ç»ˆè·¯å¾„ã€‚ ï¼ˆå‚è§ä¸Šé¢çš„ä¾‹å­è¿›è¡Œç±»æ¯”ã€‚ï¼‰ ç„¶è€Œï¼Œå½“é€šè¿‡pè¯»å–æ—¶ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹çªç ´äº†æœ€ç»ˆè·¯å¾„ï¼Œå› æ­¤å¯èƒ½è§‚å¯Ÿåˆ°éå†»ç»“å€¼ã€‚æœ‰ç‚¹ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œé€šè¯»qä¹Ÿå¯ä»¥è§‚å¯Ÿåˆ°éå†»ç»“å€¼ã€‚è¿™æ˜¯drå’Œmcå‘½ä»¤çš„å±æ€§æ­£å¼å…è®¸çš„ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªå®ç”¨çš„åŸå› ï¼š</p>
<hr />
<p><img alt="16ecf5080882fef377cd7af4.png" src="../assets/img/16ecf5080882fef377cd7af4.png" /></p>
<p>å®ç”¨çš„åŸå› æ˜¯è¿è¡Œæ—¶å¯èƒ½ä¼šåœ¨å‘ç°æœ€ç»ˆå­—æ®µåå¯¹å…¶è¿›è¡Œç¼“å­˜ï¼è¿™æ„å‘³ç€å¦‚æœç¼–è¯‘å™¨å‘ç°på’Œqæ˜¯åŒä¸€ä¸ªå¯¹è±¡çš„åˆ«åï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¯´r3 = r2ï¼Œå¹¶ç”¨å®ƒæ¥å®Œæˆã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬è§‚å¯Ÿåˆ°æ„é€ ä¸è¶³çš„å¯¹è±¡ï¼Œæˆ‘ä»¬çš„çº¿ç¨‹å°±ä¼šå˜å¾—æ±¡ç§½ï¼Œè€Œä¸”ä¸€åˆ‡éƒ½å´©æºƒäº†ã€‚</p>
<hr />
<h3 id="test-your-understanding-tricky">Test Your Understanding (tricky)</h3>
<p><img alt="cef7a808e801296371913eab.png" src="../assets/img/cef7a808e801296371913eab.png" /></p>
<p>è¯·æ³¨æ„ï¼Œè§„èŒƒè®¨è®ºäº†æ„é€ å‡½æ•°ä¸­çš„åˆå§‹åŒ–ï¼Œè¿™é‡Œæˆ‘ä»¬è¿˜æœ‰å…¶ä»–çš„ä¸œè¥¿ã€‚ç­”æ¡ˆï¼ˆé€‰æ‹©ç»“æŸä»¥æ˜¾ç¤ºï¼‰ï¼šå½“ç„¶ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°42æˆ–ä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚å­—æ®µåˆå§‹å€¼è®¾å®šé¡¹å’Œå®ä¾‹åˆå§‹å€¼è®¾å®šé¡¹åœ¨å®ä¾‹åˆå§‹åŒ–è¿‡ç¨‹ä¸­è§¦å‘ï¼Œå¯ä»¥è¯´æ˜¯æ„é€ å‡½æ•°çš„ä¸€éƒ¨åˆ†ã€‚</p>
<hr />
<h3 id="jmm-updates_4">JMM Updates</h3>
<p><img alt="021a4855fa5056602f330c44.png" src="../assets/img/021a4855fa5056602f330c44.png" /></p>
<p>final-så­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼Œä¸»è¦æ˜¯ä¸å…¶ä»–JMMå…ƒç´ çš„æ­£äº¤æ€§æœ‰å…³ã€‚å¦‚æœå­—æ®µå·²ç»æ˜¯volatileï¼Œé‚£ä¹ˆå¦‚ä½•åœ¨æ„é€ å‡½æ•°ä¸­å®ç°åˆå§‹åŒ–å­˜å‚¨çš„å¯è§æ€§ç‰¹åˆ«æœ‰è¶£ã€‚ ï¼ˆæç¤ºï¼šä¸ç¨³å®šæ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºå®ƒç¬¦åˆè§„èŒƒï¼Œæ­¤æ—¶ï¼‰ã€‚ ä»æ•™å­¦çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬æ˜¯å¦åº”è¯¥æ’æ–¥é‚£äº›å¿˜è®°åœ¨æ„é€ å‡½æ•°ä¸­å£°æ˜ä¸€æ¬¡å†™å…¥çš„ç”¨æˆ·ï¼Œå¹¶è®©ä»–ä»¬çš„ä»£ç åœ¨éx86å¹³å°ä¸Šçˆ†ç‚¸ï¼Œè¿™ä¹Ÿå¾ˆæœ‰è¶£ã€‚ å› æ­¤ï¼Œä¸‹ä¸€ä¸ªJMMæ›´æ–°éœ€è¦å†³å®šæ˜¯å¦åº”è¯¥å°†æœ€ç»ˆå­—æ®µä¿è¯æ‰©å±•åˆ°åœ¨æ‰€æœ‰æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–çš„æ‰€æœ‰å­—æ®µã€‚</p>
<hr />
<h3 id="benchmarks_1">Benchmarks</h3>
<p>æœ¬èŠ‚ä»‹ç»æ›´æ–°çš„Javaå†…å­˜æ¨¡å‹çš„æœ€ç»ˆå­—æ®µæ³¨æ„äº‹é¡¹ã€‚è¯·å‚é˜…<a href="http://shipilev.net/blog/2014/all-fields-are-final/">å¦ä¸€ç¯‡æ–‡ç« </a>ä¸­æ›´å…¨é¢çš„è§£é‡Šã€‚</p>
<p><img alt="7b11816eb9c459a14094e582.png" src="../assets/img/7b11816eb9c459a14094e582.png" /></p>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸¥æ ¼é‡åŒ–æ ‡è®°æ‰€æœ‰å­—æ®µçš„æœ€ç»ˆæˆæœ¬ã€‚ç”±äºæœ€ç»ˆçš„å­—æ®µå­˜å‚¨åœ¨æ„é€ å‡½æ•°ä¸­éœ€è¦å†…å­˜éšœç¢ä»¥ç”¨äºå¼±æœ‰åºçš„å¹³å°ï¼Œå› æ­¤æˆ‘ä»¬è¿˜å°†ARMä¸»æœºä½œä¸ºæµ‹è¯•å¹³å°ã€‚</p>
<hr />
<p>ä»¥ä¸‹æ˜¯åŸºå‡†æµ‹è¯•ï¼šé“¾æ¥è°ƒç”¨å±‚æ¬¡ç»“æ„ä¸­çš„Nä¸ªæ„é€ å‡½æ•°ï¼Œä¸ºæ¯ä¸ªç±»åˆå§‹åŒ–å•ä¸ªå­—æ®µï¼Œå¹¶åˆå¹¶åˆå§‹åŒ–æ‰€æœ‰Nä¸ªå­—æ®µã€‚å­—æ®µå¯ä»¥æ˜¯æ™®é€šå­—æ®µæˆ–æœ€ç»ˆå­—æ®µæˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„N-sè¿›è¡Œæµ‹è¯•ï¼Œä»¥ç¡®å®šæ€§èƒ½æ˜¯å¦ä»¥åˆç†çš„æ–¹å¼å‘ç”Ÿå˜åŒ–ã€‚</p>
<p><img alt="ac74ab08abc3e1953c7f5f8d.png" src="../assets/img/ac74ab08abc3e1953c7f5f8d.png" /></p>
<p><img alt="96ec0ccb672be7dff40e2d12.png" src="../assets/img/96ec0ccb672be7dff40e2d12.png" /></p>
<hr />
<p><img alt="905d33253aba810cad154bf3.png" src="../assets/img/905d33253aba810cad154bf3.png" /></p>
<p>ä½œä¸ºTotal Store Orderæœºå™¨çš„x86æ²¡æœ‰å†…å­˜å±éšœï¼Œå› æ­¤æ‰€æœ‰å››ç§å˜ä½“ä¹‹é—´çš„å·®å¼‚éƒ½åœ¨æµ‹é‡è¯¯å·®èŒƒå›´å†…ï¼Œä¸Næ— å…³ã€‚</p>
<hr />
<p><img alt="d3818258b5eef93bf589d4d7.png" src="../assets/img/d3818258b5eef93bf589d4d7.png" /></p>
<p>åœ¨å¼±æœ‰åºçš„æœºå™¨ä¸Šï¼Œæœ€ç»ˆæ¶‰åŠä¸€ä¸ªçœŸæ­£çš„å†…å­˜å±éšœï¼Œå¹¶ä¸”åœ¨ç»¿è‰²æ¡ä¸Šçš„æ‰§è¡Œæ—¶é—´ä¸­å¢åŠ äº†å±éšœæˆæœ¬ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªè¶…ç±»ä¸­éƒ½æœ‰éšœç¢ï¼Œè¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆçº¢çº¿éœ€è¦çº¿æ€§æ›´å¤šçš„æ—¶é—´ã€‚æˆ‘ä»¬å¯ä»¥æ•™VMåˆå¹¶éšœç¢ï¼Œç„¶åæ‰§è¡Œæœ€ç»ˆè¯­ä¹‰çš„æˆæœ¬ä¼šæ·¹æ²¡åœ¨åˆ†é…æˆæœ¬ä¸­ã€‚</p>
<hr />
<h2 id="conclusion">Conclusion</h2>
<p><img alt="c5c33ae912c642614090965d.png" src="../assets/img/c5c33ae912c642614090965d.png" /></p>
<p>å½“æˆ‘ä»¬å¤„ç†ä¸€ä¸ªè®¨åŒçš„JMMé”™è¯¯æ—¶ï¼ŒDougæ”¾å¼ƒäº†ä¸€ä¸ªæ™ºæ…§çš„å®çŸ³ï¼Œåº”è¯¥å¾ˆå¥½åœ°æ€»ç»“è¿™ä¸ªè°ˆè¯ã€‚å¦‚æœä½¿ç”¨å¹¶å‘ç»“æ„çš„äººèƒ½å¤Ÿå¼„æ¸…æ¥šè¿™äº›ç»“æ„ä½•æ—¶ä»¥åŠä½•æ—¶èµ·ä½œç”¨ï¼Œé‚£ä¹Ÿæ˜¯å¥½äº‹ã€‚å¸Œæœ›è¿™ä¸ªè®²è¯èƒ½å¤Ÿæ”¹å–„JMMçš„ç†è§£ã€‚</p>
<hr />
<p><img alt="5d875409de423fcdeec3dc16.png" src="../assets/img/5d875409de423fcdeec3dc16.png" /></p>
<p>æˆ‘ä»¬æƒ³åœ¨JMMä¸­è§£å†³ä¸€äº›å·²çŸ¥çš„é—®é¢˜......</p>
<hr />
<p><img alt="ed816fc91eeeb7dd8a829480.png" src="../assets/img/ed816fc91eeeb7dd8a829480.png" /></p>
<p>...å¼•èµ·äº†â€œJavaå†…å­˜æ¨¡å‹æ›´æ–°â€çš„åŠªåŠ›ã€‚</p>
<hr />
<p><img alt="569fc9b20b5e552f17437a44.png" src="../assets/img/569fc9b20b5e552f17437a44.png" /></p>
<p>åœ¨ä¸€å¤©ç»“æŸæ—¶ï¼Œä¸ºè¯»è€…æä¾›ä¸€äº›æœ‰ç”¨çš„é“¾æ¥ï¼š</p>
<ul>
<li>
<p><a href="http://www.amazon.com/Java-Concurrency-Practice-Brian-Goetz/dp/0321349601">Goetz et al: "Java Concurrency in Practice"</a></p>
</li>
<li>
<p><a href="http://www.amazon.com/Art-Multiprocessor-Programming-Revised-Reprint/dp/0123973376">Herilhy, Shavit, "The Art of Multiprocessor Programming"</a></p>
</li>
<li>
<p><a href="http://www.hpl.hp.com/techreports/Compaq-DEC/WRL-95-7.pdf">Adve, "Shared Memory Consistency Models: A Tutorial"</a></p>
</li>
<li>
<p><a href="ftp://kernel.org/pub/linux/kernel/people/paulmck/perfbook/perfbook.html">McKenney, "Is Parallel Programming Hard, And, If So, What Can You Do About It?"</a></p>
</li>
<li>
<p><a href="http://unladen-swallow.googlecode.com/files/journal.pdf">Manson, "Special PoPL Issue: The Java Memory Model"</a></p>
</li>
<li>
<p><a href="http://www-sop.inria.fr/everest/personnel/Gustavo.Petri/publis/jmm-vamp07.pdf">Huisman, Petri, "JMM: A Formal Explanation"</a></p>
</li>
</ul>
<hr />





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  
    
  



  


<h4>Cookie consent</h4>
<p></p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51198bba.min.js"></script>
      
    
  </body>
</html>