---
title: "ğŸåå˜ã€é€†å˜ä¸ä¸å˜"
date: 2020-10-19T19:23:13+08:00
categories: ["tech"]
---

## Formal definition

æ‘˜è‡ª[Covariance_and_contravariance_(computer_science)](https://176.122.157.231:5004/wiki/Covariance_and_contravariance_(computer_science))ï¼š

> Within the type system of a programming language, a `typing rule` or a` type constructor` is:
 - _covariant_ if it preserves the [rdering of types (â‰¤)](https://176.122.157.231:5004/wiki/Subtype), which orders types from more specific to more generic;
 - _contravariant_ if it reverses this ordering;
 - bivariant if both of these apply (i.e., both `I<A>` â‰¤ `I<B>` and `I<B>` â‰¤ `I<A>` at the same time);[1]
 - variant if covariant, contravariant or bivariant;
 - invariant or nonvariant if not variant.

## åå˜

é¦–å…ˆè€ƒè™‘æ•°ç»„ç±»å‹æ„é€ å™¨ï¼š ä»Animalç±»å‹ï¼Œå¯ä»¥å¾—åˆ°`Animal[]`ï¼ˆâ€œanimalæ•°ç»„â€ï¼‰ã€‚ æ˜¯å¦å¯ä»¥æŠŠå®ƒå½“ä½œ

- åå˜ï¼ša `Cat[]` is an `Animal[]`
- é€†å˜ï¼šan `Animal[]` is  a `Cat[]`
- ä¸å˜ï¼šan `Animal[]` is not a `Cat[]` and a `Cat[]` is not an `Animal[]`

### Javaä¸­çš„åå˜æ•°ç»„

```java
// a æ˜¯å•å…ƒç´ çš„ String æ•°ç»„
String[] a = new String[1];

// b æ˜¯ Object çš„æ•°ç»„
Object[] b = a;

// å‘ b ä¸­èµ‹ä¸€ä¸ªæ•´æ•°ã€‚å¦‚æœ b ç¡®å®æ˜¯ Object çš„æ•°ç»„ï¼Œè¿™æ˜¯å¯èƒ½çš„ï¼›ç„¶è€Œå®ƒå…¶å®æ˜¯ä¸ª String çš„æ•°ç»„ï¼Œå› æ­¤ä¼šå‘ç”Ÿ java.lang.ArrayStoreException
b[0] = 1;
```

## OOPä¸­çš„ç»§æ‰¿

> å½“ä¸€ä¸ªå­ç±»[é‡å†™](https://176.122.157.231:3457/wiki/é‡å†™)ä¸€ä¸ªè¶…ç±»çš„æ–¹æ³•æ—¶ï¼Œç¼–è¯‘å™¨å¿…é¡»æ£€æŸ¥é‡å†™æ–¹æ³•æ˜¯å¦å…·æœ‰æ­£ç¡®çš„ç±»å‹ã€‚è™½ç„¶ä¸€äº›è¯­è¨€è¦æ±‚ç±»å‹å¿…é¡»ä¸è¶…ç±»ç›¸åŒï¼Œä½†å…è®¸é‡å†™æ–¹æ³•æœ‰ä¸€ä¸ªâ€œæ›´å¥½çš„â€ç±»å‹ä¹Ÿæ˜¯ç±»å‹å®‰å…¨çš„ã€‚å¯¹äºå¤§éƒ¨åˆ†çš„æ–¹æ³•å­ç±»åŒ–è§„åˆ™æ¥è¯´ï¼Œè¿™è¦æ±‚è¿”å›å€¼çš„ç±»å‹å¿…é¡»æ›´å…·ä½“ï¼Œä¹Ÿå°±æ˜¯`åå˜`ï¼Œè€Œä¸”æ¥å—æ›´å®½æ³›çš„å‚æ•°ç±»å‹ï¼Œä¹Ÿå°±æ˜¯`é€†å˜`ã€‚

![be914bff8d5611a54aa47597.png](assets/img/be914bff8d5611a54aa47597.png)


ä»¥ä¸‹è®¨è®ºåŸºäºJavaè¯­æ³•ï¼Œ`æŠ½è±¡ç±»C`å¦‚ä¸‹ï¼š
```java
jshell> abstract class C {
   ...> abstract C foo(C c);
   ...> }
|  replaced class C
```

### è¿”å›å€¼çš„åå˜

åœ¨å…è®¸åå˜è¿”å›å€¼çš„è¯­è¨€ä¸­, å­ç±»å¯ä»¥é‡å†™`foo`æ–¹æ³•è¿”å›ä¸€ä¸ªæ›´å…·ä½“çš„ç±»å‹ï¼š

```
jshell> class D extends C {
   ...> @Override
   ...> D foo(C c) {return this;}
   ...> }
|  created class D
```

### æ–¹æ³•å‚æ•°çš„åå˜ä¸é€†å˜

å…è®¸å‚æ•°åå˜ã€é€†å˜çš„é¢å‘å¯¹è±¡è¯­è¨€å¹¶ä¸å¤šâ€”â€”Javaä¼šæŠŠå®ƒå½“æˆä¸€ä¸ªå‡½æ•°é‡è½½ï¼š

åå˜ï¼š

```
jshell> class E extends C {
   ...> @Override
   ...> C foo(E e) {return this;}
   ...> }
|  Error:
|  E is not abstract and does not override abstract method foo(C) in C
|  class E extends C {
|  ^------------------...
|  Error:
|  method does not override or implement a method from a supertype
|  @Override
|  ^-------^
```

é€†å˜ï¼š
```
jshell> class F extends C {
   ...> @Override
   ...> C foo(Object o) {return this;}
   ...> }
|  Error:
|  F is not abstract and does not override abstract method foo(C) in C
|  class F extends C {
|  ^------------------...
|  Error:
|  method does not override or implement a method from a supertype
|  @Override
|  ^-------^
```

#### Summary of variance and inheritance

| è¯­è¨€      |Parameter type|Return type|
| :-------- | --------:| :------: |
| C++ ï¼ˆè‡ª1998å¹´ï¼‰, Java (è‡ªJ2SE 5.0), D    |   ä¸å˜ |  åå˜  |
| C#    |   ä¸å˜ |  ä¸å˜  |

## å‚è€ƒ

- [Covariance and contravariance](https://176.122.157.231:5004/wiki/Covariance_and_contravariance_(computer_science))

