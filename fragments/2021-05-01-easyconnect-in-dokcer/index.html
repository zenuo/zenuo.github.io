<!doctype html><html><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>
ğŸ§°EasyConnect in Dokcer
</title>
<meta name=generator content="Hugo 0.91.2">
<link rel=stylesheet href="https://zenuo.github.io/css/styles.min.da6e1927bcb6a0faebcb06ab9925c87524b8057860afacf48eab54fcbf9eef18.css" integrity="sha256-2m4ZJ7y2oPrrywarmSXIdSS4BXhgr6z0jqtU/L+e7xg=">
<script async defer data-domain=kaiwern.com src=https://plausible.io/js/plausible.js></script>
<link rel=preconnect href=https://fonts.googleapis.com>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lora&family=Source+Sans+Pro:wght@400;600&display=swap" rel=stylesheet>
<body class="flex flex-col min-h-screen px-6 max-w-prose md:w-2/3 m-auto"><nav class=mt-8>
<ul id=nav-menu class="w-full flex items-center list-reset">
<li>
<a href=https://zenuo.github.io/>Home</a>
</li>
<li>
<a href=https://zenuo.github.io/fragments/>Fragments</a>
</li>
<li>
<a href=https://zenuo.github.io/about/>About</a>
</li>
<li>
<a href=https://zenuo.github.io/tags/>Tags</a>
</li>
</ul>
</nav>
<main class="flex-1 mt-10 sm:mt-12">
<div>
<header class="mb-8 font-sans-serif">
<div class="text-sm font-gray-700 mb-8">
<p class="uppercase font-semibold">
<a class=text-gray-700 href=/fragments>fragments</a>
</p>
<p>May 01, 2021</p>
</div>
<h1 class="text-3xl mb-1 font-semibold">ğŸ§°EasyConnect in Dokcer</h1>
<p class="italic text-xs">Last updated at: May 01, 2021</p>
</header>
<article class="prose serif mb-16 text-gray-800">
<p><a href=https://www.sangfor.com/en/products/infrastructure/easyconnect>Sangfor EasyConnect</a>æ˜¯ä¸€æ¬¾ä¸“æœ‰çš„VPNè§£å†³æ–¹æ¡ˆï¼Œå®˜æ–¹æ”¯æŒå¤šç§å¹³å°çš„å®¢æˆ·ç«¯ï¼›ä½†è¯¥è½¯ä»¶ç›®å‰å­˜åœ¨ä»¥ä¸‹çš„å‡ ç§è¡Œä¸ºï¼š</p>
<ol>
<li>é…ç½®ä¸€ä¸ªå¼€æœºè‡ªåŠ¨å¯åŠ¨çš„å®ˆæŠ¤è¿›ç¨‹<code>EasyMonitor</code></li>
<li>å®‰è£…CAæ ¹è¯ä¹¦</li>
</ol>
<p>ä¸ºäº†é¿å…ä¸Šè¿°ä¸¤ç§æƒ…å†µå¯¹æœ¬åœ°ç³»ç»Ÿé€ æˆä¸è‰¯å½±å“ï¼Œå°è¯•å¯»æ‰¾æ–¹æ³•å°†EasyConnectè¿è¡Œåœ¨å—æ§çš„å®¹å™¨å†…ã€‚æ‰€å¹¸åœ¨<a href=https://github.com/Hagb/docker-easyconnect>Hagb/docker-easyconnect</a>æ‰¾åˆ°äº†ï¼Œè¯¥ä»“åº“ä»‹ç»äº†ä¸€ç§åœ¨Dockerå†…è¿è¡ŒEasyConnectçš„æ–¹æ¡ˆã€‚é€šè¿‡è¯¥æ–¹æ¡ˆï¼Œåœ¨æ­¤è®°å½•ä¸‹æˆ‘çš„å®è·µè¿‡ç¨‹ã€‚</p>
<h2 id=1-è¿è¡Œå®¹å™¨>1 è¿è¡Œå®¹å™¨</h2>
<blockquote>
<p>åœ¨<code>Dockerå®¿ä¸»æœº</code>ä¸º<a href=https://alpinelinux.org/>Alpine Linux</a>æ—¶ï¼Œæ˜ å°„åˆ°<code>Dockerå®¿ä¸»æœº</code>çš„ç«¯å£ï¼Œæ— æ³•åœ¨å®¿ä¸»æœºçš„å¤–éƒ¨ç½‘ç»œï¼ˆä¾‹å¦‚å®¿ä¸»æœºæ‰€åœ¨çš„å±€åŸŸç½‘ï¼‰è®¿é—®ï¼Œä½†å¯ä»¥åœ¨å®¿ä¸»æœºæœ¬åœ°è®¿é—®ï¼›</p>
</blockquote>
<p>åˆ›å»ºæ–‡ä»¶ç”¨äºä¿å­˜ç™»å½•å‡­è¯ï¼Œä»¥å®ç°auto loginï¼š</p>
<pre tabindex=0><code>$ touch ~/.easyconn
</code></pre><p>ä»Dockeré•œåƒ<code>hagb/docker-easyconnect:cli</code>åˆ›å»ºä¸€ä¸ªåç§°ä¸º<code>easyconnect</code>çš„å®¹å™¨ï¼Œå¹¶ä¸”å°†<code>å®¹å™¨çš„1080ç«¯å£</code>æ˜ å°„åˆ°<code>Dockerå®¿ä¸»æœºçš„1080ç«¯å£</code>ï¼ˆ1080åªæ˜¯ä¸€ä¸ªç¤ºä¾‹å€¼ï¼Œå¯ä»¥æ˜¯å…¶ä»–çš„ï¼›æ•²é»‘æ¿ï¼Œåç»­ä¼šç”¨åˆ°ï¼‰ï¼š</p>
<pre tabindex=0><code>$ docker run --name easyconnect --device /dev/net/tun --cap-add NET_ADMIN -ti -v $HOME/.easyconn:/root/.easyconn -e EC_VER=7.6.8 -e EXIT=1 -p 1080:1080 hagb/docker-easyconnect:cli
</code></pre><p>æ ¹æ®æç¤ºè¾“å…¥<code>æœåŠ¡å™¨URL</code>ã€<code>ç”¨æˆ·å</code>ã€<code>å¯†ç </code>ã€‚</p>
<p>æ³¨æ„æœåŠ¡å™¨URLæœ«å°¾ä¸éœ€è¦åæ–œçº¿ï¼ˆ<code>/</code>ï¼‰ï¼Œä¾‹å¦‚æ­£ç¡®çš„<code>https://vpn_host</code>ã€‚</p>
<p>å¦‚æœæˆåŠŸç™»å…¥ï¼Œåˆ™ä¼šæç¤ºï¼š</p>
<pre tabindex=0><code>user &quot;xx&quot; login successfully!
</code></pre><h2 id=2-æµè§ˆå™¨over-proxy>2 æµè§ˆå™¨over proxy</h2>
<ol>
<li>
<p>æµè§ˆå™¨è¿è¡Œæ—¶åŠ¨æ€é…ç½®ä»£ç†ï¼Œå¯ä»¥é€šè¿‡<a href=https://github.com/FelisCatus/SwitchyOmega>SwitchyOmega</a>æ¥å®ç°ï¼Œé¡»å°†Proxyè®¾ç½®ä¸º<code>Dockerå®¿ä¸»æœºçš„1080ç«¯å£</code></p>
</li>
<li>
<p>æµè§ˆå™¨å¯åŠ¨æ—¶æŒ‡å®šä»£ç†ï¼Œè‹¥æ‚¨æ˜¯ä½¿ç”¨<code>Chromium</code>ç›¸å…³ï¼ˆæ¯”å¦‚Chromeï¼‰ï¼Œåˆ™å¯é€šè¿‡å‘½ä»¤è¡Œå¯åŠ¨ï¼š</p>
</li>
</ol>
<pre tabindex=0><code>$ chromium â€”proxy-server=socks5://${Dockerå®¿ä¸»æœºIP}:1080
</code></pre><h2 id=3-ssh-over-proxy>3 ssh over proxy</h2>
<blockquote>
<p>è‹¥æ‚¨æ˜¯ä½¿ç”¨Arch Linuxï¼Œéœ€è¦å®‰è£…openbsd-netcatï¼Œè€Œä¸æ˜¯gnu-netcat</p>
</blockquote>
<p>ç¼–è¾‘sshé…ç½®æ–‡ä»¶<code>~/.ssh/config</code>ï¼Œæ·»åŠ å†…å®¹ï¼š</p>
<pre tabindex=0><code>Host 10.1.*
    ProxyCommand /usr/bin/nc -x ${Dockerå®¿ä¸»æœºIP}:1080 %h %p
</code></pre><p>ä½¿å¾—åœ¨é€šè¿‡sshè®¿é—®åŒ¹é…<code>10.1.*</code>ï¼ˆä»…ä»…æ˜¯ç¤ºä¾‹ï¼Œéœ€è¦æ ¹æ®æ‚¨çš„å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´ï¼‰çš„ä¸»æœºæ—¶ï¼Œé€šè¿‡ä»£ç†<code>${Dockerå®¿ä¸»æœºIP}:1080</code></p>
<h2 id=4-git-over-proxy>4 git over proxy</h2>
<p>åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p>
<ol>
<li>
<p>è‹¥gitä»“åº“çš„remoteæ˜¯<code>ssh</code>åè®®ï¼Œç¼–è¾‘sshé…ç½®æ–‡ä»¶<code>~/.ssh/config</code>ï¼Œæ·»åŠ å†…å®¹ï¼š</p>
<pre tabindex=0><code>Host ${gitä»“åº“åŸŸå}
    ProxyCommand /usr/bin/nc -x ${Dockerå®¿ä¸»æœºIP}:1080 %h %p
</code></pre></li>
<li>
<p>è‹¥gitä»“åº“çš„remoteæ˜¯<code>http</code>æˆ–è€…<code>https</code>åè®®ï¼Œé‚£ä¹ˆåœ¨ä¸remoteäº¤äº’æ—¶ï¼Œä¸ºgitå‘½ä»¤æŒ‡å®šå˜é‡<code>http_proxy</code>ï¼Œä¾‹å¦‚ï¼š</p>
<pre tabindex=0><code>$ https_proxy=socks5://localhost:1080 git clone http://${gitä»“åº“åŸŸå}/x/x.git
</code></pre></li>
</ol>
<h2 id=5-mysql-client-over-proxy>5 MySQL client over proxy</h2>
<p>å› ä¸º<a href=https://dev.mysql.com/doc/refman/8.0/en/mysql.html>åŸç”ŸMySQL client</a>ä¸æ”¯æŒsocks5ä»£ç†ï¼Œå¯é€šè¿‡å…¶ä»–å®¢æˆ·ç«¯æ¥è¾¾åˆ°ç›®çš„ï¼›ä¾‹å¦‚<a href=https://www.mycli.net/>mycli</a>ï¼Œä½†mycliç›®å‰æ²¡æœ‰æ”¯æŒsocks5ä»£ç†ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦é‡‡å–ä¸€äº›é¢å¤–çš„æªæ–½ã€‚</p>
<p>å› ä¸ºmycliåŸºäºPythonå®ç°ï¼Œæ•…å¯é€šè¿‡<a href=https://pypi.org/project/PySocks/>PySocks</a>æ¥å¯¹æ•´ä¸ªæ ‡å‡†åº“è¿›è¡ŒçŒ´è¡¥ä¸(Monkey patch)ï¼Œä½¿æ‰€æœ‰çš„socketéƒ½é€šè¿‡ä¸€ä¸ªä»£ç†å»ºç«‹ã€‚</p>
<p>å‡è®¾æ‚¨æ˜¯é€šè¿‡brewå®‰è£…çš„mycliï¼Œé‚£ä¹ˆéœ€è¦ä¿®æ”¹<code>/usr/local/bin/mycli</code>ï¼Œæ·»åŠ å†…å®¹ï¼š</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>socket</span>
<span class=kn>import</span> <span class=nn>socks</span>

<span class=n>ip</span> <span class=o>=</span> <span class=s1>&#39;$</span><span class=si>{Dockerå®¿ä¸»æœºIP}</span><span class=s1>&#39;</span>
<span class=n>port</span> <span class=o>=</span> <span class=mi>1080</span>
<span class=n>socks</span><span class=o>.</span><span class=n>setdefaultproxy</span><span class=p>(</span><span class=n>socks</span><span class=o>.</span><span class=n>PROXY_TYPE_SOCKS5</span><span class=p>,</span> <span class=n>ip</span><span class=p>,</span> <span class=n>port</span><span class=p>)</span>
<span class=n>socket</span><span class=o>.</span><span class=n>socket</span> <span class=o>=</span> <span class=n>socks</span><span class=o>.</span><span class=n>socksocket</span>
</code></pre></div><p>ä¿å­˜å³å¯ä½¿ç”¨ã€‚</p>
<h2 id=6-å‚è€ƒ>6 å‚è€ƒ</h2>
<ol>
<li><a href=https://zhuanlan.zhihu.com/p/259634641>https://zhuanlan.zhihu.com/p/259634641</a></li>
<li><a href=https://www.sangfor.com/en/products/infrastructure/easyconnect>https://www.sangfor.com/en/products/infrastructure/easyconnect</a></li>
<li><a href=https://github.com/Hagb/docker-easyconnect>https://github.com/Hagb/docker-easyconnect</a></li>
<li><a href=https://docs.docker.com/config/containers/container-networking/>https://docs.docker.com/config/containers/container-networking/</a></li>
<li><a href=https://superuser.com/questions/454210/how-can-i-use-ssh-with-a-socks-5-proxy>https://superuser.com/questions/454210/how-can-i-use-ssh-with-a-socks-5-proxy</a></li>
<li><a href=https://pypi.org/project/PySocks/>https://pypi.org/project/PySocks/</a></li>
<li><a href=https://www.mycli.net/>https://www.mycli.net/</a></li>
<li><a href=https://dev.mysql.com/doc/refman/8.0/en/mysql.html>https://dev.mysql.com/doc/refman/8.0/en/mysql.html</a></li>
</ol>
<div class="float-right mb-8">
<p class="text-sm mb-4 font-gray-700 italic">(122 words)</p>
</div>
</article>
</div>
</main>
<hr>
<footer class="w-full text-center p-4 pin-b text-xs text-gray-400">
<p>made with <a href=https://gohugo.io class="underline hover:text-blue-400">Hugo</a> and <a href=https://tailwindcss.com class="underline hover:text-blue-400">TailwindCSS</a></p>
</footer>
</body>
</html>