<!doctype html><html><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>🚇基于v2ray的科学上网</title><meta name=generator content="Hugo 0.112.3"><link rel=stylesheet href="https://zenuo.github.io/css/styles.min.da6e1927bcb6a0faebcb06ab9925c87524b8057860afacf48eab54fcbf9eef18.css" integrity="sha256-2m4ZJ7y2oPrrywarmSXIdSS4BXhgr6z0jqtU/L+e7xg="><script async defer data-domain=kaiwern.com src=https://plausible.io/js/plausible.js></script>
<link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Lora&family=Source+Sans+Pro:wght@400;600&display=swap" rel=stylesheet><body class="flex flex-col min-h-screen px-6 max-w-prose md:w-2/3 m-auto"><nav class=mt-8><ul id=nav-menu class="w-full flex items-center list-reset"><li><a href=https://zenuo.github.io/>Home</a></li><li><a href=https://zenuo.github.io/fragments/>Fragments</a></li><li><a href=https://zenuo.github.io/about/>Home</a></li><li><a href=https://zenuo.github.io/tags/>Tags</a></li></ul></nav><main class="flex-1 mt-10 sm:mt-12"><div><header class="mb-8 font-sans-serif"><div class="text-sm font-gray-700 mb-8"><p class="uppercase font-semibold"><a class=text-gray-700 href=/fragments>fragments</a></p><p>Jul 11, 2020</p></div><h1 class="text-3xl mb-1 font-semibold">🚇基于v2ray的科学上网</h1><p class="italic text-xs">Last updated at: Jul 11, 2020</p></header><article class="prose serif mb-16 text-gray-800"><p>本篇笔记尝试从<code>v2ray是什么</code>、<code>浅谈工作原理</code>、<code>运行服务端</code>、<code>运行客户端</code>四个方面，通过少许命令和配置内容，让我们能迅速上手使用v2ray。</p><h1 id=v2ray是什么>v2ray是什么？</h1><blockquote><p><a href=https://www.v2ray.com/>Project V</a> 是一个工具集合，它可以帮助你打造专属的基础通信网络。Project V 的核心工具称为V2Ray，其主要负责网络协议和功能的实现，与其它 Project V 通信。V2Ray 可以单独运行，也可以和其它工具配合，以提供简便的操作流程。</p></blockquote><p>当然，<a href=https://github.com/v2ray/v2ray-core>v2ray</a>是开源的，主要特性如下：</p><ul><li>多入口多出口: 一个 V2Ray 进程可并发支持多个入站和出站协议，每个协议可独立工作。</li><li>可定制化路由: 入站流量可按配置由不同的出口发出。轻松实现按区域或按域名分流，以达到最优的网络性能。</li><li>多协议支持: V2Ray 可同时开启多个协议支持，包括 Socks、HTTP、Shadowsocks、VMess 等。每个协议可单独设置传输载体，比如 TCP、mKCP、WebSocket 等。</li><li>隐蔽性: V2Ray 的节点可以伪装成正常的网站（HTTPS），将其流量与正常的网页流量混淆，以避开第三方干扰。</li><li>反向代理: 通用的反向代理支持，可实现内网穿透功能。</li><li>多平台支持: 原生支持所有常见平台，如 Windows、Mac OS、Linux，并已有第三方支持移动平台。</li></ul><h1 id=浅谈工作原理>浅谈工作原理</h1><p>使用方式上，<code>v2ray</code>与其他代理<a href=https://github.com/shadowsocks/shadowsocks>shadowsocks</a>工具类似，需要运行<code>服务端</code>和<code>客户端</code>两个实例(instance)。</p><p>常见的场景里，客户端运行在PC、手机等终端设备，服务端运行在云主机等服务器上。例如，我们若要在手机访问<a href=https://www.google.com>Google搜索引擎</a>时，如果手机所在的网络禁用了Google的IP和域名，那么手机是无法直接访问的，需要由一个「手机可以访问的中间网络节点，且该节点能访问Google搜索引擎」的代理来起到一个桥梁的作用：手机的<code>浏览器</code>把<code>HTTP请求</code>发送到<code>代理</code>，<code>代理</code>把<code>HTTP请求</code>发送到<code>Google搜索引擎</code>，<code>Google搜索引擎</code>的<code>HTTP响应</code>会顺着这条路线最终返回给终端设备的<code>浏览器</code>。</p><p>在这里，v2ray和shadowsocks等网络工具就扮演了代理这个角色，但仅仅做网络流量代理是不够的，因为网络流量由网络协议承载，若协议的特征能被防火墙识别，被识别就意味着防火墙有理由把我们的代理IP添加到黑名单中，导致无法终端设备无法访问这个代理；所以网络工具还需要支持不易被识别的网络协议，这些协议往往不被浏览器等应用支持，需要由网络工具自己来支持，所以用作代理的网络工具需要运行<code>客户端</code>和<code>服务端</code>。</p><p>浏览器等终端应用通过HTTP、Socks5等常见的网络协议把流量发送给代理<code>客户端</code>，<code>客户端</code>再通过<code>特定的协议</code>将流量发送给代理<code>服务端</code>；</p><p>在v2ray的设计中，终端应用到代理<code>客户端</code>的接口被称为<code>Inbound</code>（入口），代理<code>服务端</code>到实际目的地（例如Google搜索引擎）的接口被称为<code>Outbound</code>（出口）。</p><h1 id=运行服务端>运行服务端</h1><blockquote><p>摘自<a href=https://www.v2ray.com/>Project V官网</a>，并假设你的服务端运行在Linux操作系统上。</p></blockquote><h2 id=1-下载-v2ray>1 下载 V2Ray</h2><p>预编译的压缩包可以在如下几个站点找到：</p><ul><li>Github Release: github.com/v2ray/v2ray-core</li><li>Github 分流: github.com/v2ray/dist</li></ul><p>压缩包均为 zip 格式，找到对应平台的压缩包，下载解压即可使用。</p><h2 id=2-验证安装包>2 验证安装包</h2><p>V2Ray 提供两种验证方式：</p><ol><li>安装包 zip 文件的 SHA1 / SHA256 摘要，在每个安装包对应的.dgst文件中可以找到。</li><li>可运行程序（v2ray 或 v2ray.exe）的 gpg 签名，文件位于安装包中的 v2ray.sig 或 v2ray.exe.sig。签名公钥可以在<a href=https://raw.githubusercontent.com/v2ray/v2ray-core/master/release/verify/official_release.asc>代码库</a>中找到。</li></ol><h2 id=3-linux-安装脚本>3 Linux 安装脚本</h2><p>V2Ray 提供了一个在 Linux 中的自动化安装脚本。这个脚本会自动检测有没有安装过 V2Ray，如果没有，则进行完整的安装和配置；如果之前安装过 <code>V2Ray</code>，则只更新 <code>V2Ray 二进制程序</code>而不更新配置。</p><p>以下指令假设已在 <code>su</code> 环境下，如果不是，请先运行 <code>sudo su</code>。</p><p>运行下面的指令下载并安装 V2Ray。当 <code>yum</code> 或 <code>apt-get</code> 可用的情况下，此脚本会自动安装 <code>unzip</code> 和 <code>daemon</code>。这两个组件是安装 V2Ray 的必要组件。如果你使用的系统不支持 yum 或 apt-get，请自行安装 unzip 和 daemon</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>bash &lt;<span class=o>(</span>curl -L -s https://install.direct/go.sh<span class=o>)</span>
</span></span></code></pre></div><p>此脚本会自动安装以下文件：</p><ul><li>/usr/bin/v2ray/v2ray：V2Ray 程序；</li><li>/usr/bin/v2ray/v2ctl：V2Ray 工具；</li><li>/etc/v2ray/config.json：配置文件；</li><li>/usr/bin/v2ray/geoip.dat：IP 数据文件</li><li>/usr/bin/v2ray/geosite.dat：域名数据文件</li></ul><p>此脚本会配置自动运行脚本。自动运行脚本会在系统重启之后，自动运行 V2Ray。目前自动运行脚本只支持带有 Systemd 的系统，以及 Debian / Ubuntu 全系列。</p><ul><li>/etc/systemd/system/v2ray.service: Systemd</li><li>/etc/init.d/v2ray: SysV</li></ul><p>脚本运行完成后，你需要：</p><ul><li>编辑 /etc/v2ray/config.json 文件来配置你需要的代理方式；</li><li>运行 service v2ray start 来启动 V2Ray 进程；</li><li>之后可以使用 service v2ray start|stop|status|reload|restart|force-reload 控制 V2Ray 的运行。</li></ul><h2 id=4-gosh-参数>4 go.sh 参数</h2><p>go.sh 支持如下参数，可在手动安装时根据实际情况调整：</p><ul><li>-p 或 &ndash;proxy: 使用代理服务器来下载 V2Ray 的文件，格式与 curl 接受的参数一致，比如 &ldquo;socks5://127.0.0.1:1080&rdquo; 或 &ldquo;http://127.0.0.1:3128&rdquo;。</li><li>-f 或 &ndash;force: 强制安装。在默认情况下，如果当前系统中已有最新版本的 V2Ray，go.sh 会在检测之后就退出。如果需要强制重装一遍，则需要指定该参数。</li><li>&ndash;version: 指定需要安装的版本，比如 &ldquo;v1.13&rdquo;。默认值为最新版本。</li><li>&ndash;local: 使用一个本地文件进行安装。如果你已经下载了某个版本的 V2Ray，则可通过这个参数指定一个文件路径来进行安装。</li></ul><p>示例：</p><ul><li>使用地址为 127.0.0.1:1080 的 SOCKS 代理下载并安装最新版本：./go.sh -p socks5://127.0.0.1:1080</li><li>安装本地的 v1.13 版本：./go.sh &ndash;version v1.13 &ndash;local /path/to/v2ray.zip</li></ul><h2 id=5-配置服务端>5 配置服务端</h2><p>一个参考，Inbound协议为vmess，outbound协议为freedom：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;log&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;loglevel&#34;</span><span class=p>:</span> <span class=s2>&#34;warning&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;inbounds&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=err>（您配置的服务端监听的端口，整数，需要被服务器的防火墙开放TCP协议访问）</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;vmess&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;clients&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;您生成的UUID，可以通过Linux命令uuidgen生成&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;level&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;alterId&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;security&#34;</span><span class=p>:</span> <span class=s2>&#34;auto&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;streamSettings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;network&#34;</span><span class=p>:</span> <span class=s2>&#34;h2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;httpSettings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;path&#34;</span><span class=p>:</span> <span class=s2>&#34;/hello&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;security&#34;</span><span class=p>:</span> <span class=s2>&#34;tls&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;tlsSettings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;certificates&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;certificateFile&#34;</span><span class=p>:</span> <span class=s2>&#34;您的PEM certificate文件&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;keyFile&#34;</span><span class=p>:</span> <span class=s2>&#34;您的PEM RSA private key文件&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;outbounds&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;freedom&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;routing&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rules&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;field&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;ip&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;geoip:private&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;outboundTag&#34;</span><span class=p>:</span> <span class=s2>&#34;blocked&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>您可以通过下面的脚本来生成一份自签证书：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># create self-signed server certificate:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>read</span> -p <span class=s2>&#34;Enter your domain [www.example.com]: &#34;</span> DOMAIN
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Create server key...&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>openssl genrsa -des3 -out <span class=nv>$DOMAIN</span>.key <span class=m>4096</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Create server certificate signing request...&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>SUBJECT</span><span class=o>=</span><span class=s2>&#34;/C=US/ST=Mars/L=Mars/O=Mars/OU=Mars/CN=</span><span class=nv>$DOMAIN</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>openssl req -new -subj <span class=nv>$SUBJECT</span> -key <span class=nv>$DOMAIN</span>.key -out <span class=nv>$DOMAIN</span>.csr
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Remove password...&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mv <span class=nv>$DOMAIN</span>.key <span class=nv>$DOMAIN</span>.origin.key
</span></span><span class=line><span class=cl>openssl rsa -in <span class=nv>$DOMAIN</span>.origin.key -out <span class=nv>$DOMAIN</span>.key
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Sign SSL certificate...&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>openssl x509 -req -days <span class=m>365</span> -in <span class=nv>$DOMAIN</span>.csr -signkey <span class=nv>$DOMAIN</span>.key -out <span class=nv>$DOMAIN</span>.crt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;TODO:&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Copy </span><span class=nv>$DOMAIN</span><span class=s2>.crt to /etc/nginx/ssl/</span><span class=nv>$DOMAIN</span><span class=s2>.crt&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Copy </span><span class=nv>$DOMAIN</span><span class=s2>.key to /etc/nginx/ssl/</span><span class=nv>$DOMAIN</span><span class=s2>.key&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Add configuration in nginx:&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;server {&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34; ...&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34; listen 443 ssl;&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34; ssl_certificate /etc/nginx/ssl/</span><span class=nv>$DOMAIN</span><span class=s2>.crt;&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34; ssl_certificate_key /etc/nginx/ssl/</span><span class=nv>$DOMAIN</span><span class=s2>.key;&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;}&#34;</span>
</span></span></code></pre></div><h1 id=运行客户端>运行客户端</h1><h2 id=windows>Windows</h2><blockquote><p>演示在<code>Windows</code>操作系统运行<code>v2ray-core</code>客户端</p></blockquote><p>在<a href=https://github.com/v2ray/v2ray-core/releases>Github Release</a>页面下载<a href=https://github.com/v2ray/v2ray-core/releases/download/v4.26.0/v2ray-windows-64.zip>v2ray-windows-64.zip</a>，解压到文件夹<code>D:\bin\v2ray</code>；用记事本等软件新建一个名为<code>v2ray.bat</code>的批处理文件，达到双击这个文件启动v2ray的作用，内容为：</p><pre tabindex=0><code>start D:\bin\v2ray\wv2ray.exe -config D:\bin\v2ray\vpoint_socks_vmess.json
</code></pre><p><img src=/img/27da7be3a641f73e22f6380e.png alt=27da7be3a641f73e22f6380e.png></p><p>配置文件<code>D:\bin\v2ray\vpoint_socks_vmess.json</code>与您的服务端配置有关，对应上面的服务端的参考配置，客户端的参考配置：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;log&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;loglevel&#34;</span><span class=p>:</span> <span class=s2>&#34;warning&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;inbounds&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=mi>1080</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;listen&#34;</span><span class=p>:</span> <span class=s2>&#34;127.0.0.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;socks&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sniffing&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;enabled&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;destOverride&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;http&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;tls&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;auth&#34;</span><span class=p>:</span> <span class=s2>&#34;noauth&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;udp&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;outbounds&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;vmess&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;vnext&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;address&#34;</span><span class=p>:</span> <span class=s2>&#34;您的服务器的IP&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=err>（您配置的服务端监听的端口）</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;users&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;您生成的UUID，需要与服务端配置相同&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;level&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;alterId&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;security&#34;</span><span class=p>:</span> <span class=s2>&#34;auto&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;streamSettings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;network&#34;</span><span class=p>:</span> <span class=s2>&#34;h2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;httpSettings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;path&#34;</span><span class=p>:</span> <span class=s2>&#34;/hello&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;security&#34;</span><span class=p>:</span> <span class=s2>&#34;tls&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;tlsSettings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;serverName&#34;</span><span class=p>:</span> <span class=s2>&#34;您的PEM certificate文件的域名&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;allowInsecure&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>保存配置文件后，即可双击<code>v2ray.bat</code>运行，若客户端配置争取，则能在<code>任务管理器</code>看到<code>w2ray.exe</code>运行：</p><p><img src=/img/8034d8f58c0885234da7741d.png alt=8034d8f58c0885234da7741d.png></p><p>接下来在<code>Chrome</code>中安装<code>Proxy SwitchyOmega</code>插件，关闭所有打开的<code>Chrome</code>窗口，然后在powershell运行下面命令，运行一个Chrome实例，所有流量由<code>socks5://localhost:1080</code>代理，没错，这个代理就是我们刚刚在本地运行的v2ray实例：</p><pre tabindex=0><code>C:\Users\（您的用户名）\AppData\Local\Google\Chrome\Application\chrome.exe --proxy-server=&#34;socks5://localhost:1080&#34;
</code></pre><p>访问<code>https://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif</code>，或者搜索<code>Proxy SwitchyOmega</code>：</p><p><img src=/img/e6df7231e15a13db9d8709a7.png alt=e6df7231e15a13db9d8709a7.png></p><p>安装插件，设置代理服务器为本地的实例：</p><p><img src=/img/2e67f16ba9663bba6ad93099.png alt=2e67f16ba9663bba6ad93099.png></p><p>点击图标并设置为<code>auto switch</code>：</p><p><img src=/img/bb4db2169fc3b9132cef21d6.png alt=bb4db2169fc3b9132cef21d6.png></p><p>关闭当前所有Chrome窗口，不指定代理运行一个新窗口，访问<code>https://www.google.com</code>，等待<code>图标显示橙色数字</code>时，点击域名，点击<code>proxy</code>，将域名<code>goole.com</code>添加到代理规则中：</p><p><img src=/img/23eed0612626b1d059651de7.png alt=23eed0612626b1d059651de7.png></p><p>再刷新页面，不出意外的话，成功访问：</p><p><img src=/img/d8e8dc81f24969c17334a14e.png alt=d8e8dc81f24969c17334a14e.png></p><blockquote><p>后续再补充安卓、iOS等其他客户端</p></blockquote><h2 id=android>Android</h2><p>我们这里用到<a href=https://github.com/2dust/v2rayNG>V2rayNG</a>，一款开源的安卓软件，所有版本在https://github.com/2dust/v2rayNG/releases可以看到（请使用浏览器打开）；</p><p>安装成功之后，因为V2rayNG只作为客户端，不提供代理服务，所以需要输入服务器配置。</p><p>您可以自己搭建服务器，或者使用朋友的服务器（也有服务商提供付费服务），V2rayNG提供了【扫描二维码】的功能，便于分享服务器配置，如下：</p><p><img src=/img/68318ade7f2c3e28619e638f.png alt=68318ade7f2c3e28619e638f.png></p><p>导入成功之后，【配置文件】列表中会添加一个配置，如下：</p><p><img src=/img/00f2f986bc6135c0f6ee4a5a.png alt=00f2f986bc6135c0f6ee4a5a.png></p><p>就快完成了，点击左上角的三道杠（上图蓝色圈出）呼出设置菜单栏，点击【设置】</p><p><img src=/img/ecab8a2864e5b8d018f344c7.png alt=ecab8a2864e5b8d018f344c7.png></p><p>将【预定义规则】设置为「绕过局域网及大陆地址」，使得访问大陆网址和局域网地址不使用代理：</p><p><img src=/img/4c471ee00f340cd3fee55a53.png alt=4c471ee00f340cd3fee55a53.png></p><p>再次点击左上角，回到【配置文件】，选中我们刚刚导入的配置，然后点击右下角的V字按钮，启动服务（首次启动时，系统会弹出提示框，允许即可）：</p><p><img src=/img/9c898636fba3070ecce9de74.png alt=9c898636fba3070ecce9de74.png></p><p>好了，试试在浏览器中访问https://www.google.com/吧，如果访问成功，说明已经可以科学上网了。</p><h1 id=参考>参考</h1><ol><li><a href=https://www.systutorials.com/how-to-set-google-chromes-proxy-settings-in-command-line-on-linux>How to set Google Chrome’s proxy settings in command line on Linux?</a></li><li><a href=v2ray.com>Project V</a></li></ol><div class="float-right mb-8"><p class="text-sm mb-4 font-gray-700 italic">(523 words)</p></div></article></div></main><hr><footer class="w-full text-center p-4 pin-b text-xs text-gray-400"><p>made with <a href=https://gohugo.io class="underline hover:text-blue-400">Hugo</a> and <a href=https://tailwindcss.com class="underline hover:text-blue-400">TailwindCSS</a></p></footer></body></html>